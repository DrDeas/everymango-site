<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EveryMango - Gentle Project Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.5/babel.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* EveryMango Brand Colors */
            --mango-blush: #D94E41;
            --warm-red: #E85D4A;
            --ripe-mango: #F4A259;
            --deep-gold: #F9A825;
            --golden-flesh: #F8C56D;
            --sunny-yellow: #F8D54C;
            --mango-leaf: #6B8E6B;
            --sanctuary-sage: #A8B5A0;
            --soft-charcoal: #4A4A4A;
            
            /* Warm, gentle background palette */
            --cream: #FDF6E9;
            --cream-dark: #F5EDD8;
            --linen: #EDE5D4;
            --warm-gray: #9A9590;
            --charcoal: #4A4A4A;
            --soft-black: #2d2a27;
            
            /* Sidebar colors - mango leaf inspired */
            --sage: #6B8E6B;
            --sage-dark: #5A7A5A;
            --sage-light: #A8B5A0;
            --moss: #4A6B4A;
            
            /* Gentle status colors - warm mango tones */
            --status-new: #F5EDD8;
            --status-working: #F8C56D;
            --status-stuck: #F4A259;
            --status-done: #A8B5A0;
            
            /* Soft accent colors */
            --coral: #E85D4A;
            --peach: #F8C56D;
            --lavender: #c4b8d8;
            --sky: #a8c8d8;
            --mint: #A8B5A0;
            --rose: #d8a8b8;
            
            /* Priority colors - warm spectrum */
            --priority-low: #a8c8d8;
            --priority-medium: #F8C56D;
            --priority-high: #F4A259;
            --priority-critical: #D94E41;
            
            /* Energy colors */
            --energy-low: #a8c8d8;
            --energy-medium: #F8C56D;
            --energy-high: #F4A259;
            
            /* Task type colors */
            --type-creative: #c4b8d8;
            --type-admin: #F8C56D;
            --type-meeting: #a8c8d8;
            --type-deep-work: #A8B5A0;
            --type-communication: #F4A259;
            --type-learning: #a8d8d8;
        }
        
        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: var(--cream);
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Quicksand', sans-serif;
        }
        
        /* Gentle status badges */
        .status-new { 
            background-color: var(--status-new); 
            color: var(--charcoal); 
        }
        .status-working { 
            background-color: var(--status-working); 
            color: var(--soft-black); 
        }
        .status-stuck { 
            background-color: var(--status-stuck); 
            color: var(--soft-black); 
        }
        .status-done { 
            background-color: var(--status-done); 
            color: var(--soft-black); 
        }
        
        /* Priority colors - soft */
        .priority-low { background-color: var(--priority-low); color: var(--soft-black); }
        .priority-medium { background-color: var(--priority-medium); color: var(--soft-black); }
        .priority-high { background-color: var(--priority-high); color: var(--soft-black); }
        .priority-critical { background-color: var(--priority-critical); color: white; }

        /* Time estimate badges */
        .time-5min { background-color: var(--mint); color: var(--soft-black); }
        .time-15min { background-color: var(--sky); color: var(--soft-black); }
        .time-30min { background-color: var(--peach); color: var(--soft-black); }
        .time-1hr { background-color: var(--coral); color: white; }
        .time-2hr { background-color: var(--lavender); color: var(--soft-black); }

        /* Energy level badges */
        .energy-high { background-color: var(--energy-high); color: var(--soft-black); }
        .energy-medium { background-color: var(--energy-medium); color: var(--soft-black); }
        .energy-low { background-color: var(--energy-low); color: var(--soft-black); }

        /* Task type borders - softer */
        .type-creative { border-left: 4px solid var(--type-creative); }
        .type-admin { border-left: 4px solid var(--type-admin); }
        .type-meeting { border-left: 4px solid var(--type-meeting); }
        .type-deep-work { border-left: 4px solid var(--type-deep-work); }
        .type-communication { border-left: 4px solid var(--type-communication); }
        .type-learning { border-left: 4px solid var(--type-learning); }
        
        /* Gentle animations */
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.9; }
        }
        .timer-active {
            animation: timerPulse 3s ease-in-out infinite;
        }

        @keyframes brainDumpPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(244, 162, 89, 0.4); }
            50% { box-shadow: 0 0 0 6px rgba(244, 162, 89, 0); }
        }
        .brain-dump-active {
            animation: brainDumpPulse 2.5s ease-in-out infinite;
        }

        .recently-viewed-badge {
            background: var(--golden-flesh);
        }

        /* Time slot styles */
        .time-slot {
            min-height: 80px;
            border: 2px dashed var(--linen);
            transition: all 0.3s ease;
            border-radius: 16px;
        }
        .time-slot:hover {
            border-color: var(--sage);
            background: rgba(107, 142, 107, 0.08);
        }
        .time-slot.occupied {
            border: 2px solid var(--sage-light);
            background: rgba(107, 142, 107, 0.06);
        }
        
        /* Custom scrollbar - warm and gentle */
        .scrollbar-thin::-webkit-scrollbar { 
            width: 10px; 
            height: 10px; 
        }
        .scrollbar-thin::-webkit-scrollbar-track { 
            background: transparent; 
        }
        .scrollbar-thin::-webkit-scrollbar-thumb { 
            background: var(--linen); 
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { 
            background: var(--warm-gray); 
        }

        /* Sidebar scrollbar */
        .scrollbar-sage::-webkit-scrollbar { 
            width: 10px; 
            height: 10px; 
        }
        .scrollbar-sage::-webkit-scrollbar-track { 
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin: 4px 0;
        }
        .scrollbar-sage::-webkit-scrollbar-thumb { 
            background: rgba(255,255,255,0.35); 
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        .scrollbar-sage::-webkit-scrollbar-thumb:hover { 
            background: rgba(255,255,255,0.5); 
        }
        
        /* Smooth transitions */
        * {
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }
        
        /* Frosted glass effect - warm tint */
        .glass-effect {
            background: rgba(253, 246, 233, 0.9);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
        }
        
        /* Soft, pillowy shadows */
        .shadow-soft {
            box-shadow: 0 2px 8px rgba(74, 74, 74, 0.04), 0 8px 24px rgba(74, 74, 74, 0.06);
        }
        .shadow-soft-lg {
            box-shadow: 0 4px 12px rgba(74, 74, 74, 0.05), 0 16px 40px rgba(74, 74, 74, 0.08);
        }
        
        /* Hover effects - gentle lift */
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(74, 74, 74, 0.08), 0 20px 48px rgba(74, 74, 74, 0.1);
        }
        
        /* Button styles - mango-inspired */
        .btn-primary {
            background: var(--mango-leaf);
            border: none;
            box-shadow: 0 2px 8px rgba(107, 142, 107, 0.3);
            font-weight: 600;
            letter-spacing: 0.01em;
        }
        .btn-primary:hover {
            background: var(--sage-dark);
            box-shadow: 0 4px 16px rgba(107, 142, 107, 0.4);
        }

        /* Focus Mode styles */
        .focus-mode-active {
            animation: focusPulse 2.5s ease-in-out infinite;
        }
        @keyframes focusPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(107, 142, 107, 0.3); }
            50% { box-shadow: 0 0 0 8px rgba(107, 142, 107, 0); }
        }

        /* Quick Win badge - sunny yellow */
        .quick-win-badge {
            background: var(--sunny-yellow);
            color: var(--soft-black);
            animation: quickWinGlow 2s ease-in-out infinite;
        }
        @keyframes quickWinGlow {
            0%, 100% { box-shadow: 0 2px 8px rgba(248, 213, 76, 0.4); }
            50% { box-shadow: 0 2px 16px rgba(248, 213, 76, 0.7); }
        }
        
        input, select, textarea {
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            font-size: 16px; /* Prevents iOS zoom on focus */
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--mango-leaf) !important;
            box-shadow: 0 0 0 4px rgba(107, 142, 107, 0.15);
        }
        
        .card-gentle {
            background: white;
            border-radius: 20px;
            border: 1px solid var(--linen);
        }

        /* Progress ring animation */
        @keyframes progressFill {
            from { stroke-dashoffset: 251.2; }
        }
        .progress-ring {
            animation: progressFill 1s ease-out forwards;
        }

        /* Draggable task */
        .draggable-task {
            cursor: move;
            user-select: none;
        }
        .draggable-task:active {
            opacity: 0.8;
            cursor: grabbing;
        }

        /* Someday/Maybe styling */
        .someday-maybe-badge {
            background: var(--sky);
            color: var(--soft-black);
        }

        /* Rolled over task indicator - gentle mango tone */
        .rolled-over-badge {
            background: var(--golden-flesh);
            color: var(--soft-black);
            animation: gentlePulse 3s ease-in-out infinite;
        }
        @keyframes gentlePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* No-judgment mode styles */
        .no-judgment-mode .status-stuck {
            background: var(--golden-flesh) !important;
        }
        .no-judgment-mode .overdue-text {
            color: var(--warm-gray) !important;
        }

        /* Gentle reminder styling */
        .gentle-reminder {
            background: rgba(168, 200, 216, 0.15);
            border-left: 3px solid var(--sky);
        }

        /* Celebration animation - mango ripening! */
        @keyframes celebratePop {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        .celebrate {
            animation: celebratePop 0.4s ease-out;
        }

        /* Notification styles */
        @keyframes bellRing {
            0%, 100% { transform: rotate(0deg); }
            10%, 30%, 50% { transform: rotate(-8deg); }
            20%, 40% { transform: rotate(8deg); }
            60% { transform: rotate(0deg); }
        }
        .bell-ringing {
            animation: bellRing 1s ease-in-out;
        }

        .notification-panel {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
            box-shadow: 0 8px 40px rgba(74, 74, 74, 0.12), 0 2px 12px rgba(74, 74, 74, 0.08);
            border-radius: 20px;
        }

        .notification-item {
            transition: all 0.2s ease;
        }
        .notification-item:hover {
            background: rgba(107, 142, 107, 0.08);
        }
        .notification-item.unread {
            background: rgba(244, 162, 89, 0.1);
            border-left: 3px solid var(--ripe-mango);
        }

        .notification-badge {
            background: var(--warm-red);
            color: white;
            min-width: 20px;
            height: 20px;
            font-size: 11px;
            font-weight: 700;
            animation: badgePulse 2.5s ease-in-out infinite;
        }
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        /* Why it matters field */
        .why-matters-field {
            background: rgba(244, 162, 89, 0.12);
            border-left: 3px solid var(--ripe-mango);
            border-radius: 12px;
        }
        .why-matters-badge {
            background: var(--ripe-mango);
            color: var(--soft-black);
        }

        /* Reminder time picker */
        .reminder-chip {
            background: rgba(107, 142, 107, 0.15);
            border: 1px solid rgba(107, 142, 107, 0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        .reminder-chip:hover {
            background: rgba(107, 142, 107, 0.25);
        }
        .reminder-chip.active {
            background: var(--mango-leaf);
            color: white;
            border-color: transparent;
        }

        /* Toast notification */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        .toast-enter {
            animation: slideInRight 0.4s ease-out forwards;
        }
        .toast-exit {
            animation: slideOutRight 0.3s ease-in forwards;
        }

        /* Due soon indicator */
        .due-soon-glow {
            box-shadow: 0 0 0 2px rgba(248, 197, 109, 0.4);
            animation: dueSoonPulse 2.5s ease-in-out infinite;
        }
        @keyframes dueSoonPulse {
            0%, 100% { box-shadow: 0 0 0 2px rgba(248, 197, 109, 0.4); }
            50% { box-shadow: 0 0 0 4px rgba(248, 197, 109, 0.2); }
        }

        /* Toggle switch styling */
        .toggle-track {
            transition: background-color 0.3s ease;
        }
        .toggle-thumb {
            transition: left 0.3s ease, background-color 0.3s ease;
        }

        /* Sidebar styling - mango leaf gradient */
        .sidebar-gentle {
            background: linear-gradient(180deg, var(--mango-leaf) 0%, var(--sage-dark) 100%);
        }

        /* Select dropdown styling */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%234A4A4A' d='M0 0l5 6 5-6z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 28px;
            cursor: pointer;
        }
        select:hover {
            opacity: 0.9;
        }

        /* Badge styling override for consistency */
        .badge-soft {
            font-weight: 600;
            border-radius: 10px;
            padding: 4px 10px;
        }

        /* Mango logo animation */
        .mango-logo {
            transition: transform 0.3s ease;
        }
        .mango-logo:hover {
            transform: rotate(-5deg) scale(1.05);
        }

        /* Brand tagline styling */
        .tagline {
            font-size: 10px;
            letter-spacing: 0.05em;
            opacity: 0.8;
        }

        /* ============================================
           MOBILE RESPONSIVE STYLES
           ============================================ */
        
        /* Mobile sidebar overlay */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Mobile sidebar slide-in */
        .sidebar-mobile {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 280px;
            z-index: 50;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        .sidebar-mobile.open {
            transform: translateX(0);
        }

        /* Mobile hamburger button */
        .hamburger-btn {
            display: none;
            width: 44px;
            height: 44px;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: var(--mango-leaf);
            color: white;
            border: none;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* Mobile header bar */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--cream);
            border-bottom: 1px solid var(--linen);
            z-index: 30;
            padding: 0 16px;
            align-items: center;
            justify-content: space-between;
        }

        /* Task card mobile layout */
        .task-card-mobile {
            display: none;
        }
        .task-row-desktop {
            display: block;
        }

        /* Mobile action buttons */
        .mobile-actions-toggle {
            display: none;
        }

        /* Responsive breakpoints */
        @media (max-width: 1024px) {
            .task-row-desktop .grid-cols-12 {
                grid-template-columns: repeat(8, 1fr);
            }
            .task-row-desktop .col-span-3 {
                grid-column: span 2;
            }
            .task-row-desktop .col-span-2 {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            /* Show mobile header */
            .mobile-header {
                display: flex;
            }

            /* Show hamburger */
            .hamburger-btn {
                display: flex;
            }

            /* Hide desktop sidebar */
            .desktop-sidebar {
                display: none;
            }

            /* Add top padding for fixed header */
            .main-content {
                padding-top: 60px;
            }

            /* Brain dump bar mobile */
            .brain-dump-bar {
                flex-direction: column;
                gap: 12px;
                padding: 12px 16px;
            }
            .brain-dump-bar .brain-dump-input-row {
                flex-direction: column;
                gap: 8px;
                width: 100%;
            }
            .brain-dump-bar input {
                width: 100%;
            }
            .brain-dump-bar .toggle-controls {
                flex-wrap: wrap;
                gap: 8px;
                width: 100%;
                justify-content: flex-start;
                border-left: none;
                padding-left: 0;
                margin-left: 0;
                padding-top: 8px;
                border-top: 1px solid var(--linen);
            }

            /* Switch to mobile task cards */
            .task-row-desktop {
                display: none;
            }
            .task-card-mobile {
                display: block;
            }

            /* Column headers hide on mobile */
            .column-headers {
                display: none;
            }

            /* Board header mobile */
            .board-header {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            .board-header-actions {
                width: 100%;
                flex-wrap: wrap;
            }
            .board-filters {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            .board-filters > * {
                width: 100%;
            }
            .time-budget-mobile {
                display: none;
            }

            /* Group header mobile */
            .group-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }
            .group-header-right {
                width: 100%;
                justify-content: space-between;
            }

            /* Dashboard grid mobile */
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Time blocking mobile */
            .time-blocking-layout {
                flex-direction: column;
            }
            .time-blocking-sidebar {
                width: 100%;
                max-height: 200px;
            }

            /* Team grid mobile */
            .team-grid {
                grid-template-columns: 1fr;
            }

            /* Notification panel mobile */
            .notification-panel {
                position: fixed;
                top: 60px;
                left: 8px;
                right: 8px;
                width: auto;
                max-height: calc(100vh - 80px);
            }

            /* Toast mobile position */
            .toast-container {
                left: 16px;
                right: 16px;
                bottom: 16px;
            }

            /* Page header mobile */
            .page-header h2 {
                font-size: 1.5rem;
            }

            /* Modal mobile */
            .modal-content {
                margin: 16px;
                max-height: calc(100vh - 32px);
                overflow-y: auto;
            }
        }

        @media (max-width: 480px) {
            /* Extra small screens */
            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .board-header-actions button {
                flex: 1;
                justify-content: center;
            }

            .toggle-controls {
                flex-direction: column;
            }

            .cta-buttons {
                flex-direction: column;
                width: 100%;
            }
        }

        /* Touch-friendly tap targets */
        @media (hover: none) and (pointer: coarse) {
            button, 
            a, 
            select, 
            input[type="checkbox"],
            .clickable {
                min-height: 44px;
                min-width: 44px;
            }

            .action-btn {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBFP8FTm4VVZYmkI21zS-q1dH-RRCZnEZY",
            authDomain: "everymango-a3a10.firebaseapp.com",
            projectId: "everymango-a3a10",
            storageBucket: "everymango-a3a10.firebasestorage.app",
            messagingSenderId: "646235082520",
            appId: "1:646235082520:web:9ac40262c5b188d265d86d"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const { useState, useEffect, useMemo, useRef } = React;

        // EveryMango Logo Component
        function MangoLogo({ size = 32, className = "" }) {
            return (
                <svg 
                    width={size} 
                    height={size} 
                    viewBox="0 0 64 88" 
                    className={`mango-logo ${className}`}
                    style={{ transform: 'rotate(15deg)' }}
                >
                    <defs>
                        <linearGradient id="mangoGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stopColor="#E85D4A" />
                            <stop offset="35%" stopColor="#F4A259" />
                            <stop offset="65%" stopColor="#F8C56D" />
                            <stop offset="100%" stopColor="#F8D54C" />
                        </linearGradient>
                        <linearGradient id="leafGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stopColor="#6B8E6B" />
                            <stop offset="100%" stopColor="#5A7A5A" />
                        </linearGradient>
                    </defs>
                    
                    {/* Leaf */}
                    <ellipse 
                        cx="38" 
                        cy="8" 
                        rx="12" 
                        ry="5" 
                        fill="url(#leafGradient)"
                        transform="rotate(35, 38, 8)"
                    />
                    <path 
                        d="M32 10 Q38 8 44 10" 
                        stroke="#5A7A5A" 
                        strokeWidth="1.5" 
                        fill="none"
                        transform="rotate(35, 38, 8)"
                    />
                    
                    {/* Mango body */}
                    <path 
                        d="M32 12 
                           C14 12 6 32 6 48 
                           C6 66 18 82 32 84 
                           L38 84
                           L32 78
                           C46 82 58 66 58 48 
                           C58 32 50 12 32 12 Z"
                        fill="url(#mangoGradient)"
                        stroke="#4A4A4A"
                        strokeWidth="2.5"
                    />
                    
                    {/* Highlight */}
                    <ellipse 
                        cx="22" 
                        cy="32" 
                        rx="8" 
                        ry="12" 
                        fill="white" 
                        opacity="0.4"
                        transform="rotate(-15, 22, 32)"
                    />
                </svg>
            );
        }

        // Login Screen Component
        function LoginScreen() {
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');

            const handleGoogleSignIn = async () => {
                setIsLoading(true);
                setError('');
                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    await auth.signInWithPopup(provider);
                } catch (err) {
                    console.error('Sign in error:', err);
                    setError(err.message || 'Failed to sign in. Please try again.');
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4" style={{background: 'linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%)'}}>
                    <div className="card-gentle shadow-soft-lg p-8 md:p-12 max-w-md w-full text-center">
                        <div className="flex justify-center mb-6">
                            <MangoLogo size={80} />
                        </div>
                        <h1 className="text-2xl md:text-3xl font-bold mb-2" style={{color: 'var(--charcoal)', fontFamily: 'Quicksand, sans-serif'}}>
                            EveryMango
                        </h1>
                        <p className="text-sm mb-8" style={{color: 'var(--warm-gray)'}}>
                            Ripen at your own pace ðŸ¥­
                        </p>
                        
                        <p className="mb-6" style={{color: 'var(--charcoal)'}}>
                            Gentle project management for ADHD minds
                        </p>

                        {error && (
                            <div className="mb-4 p-4 rounded-2xl text-sm" style={{background: 'rgba(232, 93, 74, 0.1)', color: 'var(--warm-red)'}}>
                                {error}
                            </div>
                        )}

                        <button
                            onClick={handleGoogleSignIn}
                            disabled={isLoading}
                            className="w-full px-6 py-4 rounded-2xl font-semibold flex items-center justify-center space-x-3 transition-all hover-lift disabled:opacity-50"
                            style={{background: 'white', border: '2px solid var(--linen)', color: 'var(--charcoal)'}}
                        >
                            {isLoading ? (
                                <i className="fas fa-spinner fa-spin"></i>
                            ) : (
                                <>
                                    <svg width="20" height="20" viewBox="0 0 24 24">
                                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                    </svg>
                                    <span>Continue with Google</span>
                                </>
                            )}
                        </button>

                        <p className="mt-8 text-xs" style={{color: 'var(--warm-gray)'}}>
                            Your data is stored securely and syncs across all your devices
                        </p>
                    </div>
                </div>
            );
        }

        // Loading Screen Component
        function LoadingScreen() {
            return (
                <div className="min-h-screen flex items-center justify-center" style={{background: 'var(--cream)'}}>
                    <div className="text-center">
                        <MangoLogo size={64} className="mx-auto mb-4" />
                        <div className="flex items-center justify-center space-x-2">
                            <i className="fas fa-spinner fa-spin text-2xl" style={{color: 'var(--mango-leaf)'}}></i>
                            <span className="font-semibold" style={{color: 'var(--charcoal)'}}>Loading your mangoes...</span>
                        </div>
                    </div>
                </div>
            );
        }

        // Utility functions
        const generateId = () => Math.random().toString(36).substr(2, 9);
        
        const formatDate = (date) => {
            if (!date) return '';
            return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        };

        const getDaysUntil = (date) => {
            if (!date) return null;
            const [year, month, day] = date.split('-').map(Number);
            const target = new Date(year, month - 1, day);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const diffTime = target - today;
            const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        };

        const isToday = (dateString) => {
            if (!dateString) return false;
            const [year, month, day] = dateString.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return date.getTime() === today.getTime();
        };

        const getTimeInMinutes = (timeEstimate) => {
            const map = { '5min': 5, '15min': 15, '30min': 30, '1hr': 60, '2hr': 120 };
            return map[timeEstimate] || 30;
        };

        const isYesterday = (dateString) => {
            if (!dateString) return false;
            const [year, month, day] = dateString.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            yesterday.setHours(0, 0, 0, 0);
            return date.getTime() === yesterday.getTime();
        };

        const isPastDate = (dateString) => {
            if (!dateString) return false;
            const [year, month, day] = dateString.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return date < today;
        };

        // Initial demo data
        const BRAIN_DUMP_BOARD_ID = 'brain-dump-board';
        const BRAIN_DUMP_GROUP_ID = 'brain-dump-group';
        const SOMEDAY_MAYBE_BOARD_ID = 'someday-maybe-board';
        const SOMEDAY_MAYBE_GROUP_ID = 'someday-maybe-group';
        
        const initialBoards = [
            {
                id: BRAIN_DUMP_BOARD_ID,
                name: 'Brain Dump',
                color: '#F4A259',
                isPinned: true,
                groups: [
                    {
                        id: BRAIN_DUMP_GROUP_ID,
                        name: 'Captured Thoughts',
                        color: '#F4A259',
                        tasks: []
                    }
                ]
            },
            {
                id: SOMEDAY_MAYBE_BOARD_ID,
                name: 'Someday / Maybe',
                color: '#a8c8d8',
                isPinned: true,
                groups: [
                    {
                        id: SOMEDAY_MAYBE_GROUP_ID,
                        name: 'Ideas & Possibilities',
                        color: '#a8c8d8',
                        tasks: []
                    }
                ]
            },
            {
                id: 'board1',
                name: 'Marketing Campaign',
                color: '#6B8E6B',
                groups: [
                    {
                        id: 'group1',
                        name: 'Planning',
                        color: '#A8B5A0',
                        tasks: [
                            {
                                id: 'task1',
                                name: 'Define campaign objectives',
                                status: 'done',
                                priority: 'high',
                                assignee: 'Sarah Johnson',
                                dueDate: new Date().toISOString().split('T')[0],
                                notes: 'Target Q1 2025 launch',
                                timeEstimate: '1hr',
                                energyLevel: 'high',
                                taskType: 'deep-work',
                                isFocusTask: false,
                                timeBlock: null
                            },
                            {
                                id: 'task2',
                                name: 'Market research',
                                status: 'working',
                                priority: 'medium',
                                assignee: 'Mike Chen',
                                dueDate: new Date().toISOString().split('T')[0],
                                notes: '',
                                timeEstimate: '2hr',
                                energyLevel: 'medium',
                                taskType: 'learning',
                                isFocusTask: true,
                                timeBlock: null
                            }
                        ]
                    },
                    {
                        id: 'group2',
                        name: 'Execution',
                        color: '#A8B5A0',
                        tasks: [
                            {
                                id: 'task3',
                                name: 'Design creative assets',
                                status: 'new',
                                priority: 'high',
                                assignee: 'Emily Davis',
                                dueDate: new Date().toISOString().split('T')[0],
                                notes: '',
                                timeEstimate: '15min',
                                energyLevel: 'high',
                                taskType: 'creative',
                                isFocusTask: true,
                                timeBlock: '09:00'
                            }
                        ]
                    }
                ]
            }
        ];

        const initialTeam = [
            { id: 'member1', name: 'Sarah Johnson', email: 'sarah@company.com', role: 'Project Manager', avatar: 'ðŸ‘©ðŸ½â€ðŸ’¼' },
            { id: 'member2', name: 'Mike Chen', email: 'mike@company.com', role: 'Developer', avatar: 'ðŸ‘¨ðŸ½â€ðŸ’»' },
            { id: 'member3', name: 'Emily Davis', email: 'emily@company.com', role: 'Designer', avatar: 'ðŸ‘©ðŸ½â€ðŸŽ¨' },
            { id: 'member4', name: 'John Smith', email: 'john@company.com', role: 'Marketing', avatar: 'ðŸ‘¨ðŸ½â€ðŸ’¼' }
        ];

        // Mobile Header Component
        function MobileHeader({ onMenuClick, user, unreadNotificationCount, onNotificationClick }) {
            return (
                <div className="mobile-header">
                    <div className="flex items-center space-x-3">
                        <button 
                            onClick={onMenuClick}
                            className="hamburger-btn"
                        >
                            <i className="fas fa-bars text-lg"></i>
                        </button>
                        <div className="flex items-center space-x-2">
                            <MangoLogo size={28} />
                            <span className="font-bold" style={{color: 'var(--charcoal)'}}>EveryMango</span>
                        </div>
                    </div>
                    <div className="flex items-center space-x-2">
                        <button
                            onClick={onNotificationClick}
                            className="relative p-2"
                            style={{color: unreadNotificationCount > 0 ? 'var(--ripe-mango)' : 'var(--warm-gray)'}}
                        >
                            <i className="fas fa-bell text-lg"></i>
                            {unreadNotificationCount > 0 && (
                                <span className="notification-badge absolute -top-1 -right-1 flex items-center justify-center rounded-full text-xs">
                                    {unreadNotificationCount > 9 ? '9+' : unreadNotificationCount}
                                </span>
                            )}
                        </button>
                        {user?.photoURL && (
                            <img src={user.photoURL} alt="" className="w-8 h-8 rounded-full" />
                        )}
                    </div>
                </div>
            );
        }

        // Mobile Task Card Component
        function MobileTaskCard({ task, boardId, groupId, team, updateTask, deleteTask, startPomodoro, activeTaskId, noJudgmentMode, sendToSomedayMaybe, rolloverTask }) {
            const [showActions, setShowActions] = useState(false);
            const [showDetails, setShowDetails] = useState(false);

            const statusOptions = [
                { value: 'new', label: 'New' },
                { value: 'working', label: 'Working' },
                { value: 'stuck', label: 'Stuck' },
                { value: 'done', label: 'Done' }
            ];

            const daysUntil = getDaysUntil(task.dueDate);
            const isQuickWin = task.timeEstimate === '5min' || task.timeEstimate === '15min';
            const isOverdue = daysUntil !== null && daysUntil < 0 && task.status !== 'done';

            return (
                <div className={`card-gentle shadow-soft p-4 mb-3 type-${task.taskType} ${task.status === 'done' ? 'opacity-60' : ''}`}>
                    {/* Main Row */}
                    <div className="flex items-start justify-between gap-3">
                        <div className="flex-1 min-w-0">
                            {/* Task Name */}
                            <div className="flex items-center gap-2 mb-2">
                                <button
                                    onClick={() => updateTask(boardId, groupId, task.id, { isFocusTask: !task.isFocusTask })}
                                    className={`text-lg ${task.isFocusTask ? '' : 'opacity-40'}`}
                                    style={{color: task.isFocusTask ? 'var(--ripe-mango)' : 'var(--warm-gray)'}}
                                >
                                    <i className="fas fa-star"></i>
                                </button>
                                <h4 
                                    className={`font-semibold text-sm flex-1 ${task.status === 'done' ? 'line-through' : ''}`}
                                    style={{color: 'var(--charcoal)'}}
                                    onClick={() => setShowDetails(!showDetails)}
                                >
                                    {task.name}
                                </h4>
                            </div>

                            {/* Badges Row */}
                            <div className="flex flex-wrap gap-2 mb-3">
                                <select
                                    value={task.status}
                                    onChange={(e) => updateTask(boardId, groupId, task.id, { status: e.target.value })}
                                    className={`status-${task.status} text-xs font-bold px-3 py-1.5 rounded-lg border-none`}
                                >
                                    {statusOptions.map(opt => (
                                        <option key={opt.value} value={opt.value}>{opt.label}</option>
                                    ))}
                                </select>
                                <span className="text-xs font-bold px-3 py-1.5 rounded-lg" style={{background: 'var(--sky)', color: 'var(--soft-black)'}}>
                                    {task.timeEstimate}
                                </span>
                                {isQuickWin && (
                                    <span className="quick-win-badge text-xs font-bold px-3 py-1.5 rounded-lg">
                                        <i className="fas fa-bolt mr-1"></i>Quick
                                    </span>
                                )}
                            </div>

                            {/* Due Date */}
                            {task.dueDate && (
                                <div className="flex items-center gap-2 text-xs">
                                    <span style={{color: isOverdue ? (noJudgmentMode ? 'var(--golden-flesh)' : 'var(--warm-red)') : 'var(--warm-gray)'}}>
                                        <i className="fas fa-calendar mr-1"></i>
                                        {formatDate(task.dueDate)}
                                        {daysUntil !== null && (
                                            <span className="ml-1">
                                                ({daysUntil < 0 
                                                    ? (noJudgmentMode ? `${Math.abs(daysUntil)}d ago ðŸ¥­` : `${Math.abs(daysUntil)}d overdue`)
                                                    : daysUntil === 0 
                                                    ? 'Today' 
                                                    : `${daysUntil}d`})
                                            </span>
                                        )}
                                    </span>
                                </div>
                            )}
                        </div>

                        {/* Quick Actions */}
                        <div className="flex flex-col gap-2">
                            <button
                                onClick={() => startPomodoro(task.id)}
                                className="w-10 h-10 rounded-xl flex items-center justify-center"
                                style={{background: activeTaskId === task.id ? 'var(--warm-red)' : 'var(--mango-leaf)', color: 'white'}}
                            >
                                <i className="fas fa-play"></i>
                            </button>
                            <button
                                onClick={() => setShowActions(!showActions)}
                                className="w-10 h-10 rounded-xl flex items-center justify-center"
                                style={{background: 'var(--linen)', color: 'var(--charcoal)'}}
                            >
                                <i className={`fas fa-${showActions ? 'times' : 'ellipsis-v'}`}></i>
                            </button>
                        </div>
                    </div>

                    {/* Expanded Actions */}
                    {showActions && (
                        <div className="mt-4 pt-4 border-t" style={{borderColor: 'var(--linen)'}}>
                            <div className="grid grid-cols-3 gap-2">
                                {isOverdue && (
                                    <>
                                        <button
                                            onClick={() => { rolloverTask(boardId, groupId, task.id); setShowActions(false); }}
                                            className="p-3 rounded-xl text-xs font-semibold flex flex-col items-center gap-1"
                                            style={{background: 'var(--golden-flesh)', color: 'var(--soft-black)'}}
                                        >
                                            <i className="fas fa-arrow-right"></i>
                                            Today
                                        </button>
                                        <button
                                            onClick={() => { sendToSomedayMaybe(boardId, groupId, task.id); setShowActions(false); }}
                                            className="p-3 rounded-xl text-xs font-semibold flex flex-col items-center gap-1"
                                            style={{background: 'var(--sky)', color: 'var(--soft-black)'}}
                                        >
                                            <i className="fas fa-cloud"></i>
                                            Someday
                                        </button>
                                    </>
                                )}
                                <button
                                    onClick={() => setShowDetails(!showDetails)}
                                    className="p-3 rounded-xl text-xs font-semibold flex flex-col items-center gap-1"
                                    style={{background: 'var(--linen)', color: 'var(--charcoal)'}}
                                >
                                    <i className="fas fa-edit"></i>
                                    Edit
                                </button>
                                <button
                                    onClick={() => {
                                        if (confirm('Delete this task?')) {
                                            deleteTask(boardId, groupId, task.id);
                                        }
                                    }}
                                    className="p-3 rounded-xl text-xs font-semibold flex flex-col items-center gap-1"
                                    style={{background: 'rgba(232, 93, 74, 0.1)', color: 'var(--warm-red)'}}
                                >
                                    <i className="fas fa-trash"></i>
                                    Delete
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Expanded Details */}
                    {showDetails && (
                        <div className="mt-4 pt-4 border-t space-y-4" style={{borderColor: 'var(--linen)'}}>
                            {/* Priority & Energy */}
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="text-xs font-bold mb-1 block" style={{color: 'var(--warm-gray)'}}>Priority</label>
                                    <select
                                        value={task.priority}
                                        onChange={(e) => updateTask(boardId, groupId, task.id, { priority: e.target.value })}
                                        className={`w-full px-3 py-2 rounded-xl text-sm font-bold priority-${task.priority} border-none`}
                                    >
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                        <option value="critical">Critical</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="text-xs font-bold mb-1 block" style={{color: 'var(--warm-gray)'}}>Energy</label>
                                    <select
                                        value={task.energyLevel}
                                        onChange={(e) => updateTask(boardId, groupId, task.id, { energyLevel: e.target.value })}
                                        className={`w-full px-3 py-2 rounded-xl text-sm font-bold energy-${task.energyLevel} border-none`}
                                    >
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>

                            {/* Assignee */}
                            <div>
                                <label className="text-xs font-bold mb-1 block" style={{color: 'var(--warm-gray)'}}>Assignee</label>
                                <select
                                    value={task.assignee}
                                    onChange={(e) => updateTask(boardId, groupId, task.id, { assignee: e.target.value })}
                                    className="w-full px-3 py-2 border-2 rounded-xl text-sm"
                                    style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                >
                                    <option value="">Unassigned</option>
                                    {team.map(member => (
                                        <option key={member.id} value={member.name}>
                                            {member.avatar} {member.name}
                                        </option>
                                    ))}
                                </select>
                            </div>

                            {/* Due Date */}
                            <div>
                                <label className="text-xs font-bold mb-1 block" style={{color: 'var(--warm-gray)'}}>Due Date</label>
                                <input
                                    type="date"
                                    value={task.dueDate}
                                    onChange={(e) => updateTask(boardId, groupId, task.id, { dueDate: e.target.value })}
                                    className="w-full px-3 py-2 border-2 rounded-xl text-sm"
                                    style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                />
                            </div>

                            {/* Notes */}
                            <div>
                                <label className="text-xs font-bold mb-1 block" style={{color: 'var(--warm-gray)'}}>Notes</label>
                                <textarea
                                    value={task.notes || ''}
                                    onChange={(e) => updateTask(boardId, groupId, task.id, { notes: e.target.value })}
                                    placeholder="Add notes..."
                                    className="w-full px-3 py-2 border-2 rounded-xl text-sm"
                                    style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                    rows="2"
                                />
                            </div>

                            {/* Why It Matters */}
                            <div className="why-matters-field p-3">
                                <label className="text-xs font-bold mb-1 block" style={{color: 'var(--ripe-mango)'}}>
                                    <i className="fas fa-heart mr-1"></i>Why This Matters
                                </label>
                                <textarea
                                    value={task.whyItMatters || ''}
                                    onChange={(e) => updateTask(boardId, groupId, task.id, { whyItMatters: e.target.value })}
                                    placeholder="Connect to your motivation..."
                                    className="w-full px-3 py-2 border-2 rounded-xl text-sm bg-white"
                                    style={{borderColor: 'var(--ripe-mango)', color: 'var(--charcoal)'}}
                                    rows="2"
                                />
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Main App Component
        function App() {
            // Authentication state
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);

            // Listen for auth state changes
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((firebaseUser) => {
                    setUser(firebaseUser);
                    setAuthLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const [boards, setBoards] = useState(initialBoards);
            const [dataLoaded, setDataLoaded] = useState(false);
            
            const [team, setTeam] = useState(initialTeam);
            
            const [activeBoard, setActiveBoard] = useState(boards[0]?.id);
            const [view, setView] = useState('board');
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [mobileSidebarOpen, setMobileSidebarOpen] = useState(false);
            const [focusMode, setFocusMode] = useState(false);
            const [quickWinsOnly, setQuickWinsOnly] = useState(false);
            const [energyFilter, setEnergyFilter] = useState(null);
            const [brainDumpText, setBrainDumpText] = useState('');
            const [recentlyViewed, setRecentlyViewed] = useState(() => {
                const saved = localStorage.getItem('everyMangoRecentlyViewed');
                return saved ? JSON.parse(saved) : [];
            });
            const [showContextModal, setShowContextModal] = useState(false);
            const [contextTask, setContextTask] = useState(null);
            const [noJudgmentMode, setNoJudgmentMode] = useState(() => {
                const saved = localStorage.getItem('everyMangoNoJudgmentMode');
                return saved ? JSON.parse(saved) : false;
            });
            const [notifications, setNotifications] = useState(() => {
                const saved = localStorage.getItem('everyMangoNotifications');
                return saved ? JSON.parse(saved) : [];
            });
            const [showNotificationPanel, setShowNotificationPanel] = useState(false);
            const [toasts, setToasts] = useState([]);
            const [notificationsEnabled, setNotificationsEnabled] = useState(() => {
                const saved = localStorage.getItem('everyMangoNotificationsEnabled');
                return saved ? JSON.parse(saved) : true;
            });
            const [pomodoroActive, setPomodoroActive] = useState(false);
            const [pomodoroTime, setPomodoroTime] = useState(25 * 60);
            const [isBreak, setIsBreak] = useState(false);
            const [activeTaskId, setActiveTaskId] = useState(null);

            // Load data from Firestore when user logs in
            useEffect(() => {
                if (!user) {
                    setDataLoaded(false);
                    return;
                }

                const loadUserData = async () => {
                    try {
                        // Load boards
                        const boardsDoc = await db.collection('users').doc(user.uid).collection('data').doc('boards').get();
                        if (boardsDoc.exists) {
                            const loadedBoards = boardsDoc.data().boards;
                            let processedBoards = loadedBoards.map(board => ({
                                ...board,
                                groups: board.groups.map(group => ({
                                    ...group,
                                    tasks: group.tasks.map(task => ({
                                        timeEstimate: '30min',
                                        energyLevel: 'medium',
                                        taskType: 'admin',
                                        isFocusTask: false,
                                        timeBlock: null,
                                        contextNotes: '',
                                        rolloverCount: 0,
                                        whyItMatters: '',
                                        reminderTime: null,
                                        ...task
                                    }))
                                }))
                            }));
                            
                            if (!processedBoards.some(b => b.id === 'brain-dump-board')) {
                                processedBoards = [initialBoards[0], ...processedBoards];
                            }
                            if (!processedBoards.some(b => b.id === 'someday-maybe-board')) {
                                const brainDumpIndex = processedBoards.findIndex(b => b.id === 'brain-dump-board');
                                processedBoards.splice(brainDumpIndex + 1, 0, initialBoards[1]);
                            }
                            
                            setBoards(processedBoards);
                        }

                        const teamDoc = await db.collection('users').doc(user.uid).collection('data').doc('team').get();
                        if (teamDoc.exists) {
                            setTeam(teamDoc.data().team);
                        }

                        setDataLoaded(true);
                    } catch (error) {
                        console.error('Error loading data from Firestore:', error);
                        setDataLoaded(true);
                    }
                };

                loadUserData();
            }, [user]);

            // Save boards to Firestore when they change
            useEffect(() => {
                if (!user || !dataLoaded) return;
                
                const saveBoards = async () => {
                    try {
                        await db.collection('users').doc(user.uid).collection('data').doc('boards').set({
                            boards: boards,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } catch (error) {
                        console.error('Error saving boards:', error);
                    }
                };

                const timeoutId = setTimeout(saveBoards, 1000);
                return () => clearTimeout(timeoutId);
            }, [boards, user, dataLoaded]);

            // Save team to Firestore when it changes
            useEffect(() => {
                if (!user || !dataLoaded) return;
                
                const saveTeam = async () => {
                    try {
                        await db.collection('users').doc(user.uid).collection('data').doc('team').set({
                            team: team,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } catch (error) {
                        console.error('Error saving team:', error);
                    }
                };

                const timeoutId = setTimeout(saveTeam, 1000);
                return () => clearTimeout(timeoutId);
            }, [team, user, dataLoaded]);

            useEffect(() => {
                localStorage.setItem('everyMangoNoJudgmentMode', JSON.stringify(noJudgmentMode));
            }, [noJudgmentMode]);

            useEffect(() => {
                localStorage.setItem('everyMangoNotifications', JSON.stringify(notifications));
            }, [notifications]);

            useEffect(() => {
                localStorage.setItem('everyMangoNotificationsEnabled', JSON.stringify(notificationsEnabled));
            }, [notificationsEnabled]);

            useEffect(() => {
                localStorage.setItem('everyMangoRecentlyViewed', JSON.stringify(recentlyViewed));
            }, [recentlyViewed]);

            useEffect(() => {
                let interval;
                if (pomodoroActive && pomodoroTime > 0) {
                    interval = setInterval(() => {
                        setPomodoroTime(time => time - 1);
                    }, 1000);
                } else if (pomodoroTime === 0) {
                    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZSA0PVqzn7a1aFgpBm+H0wXEkBS+E0PLaizsIGGS57eicTgwMUrDk7bBdGApDneH0xHEmBSyB0PLdizgIG2i98Oah');
                    audio.play().catch(() => {});
                    
                    if (isBreak) {
                        setPomodoroTime(25 * 60);
                        setIsBreak(false);
                        setPomodoroActive(false);
                    } else {
                        setPomodoroTime(5 * 60);
                        setIsBreak(true);
                    }
                }
                return () => clearInterval(interval);
            }, [pomodoroActive, pomodoroTime, isBreak]);

            const currentBoard = boards.find(b => b.id === activeBoard);

            const addBoard = () => {
                const newGroupId = generateId();
                const newTaskId = generateId();
                const newBoard = {
                    id: generateId(),
                    name: 'New Board',
                    color: '#6B8E6B',
                    groups: [{
                        id: newGroupId,
                        name: 'New Group',
                        color: '#A8B5A0',
                        tasks: [{
                            id: newTaskId,
                            name: 'New Task',
                            status: 'new',
                            priority: 'medium',
                            assignee: '',
                            dueDate: '',
                            notes: '',
                            timeEstimate: '30min',
                            energyLevel: 'medium',
                            taskType: 'admin',
                            isFocusTask: false,
                            timeBlock: null,
                            contextNotes: '',
                            rolloverCount: 0,
                            whyItMatters: '',
                            reminderTime: null
                        }]
                    }]
                };
                setBoards([...boards, newBoard]);
                setActiveBoard(newBoard.id);
            };

            const updateBoard = (boardId, updates) => {
                setBoards(boards.map(b => b.id === boardId ? { ...b, ...updates } : b));
            };

            const deleteBoard = (boardId) => {
                if (boardId === BRAIN_DUMP_BOARD_ID || boardId === SOMEDAY_MAYBE_BOARD_ID) {
                    alert('System boards cannot be deleted');
                    return;
                }
                if (boards.filter(b => b.id !== BRAIN_DUMP_BOARD_ID && b.id !== SOMEDAY_MAYBE_BOARD_ID).length === 1) {
                    alert('You must have at least one board');
                    return;
                }
                setBoards(boards.filter(b => b.id !== boardId));
                if (activeBoard === boardId) {
                    setActiveBoard(boards.find(b => b.id !== boardId)?.id);
                }
            };

            const addGroup = (boardId) => {
                const newTaskId = generateId();
                const newGroup = {
                    id: generateId(),
                    name: 'New Group',
                    color: '#A8B5A0',
                    tasks: [{
                        id: newTaskId,
                        name: 'New Task',
                        status: 'new',
                        priority: 'medium',
                        assignee: '',
                        dueDate: '',
                        notes: '',
                        timeEstimate: '30min',
                        energyLevel: 'medium',
                        taskType: 'admin',
                        isFocusTask: false,
                        timeBlock: null,
                        contextNotes: '',
                        rolloverCount: 0,
                        whyItMatters: '',
                        reminderTime: null
                    }]
                };
                setBoards(boards.map(b => 
                    b.id === boardId ? { ...b, groups: [...b.groups, newGroup] } : b
                ));
            };

            const updateGroup = (boardId, groupId, updates) => {
                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.map(g => g.id === groupId ? { ...g, ...updates } : g)
                    } : b
                ));
            };

            const deleteGroup = (boardId, groupId) => {
                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.filter(g => g.id !== groupId)
                    } : b
                ));
            };

            const addTask = (boardId, groupId, taskData = {}) => {
                const newTask = {
                    id: generateId(),
                    name: taskData.name || 'New Task',
                    status: 'new',
                    priority: 'medium',
                    assignee: '',
                    dueDate: '',
                    notes: '',
                    timeEstimate: '30min',
                    energyLevel: 'medium',
                    taskType: 'admin',
                    isFocusTask: false,
                    timeBlock: null,
                    contextNotes: '',
                    rolloverCount: 0,
                    whyItMatters: '',
                    reminderTime: null,
                    ...taskData
                };
                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.map(g => 
                            g.id === groupId ? { ...g, tasks: [...g.tasks, newTask] } : g
                        )
                    } : b
                ));
            };

            const updateTask = (boardId, groupId, taskId, updates) => {
                if (updates.status === 'stuck') {
                    setContextTask({ boardId, groupId, taskId });
                    setShowContextModal(true);
                }

                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.map(g => 
                            g.id === groupId ? {
                                ...g,
                                tasks: g.tasks.map(t => t.id === taskId ? { ...t, ...updates } : t)
                            } : g
                        )
                    } : b
                ));

                if (updates.status || updates.notes || updates.contextNotes) {
                    trackRecentlyViewed(boardId, groupId, taskId);
                }
            };

            const deleteTask = (boardId, groupId, taskId) => {
                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.map(g => 
                            g.id === groupId ? {
                                ...g,
                                tasks: g.tasks.filter(t => t.id !== taskId)
                            } : g
                        )
                    } : b
                ));
                setRecentlyViewed(recentlyViewed.filter(rv => rv.taskId !== taskId));
            };

            const moveTask = (fromBoardId, fromGroupId, taskId, toBoardId, toGroupId) => {
                let taskToMove = null;
                boards.forEach(board => {
                    if (board.id === fromBoardId) {
                        board.groups.forEach(group => {
                            if (group.id === fromGroupId) {
                                taskToMove = group.tasks.find(t => t.id === taskId);
                            }
                        });
                    }
                });

                if (!taskToMove) return;

                setBoards(boards.map(board => {
                    if (board.id === fromBoardId) {
                        return {
                            ...board,
                            groups: board.groups.map(group => 
                                group.id === fromGroupId 
                                    ? { ...group, tasks: group.tasks.filter(t => t.id !== taskId) }
                                    : group
                            )
                        };
                    } else if (board.id === toBoardId) {
                        return {
                            ...board,
                            groups: board.groups.map(group => 
                                group.id === toGroupId 
                                    ? { ...group, tasks: [...group.tasks, taskToMove] }
                                    : group
                            )
                        };
                    }
                    return board;
                }));
            };

            const sendToSomedayMaybe = (fromBoardId, fromGroupId, taskId) => {
                const somedayBoard = boards.find(b => b.id === SOMEDAY_MAYBE_BOARD_ID);
                if (somedayBoard && somedayBoard.groups[0]) {
                    moveTask(fromBoardId, fromGroupId, taskId, somedayBoard.id, somedayBoard.groups[0].id);
                }
            };

            const rolloverTask = (boardId, groupId, taskId) => {
                const today = new Date().toISOString().split('T')[0];
                setBoards(boards.map(board => 
                    board.id === boardId ? {
                        ...board,
                        groups: board.groups.map(group => 
                            group.id === groupId ? {
                                ...group,
                                tasks: group.tasks.map(task => 
                                    task.id === taskId ? {
                                        ...task,
                                        dueDate: today,
                                        rolloverCount: (task.rolloverCount || 0) + 1,
                                        lastRolloverDate: today
                                    } : task
                                )
                            } : group
                        )
                    } : board
                ));
            };

            const rolloverAllOverdue = () => {
                const today = new Date().toISOString().split('T')[0];
                setBoards(boards.map(board => ({
                    ...board,
                    groups: board.groups.map(group => ({
                        ...group,
                        tasks: group.tasks.map(task => {
                            if (task.dueDate && isPastDate(task.dueDate) && task.status !== 'done') {
                                return {
                                    ...task,
                                    dueDate: today,
                                    rolloverCount: (task.rolloverCount || 0) + 1,
                                    lastRolloverDate: today
                                };
                            }
                            return task;
                        })
                    }))
                })));
            };

            const overdueTaskCount = useMemo(() => {
                let count = 0;
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            if (task.dueDate && isPastDate(task.dueDate) && task.status !== 'done') {
                                count++;
                            }
                        });
                    });
                });
                return count;
            }, [boards]);

            const addNotification = (notification) => {
                const newNotification = {
                    id: generateId(),
                    timestamp: Date.now(),
                    read: false,
                    ...notification
                };
                setNotifications(prev => [newNotification, ...prev].slice(0, 50));
                
                if (notificationsEnabled) {
                    showToast(notification);
                }
            };

            const showToast = (notification) => {
                const toastId = generateId();
                const toast = { id: toastId, ...notification };
                setToasts(prev => [...prev, toast]);
                
                setTimeout(() => {
                    setToasts(prev => prev.filter(t => t.id !== toastId));
                }, 5000);
            };

            const dismissToast = (toastId) => {
                setToasts(prev => prev.filter(t => t.id !== toastId));
            };

            const markNotificationRead = (notificationId) => {
                setNotifications(prev => 
                    prev.map(n => n.id === notificationId ? { ...n, read: true } : n)
                );
            };

            const markAllNotificationsRead = () => {
                setNotifications(prev => prev.map(n => ({ ...n, read: true })));
            };

            const clearAllNotifications = () => {
                setNotifications([]);
            };

            const unreadNotificationCount = useMemo(() => {
                return notifications.filter(n => !n.read).length;
            }, [notifications]);

            useEffect(() => {
                if (!notificationsEnabled) return;

                const checkReminders = () => {
                    const now = new Date();
                    const today = now.toISOString().split('T')[0];
                    const currentHour = now.getHours();

                    boards.forEach(board => {
                        if (board.id === 'brain-dump-board' || board.id === 'someday-maybe-board') return;

                        board.groups.forEach(group => {
                            group.tasks.forEach(task => {
                                if (task.status === 'done') return;

                                const daysUntil = getDaysUntil(task.dueDate);
                                
                                if (task.dueDate && !task.lastRemindedDate?.startsWith(today)) {
                                    let shouldRemind = false;
                                    let reminderType = '';
                                    let reminderMessage = '';

                                    if (daysUntil === 0 && currentHour >= 8 && currentHour <= 10) {
                                        shouldRemind = true;
                                        reminderType = 'due-today';
                                        reminderMessage = `"${task.name}" is due today!`;
                                    }
                                    else if (daysUntil === 1 && currentHour >= 14 && currentHour <= 16) {
                                        shouldRemind = true;
                                        reminderType = 'due-tomorrow';
                                        reminderMessage = `"${task.name}" is due tomorrow`;
                                    }
                                    else if (task.reminderTime) {
                                        const [reminderHour] = task.reminderTime.split(':').map(Number);
                                        if (daysUntil === 0 && currentHour === reminderHour) {
                                            shouldRemind = true;
                                            reminderType = 'custom-reminder';
                                            reminderMessage = `Reminder: "${task.name}"`;
                                        }
                                    }

                                    if (shouldRemind) {
                                        const existingToday = notifications.find(n => 
                                            n.taskId === task.id && 
                                            n.type === reminderType &&
                                            new Date(n.timestamp).toDateString() === now.toDateString()
                                        );

                                        if (!existingToday) {
                                            addNotification({
                                                type: reminderType,
                                                taskId: task.id,
                                                taskName: task.name,
                                                boardName: board.name,
                                                message: reminderMessage,
                                                whyItMatters: task.whyItMatters,
                                                icon: daysUntil === 0 ? 'fa-exclamation-circle' : 'fa-clock',
                                                color: daysUntil === 0 ? '#F8C56D' : '#a8c8d8'
                                            });
                                        }
                                    }
                                }
                            });
                        });
                    });
                };

                checkReminders();
                const interval = setInterval(checkReminders, 60000);
                return () => clearInterval(interval);
            }, [boards, notificationsEnabled]);

            const addTeamMember = (member) => {
                setTeam([...team, { ...member, id: generateId() }]);
            };

            const updateTeamMember = (memberId, updates) => {
                setTeam(team.map(m => m.id === memberId ? { ...m, ...updates } : m));
            };

            const deleteTeamMember = (memberId) => {
                setTeam(team.filter(m => m.id !== memberId));
            };

            const startPomodoro = (taskId) => {
                setActiveTaskId(taskId);
                setPomodoroActive(true);
                setIsBreak(false);
                setPomodoroTime(25 * 60);
                
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        const task = group.tasks.find(t => t.id === taskId);
                        if (task) {
                            updateTask(board.id, group.id, taskId, { status: 'working' });
                        }
                    });
                });
            };

            const stopPomodoro = () => {
                setPomodoroActive(false);
                setActiveTaskId(null);
            };

            const handleSignOut = async () => {
                try {
                    await auth.signOut();
                    setBoards(initialBoards);
                    setTeam(initialTeam);
                    setDataLoaded(false);
                } catch (error) {
                    console.error('Sign out error:', error);
                }
            };

            const handleBrainDump = () => {
                if (!brainDumpText.trim()) return;

                let brainDumpBoard = boards.find(b => b.id === 'brain-dump-board');
                
                if (brainDumpBoard) {
                    let targetGroup = brainDumpBoard.groups[0];
                    
                    if (targetGroup) {
                        addTask(brainDumpBoard.id, targetGroup.id, {
                            name: brainDumpText,
                            priority: 'medium',
                            status: 'new',
                            dueDate: new Date().toISOString().split('T')[0]
                        });
                    }
                    
                    setActiveBoard(brainDumpBoard.id);
                    setView('board');
                }

                setBrainDumpText('');
            };

            const trackRecentlyViewed = (boardId, groupId, taskId) => {
                const task = boards.find(b => b.id === boardId)
                    ?.groups.find(g => g.id === groupId)
                    ?.tasks.find(t => t.id === taskId);
                
                if (!task) return;

                const viewedItem = {
                    taskId,
                    boardId,
                    groupId,
                    taskName: task.name,
                    timestamp: Date.now()
                };

                setRecentlyViewed(prev => {
                    const filtered = prev.filter(item => item.taskId !== taskId);
                    return [viewedItem, ...filtered].slice(0, 5);
                });
            };

            // Export function
            const exportData = (format = 'json') => {
                const exportBoards = boards.map(board => ({
                    name: board.name,
                    groups: board.groups.map(group => ({
                        name: group.name,
                        tasks: group.tasks.map(task => ({
                            name: task.name,
                            status: task.status,
                            priority: task.priority,
                            assignee: task.assignee,
                            dueDate: task.dueDate,
                            timeEstimate: task.timeEstimate,
                            energyLevel: task.energyLevel,
                            taskType: task.taskType,
                            notes: task.notes,
                            whyItMatters: task.whyItMatters
                        }))
                    }))
                }));

                if (format === 'json') {
                    const dataStr = JSON.stringify(exportBoards, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `everymango-export-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                } else if (format === 'csv') {
                    const rows = [['Board', 'Group', 'Task', 'Status', 'Priority', 'Assignee', 'Due Date', 'Time Estimate', 'Energy', 'Type', 'Notes']];
                    exportBoards.forEach(board => {
                        board.groups.forEach(group => {
                            group.tasks.forEach(task => {
                                rows.push([
                                    board.name,
                                    group.name,
                                    task.name,
                                    task.status,
                                    task.priority,
                                    task.assignee || '',
                                    task.dueDate || '',
                                    task.timeEstimate,
                                    task.energyLevel,
                                    task.taskType,
                                    (task.notes || '').replace(/"/g, '""')
                                ]);
                            });
                        });
                    });
                    const csv = rows.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `everymango-export-${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            };

            if (authLoading) {
                return <LoadingScreen />;
            }

            if (!user) {
                return <LoginScreen />;
            }

            return (
                <div className={`flex h-screen overflow-hidden ${noJudgmentMode ? 'no-judgment-mode' : ''}`} style={{background: 'var(--cream)'}}>
                    {/* Mobile Header */}
                    <MobileHeader 
                        onMenuClick={() => setMobileSidebarOpen(true)}
                        user={user}
                        unreadNotificationCount={unreadNotificationCount}
                        onNotificationClick={() => setShowNotificationPanel(!showNotificationPanel)}
                    />

                    {/* Mobile Sidebar Overlay */}
                    <div 
                        className={`sidebar-overlay ${mobileSidebarOpen ? 'active' : ''}`}
                        onClick={() => setMobileSidebarOpen(false)}
                    ></div>

                    {/* Mobile Sidebar */}
                    <aside className={`sidebar-mobile sidebar-gentle ${mobileSidebarOpen ? 'open' : ''}`}>
                        <Sidebar 
                            boards={boards}
                            activeBoard={activeBoard}
                            setActiveBoard={(id) => { setActiveBoard(id); setMobileSidebarOpen(false); }}
                            addBoard={addBoard}
                            view={view}
                            setView={(v) => { setView(v); setMobileSidebarOpen(false); }}
                            sidebarOpen={true}
                            setSidebarOpen={() => {}}
                            pomodoroActive={pomodoroActive}
                            pomodoroTime={pomodoroTime}
                            isBreak={isBreak}
                            stopPomodoro={stopPomodoro}
                            recentlyViewed={recentlyViewed}
                            overdueTaskCount={overdueTaskCount}
                            rolloverAllOverdue={rolloverAllOverdue}
                            user={user}
                            onSignOut={handleSignOut}
                            onClose={() => setMobileSidebarOpen(false)}
                            exportData={exportData}
                            isMobile={true}
                        />
                    </aside>

                    {/* Desktop Sidebar */}
                    <aside className="desktop-sidebar">
                        <Sidebar 
                            boards={boards}
                            activeBoard={activeBoard}
                            setActiveBoard={setActiveBoard}
                            addBoard={addBoard}
                            view={view}
                            setView={setView}
                            sidebarOpen={sidebarOpen}
                            setSidebarOpen={setSidebarOpen}
                            pomodoroActive={pomodoroActive}
                            pomodoroTime={pomodoroTime}
                            isBreak={isBreak}
                            stopPomodoro={stopPomodoro}
                            recentlyViewed={recentlyViewed}
                            overdueTaskCount={overdueTaskCount}
                            rolloverAllOverdue={rolloverAllOverdue}
                            user={user}
                            onSignOut={handleSignOut}
                            exportData={exportData}
                            isMobile={false}
                        />
                    </aside>

                    <main className="flex-1 overflow-hidden flex flex-col main-content">
                        {/* Brain Dump Bar */}
                        <div className="glass-effect border-b px-4 md:px-8 py-4 brain-dump-bar" style={{borderColor: 'var(--linen)'}}>
                            <div className="flex items-center space-x-4 brain-dump-input-row">
                                <div className="flex items-center space-x-2 flex-shrink-0" style={{color: 'var(--ripe-mango)'}}>
                                    <i className="fas fa-brain text-lg"></i>
                                    <span className="text-sm font-bold hidden sm:inline" style={{color: 'var(--charcoal)'}}>Brain Dump</span>
                                </div>
                                <input
                                    type="text"
                                    value={brainDumpText}
                                    onChange={(e) => setBrainDumpText(e.target.value)}
                                    onKeyDown={(e) => {
                                        if (e.key === 'Enter') handleBrainDump();
                                    }}
                                    placeholder="Capture any thought... (Enter)"
                                    className="flex-1 px-4 py-3 border-2 rounded-2xl text-sm brain-dump-active"
                                    style={{borderColor: 'var(--ripe-mango)', background: 'white', color: 'var(--charcoal)'}}
                                />
                                <button
                                    onClick={handleBrainDump}
                                    disabled={!brainDumpText.trim()}
                                    className="px-4 py-3 rounded-2xl text-white font-semibold transition-all disabled:opacity-50 flex-shrink-0"
                                    style={{background: 'var(--ripe-mango)', color: 'var(--soft-black)'}}
                                >
                                    <i className="fas fa-plus md:mr-2"></i>
                                    <span className="hidden md:inline">Capture</span>
                                </button>
                            </div>

                            {/* Toggle Controls */}
                            <div className="flex items-center space-x-4 md:space-x-6 toggle-controls">
                                {/* Gentle Mode Toggle */}
                                <div className="flex items-center space-x-2">
                                    <span className="text-xs md:text-sm font-semibold" style={{color: noJudgmentMode ? 'var(--mango-leaf)' : 'var(--warm-gray)'}}>
                                        <i className="fas fa-heart mr-1"></i>
                                        <span className="hidden sm:inline">Gentle</span>
                                    </span>
                                    <button
                                        onClick={() => setNoJudgmentMode(!noJudgmentMode)}
                                        className="toggle-track relative w-11 h-6 rounded-full transition-all"
                                        style={{background: noJudgmentMode ? 'var(--mango-leaf)' : 'var(--linen)'}}
                                    >
                                        <span 
                                            className="toggle-thumb absolute top-0.5 w-5 h-5 bg-white rounded-full shadow-soft"
                                            style={{left: noJudgmentMode ? '22px' : '2px'}}
                                        ></span>
                                    </button>
                                </div>

                                {/* Focus Mode Toggle */}
                                <div className="flex items-center space-x-2">
                                    <span className="text-xs md:text-sm font-semibold" style={{color: focusMode ? 'var(--mango-leaf)' : 'var(--warm-gray)'}}>
                                        <i className={`fas fa-eye${focusMode ? '' : '-slash'} mr-1`}></i>
                                        <span className="hidden sm:inline">Focus</span>
                                    </span>
                                    <button
                                        onClick={() => setFocusMode(!focusMode)}
                                        className="toggle-track relative w-11 h-6 rounded-full transition-all"
                                        style={{background: focusMode ? 'var(--mango-leaf)' : 'var(--linen)'}}
                                    >
                                        <span 
                                            className="toggle-thumb absolute top-0.5 w-5 h-5 bg-white rounded-full shadow-soft"
                                            style={{left: focusMode ? '22px' : '2px'}}
                                        ></span>
                                    </button>
                                </div>

                                {/* Desktop Notification Bell */}
                                <div className="relative hidden md:block">
                                    <button
                                        onClick={() => setShowNotificationPanel(!showNotificationPanel)}
                                        className={`p-3 rounded-2xl transition-all ${showNotificationPanel ? '' : 'hover:bg-white hover:bg-opacity-50'} ${unreadNotificationCount > 0 ? 'bell-ringing' : ''}`}
                                        style={{background: showNotificationPanel ? 'var(--sage-light)' : 'transparent'}}
                                    >
                                        <i className={`fas fa-bell text-lg`} style={{color: unreadNotificationCount > 0 ? 'var(--ripe-mango)' : 'var(--warm-gray)'}}></i>
                                        {unreadNotificationCount > 0 && (
                                            <span className="notification-badge absolute -top-1 -right-1 flex items-center justify-center rounded-full">
                                                {unreadNotificationCount > 9 ? '9+' : unreadNotificationCount}
                                            </span>
                                        )}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {view === 'board' && currentBoard && (
                            <BoardView 
                                board={currentBoard}
                                team={team}
                                updateBoard={updateBoard}
                                deleteBoard={deleteBoard}
                                addGroup={addGroup}
                                updateGroup={updateGroup}
                                deleteGroup={deleteGroup}
                                addTask={addTask}
                                updateTask={updateTask}
                                deleteTask={deleteTask}
                                moveTask={moveTask}
                                allBoards={boards}
                                focusMode={focusMode}
                                quickWinsOnly={quickWinsOnly}
                                setQuickWinsOnly={setQuickWinsOnly}
                                energyFilter={energyFilter}
                                setEnergyFilter={setEnergyFilter}
                                startPomodoro={startPomodoro}
                                activeTaskId={activeTaskId}
                                noJudgmentMode={noJudgmentMode}
                                sendToSomedayMaybe={sendToSomedayMaybe}
                                rolloverTask={rolloverTask}
                            />
                        )}
                        {view === 'timeblocking' && (
                            <TimeBlockingView 
                                boards={boards}
                                updateTask={updateTask}
                                startPomodoro={startPomodoro}
                                activeTaskId={activeTaskId}
                            />
                        )}
                        {view === 'timeline' && (
                            <TimelineView boards={boards} />
                        )}
                        {view === 'team' && (
                            <TeamView 
                                team={team}
                                addTeamMember={addTeamMember}
                                updateTeamMember={updateTeamMember}
                                deleteTeamMember={deleteTeamMember}
                            />
                        )}
                        {view === 'dashboard' && (
                            <DashboardView boards={boards} team={team} />
                        )}
                    </main>

                    {/* Notification Panel */}
                    <NotificationPanel
                        notifications={notifications}
                        showPanel={showNotificationPanel}
                        setShowPanel={setShowNotificationPanel}
                        markNotificationRead={markNotificationRead}
                        markAllNotificationsRead={markAllNotificationsRead}
                        clearAllNotifications={clearAllNotifications}
                        notificationsEnabled={notificationsEnabled}
                        setNotificationsEnabled={setNotificationsEnabled}
                    />

                    {/* Toast Container */}
                    <div className="fixed bottom-6 right-6 left-6 md:left-auto z-50 space-y-3 toast-container">
                        {toasts.map(toast => (
                            <Toast key={toast.id} toast={toast} onDismiss={() => dismissToast(toast.id)} />
                        ))}
                    </div>
                </div>
            );
        }

        // Notification Panel Component
        function NotificationPanel({ notifications, showPanel, setShowPanel, markNotificationRead, markAllNotificationsRead, clearAllNotifications, notificationsEnabled, setNotificationsEnabled }) {
            if (!showPanel) return null;

            const formatTimeAgo = (timestamp) => {
                const seconds = Math.floor((Date.now() - timestamp) / 1000);
                if (seconds < 60) return 'Just now';
                const minutes = Math.floor(seconds / 60);
                if (minutes < 60) return `${minutes}m ago`;
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `${hours}h ago`;
                const days = Math.floor(hours / 24);
                return `${days}d ago`;
            };

            const getNotificationIcon = (notification) => {
                switch (notification.type) {
                    case 'due-today': return { icon: 'fa-exclamation-circle', color: 'var(--golden-flesh)' };
                    case 'due-tomorrow': return { icon: 'fa-clock', color: 'var(--sky)' };
                    case 'custom-reminder': return { icon: 'fa-bell', color: 'var(--ripe-mango)' };
                    case 'overdue': return { icon: 'fa-exclamation-triangle', color: 'var(--warm-red)' };
                    default: return { icon: 'fa-info-circle', color: 'var(--warm-gray)' };
                }
            };

            return (
                <div 
                    className="fixed inset-0 z-40"
                    onClick={() => setShowPanel(false)}
                >
                    <div 
                        className="notification-panel absolute right-2 md:right-6 top-16 md:top-24 w-auto md:w-96 max-h-[70vh] overflow-hidden"
                        onClick={(e) => e.stopPropagation()}
                    >
                        {/* Header */}
                        <div className="p-4 md:p-5 border-b flex items-center justify-between" style={{borderColor: 'var(--linen)', background: 'var(--cream-dark)'}}>
                            <h3 className="font-bold text-base md:text-lg" style={{color: 'var(--charcoal)'}}>
                                <i className="fas fa-bell mr-2" style={{color: 'var(--ripe-mango)'}}></i>
                                Notifications
                            </h3>
                            <div className="flex items-center space-x-2">
                                <button
                                    onClick={() => setNotificationsEnabled(!notificationsEnabled)}
                                    className="p-2 rounded-xl transition-all"
                                    style={{color: notificationsEnabled ? 'var(--mango-leaf)' : 'var(--warm-gray)', background: notificationsEnabled ? 'var(--sage-light)' : 'transparent'}}
                                >
                                    <i className={`fas ${notificationsEnabled ? 'fa-volume-up' : 'fa-volume-mute'}`}></i>
                                </button>
                                <button
                                    onClick={() => setShowPanel(false)}
                                    className="p-2 rounded-xl transition-all hover:bg-white"
                                    style={{color: 'var(--warm-gray)'}}
                                >
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>
                        </div>

                        {/* Actions */}
                        {notifications.length > 0 && (
                            <div className="px-4 md:px-5 py-3 border-b flex items-center justify-between" style={{borderColor: 'var(--linen)'}}>
                                <button
                                    onClick={markAllNotificationsRead}
                                    className="text-xs md:text-sm font-semibold transition-all hover:opacity-70"
                                    style={{color: 'var(--mango-leaf)'}}
                                >
                                    Mark all read
                                </button>
                                <button
                                    onClick={clearAllNotifications}
                                    className="text-xs md:text-sm font-semibold transition-all hover:opacity-70"
                                    style={{color: 'var(--warm-gray)'}}
                                >
                                    Clear all
                                </button>
                            </div>
                        )}

                        {/* Notification List */}
                        <div className="overflow-y-auto max-h-[50vh] scrollbar-thin">
                            {notifications.length === 0 ? (
                                <div className="p-8 md:p-10 text-center">
                                    <i className="fas fa-bell-slash text-4xl md:text-5xl mb-4 opacity-20" style={{color: 'var(--warm-gray)'}}></i>
                                    <p className="font-semibold text-sm" style={{color: 'var(--warm-gray)'}}>No notifications yet</p>
                                </div>
                            ) : (
                                notifications.map(notification => {
                                    const iconInfo = getNotificationIcon(notification);
                                    return (
                                        <div
                                            key={notification.id}
                                            className={`notification-item p-4 md:p-5 border-b cursor-pointer ${!notification.read ? 'unread' : ''}`}
                                            style={{borderColor: 'var(--linen)'}}
                                            onClick={() => markNotificationRead(notification.id)}
                                        >
                                            <div className="flex items-start space-x-3 md:space-x-4">
                                                <div 
                                                    className="w-10 h-10 md:w-11 md:h-11 rounded-2xl flex items-center justify-center flex-shrink-0"
                                                    style={{background: iconInfo.color}}
                                                >
                                                    <i className={`fas ${iconInfo.icon}`} style={{color: 'var(--soft-black)'}}></i>
                                                </div>
                                                <div className="flex-1 min-w-0">
                                                    <p className="font-semibold text-xs md:text-sm" style={{color: 'var(--charcoal)'}}>
                                                        {notification.message}
                                                    </p>
                                                    {notification.whyItMatters && (
                                                        <p className="text-xs mt-1 md:mt-2 italic" style={{color: 'var(--ripe-mango)'}}>
                                                            <i className="fas fa-heart mr-1"></i>
                                                            {notification.whyItMatters}
                                                        </p>
                                                    )}
                                                    <span className="text-xs mt-1 block" style={{color: 'var(--warm-gray)'}}>
                                                        {formatTimeAgo(notification.timestamp)}
                                                    </span>
                                                </div>
                                                {!notification.read && (
                                                    <div className="w-2 h-2 md:w-2.5 md:h-2.5 rounded-full flex-shrink-0 mt-2" style={{background: 'var(--ripe-mango)'}}></div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Toast Component
        function Toast({ toast, onDismiss }) {
            const getToastStyles = () => {
                switch (toast.type) {
                    case 'due-today':
                        return { bg: 'var(--golden-flesh)', icon: 'fa-exclamation-circle' };
                    case 'due-tomorrow':
                        return { bg: 'var(--sky)', icon: 'fa-clock' };
                    case 'custom-reminder':
                        return { bg: 'var(--ripe-mango)', icon: 'fa-bell' };
                    default:
                        return { bg: 'var(--linen)', icon: 'fa-info-circle' };
                }
            };

            const styles = getToastStyles();

            return (
                <div className="toast-enter rounded-2xl shadow-soft-lg p-4 md:p-5 w-full md:max-w-sm" style={{background: styles.bg}}>
                    <div className="flex items-start space-x-3 md:space-x-4">
                        <div className="flex-shrink-0 w-9 h-9 md:w-10 md:h-10 rounded-xl flex items-center justify-center" style={{background: 'rgba(255,255,255,0.5)'}}>
                            <i className={`fas ${styles.icon}`} style={{color: 'var(--soft-black)'}}></i>
                        </div>
                        <div className="flex-1 min-w-0">
                            <p className="font-bold text-xs md:text-sm" style={{color: 'var(--soft-black)'}}>{toast.message}</p>
                        </div>
                        <button
                            onClick={onDismiss}
                            className="flex-shrink-0 opacity-60 hover:opacity-100 transition-opacity p-1"
                            style={{color: 'var(--soft-black)'}}
                        >
                            <i className="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            );
        }

        // Pomodoro Timer Component
        function PomodoroTimer({ pomodoroActive, pomodoroTime, isBreak, stopPomodoro }) {
            const minutes = Math.floor(pomodoroTime / 60);
            const seconds = pomodoroTime % 60;
            const progress = isBreak 
                ? ((5 * 60 - pomodoroTime) / (5 * 60)) * 100
                : ((25 * 60 - pomodoroTime) / (25 * 60)) * 100;

            return (
                <div className={`p-4 md:p-5 border-t ${pomodoroActive ? 'timer-active' : ''}`} style={{borderColor: 'rgba(255,255,255,0.15)'}}>
                    <div className="text-center">
                        <div className="text-xs font-bold uppercase mb-2 md:mb-3 tracking-wider" style={{color: 'rgba(255,255,255,0.7)'}}>
                            {isBreak ? 'â˜• Break' : 'ðŸ¥­ Focus'}
                        </div>
                        <div className="text-3xl md:text-4xl font-bold text-white mb-3 md:mb-4" style={{letterSpacing: '-0.02em'}}>
                            {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
                        </div>
                        <div className="w-full h-2 md:h-2.5 rounded-full mb-3 md:mb-4" style={{background: 'rgba(255,255,255,0.2)'}}>
                            <div 
                                className="h-full rounded-full transition-all"
                                style={{
                                    width: `${progress}%`,
                                    background: isBreak ? 'var(--sanctuary-sage)' : 'var(--ripe-mango)'
                                }}
                            ></div>
                        </div>
                        {pomodoroActive && (
                            <button
                                onClick={stopPomodoro}
                                className="text-xs font-semibold transition-all hover:opacity-100 py-2 px-4"
                                style={{color: 'rgba(255,255,255,0.7)'}}
                            >
                                <i className="fas fa-stop mr-1.5"></i>
                                Stop
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        // Sidebar Component
        function Sidebar({ boards, activeBoard, setActiveBoard, addBoard, view, setView, sidebarOpen, setSidebarOpen, pomodoroActive, pomodoroTime, isBreak, stopPomodoro, recentlyViewed, overdueTaskCount, rolloverAllOverdue, user, onSignOut, onClose, exportData, isMobile }) {
            if (!sidebarOpen && !isMobile) {
                return (
                    <div className="w-16 flex flex-col items-center py-5 sidebar-gentle" style={{borderRight: '1px solid rgba(255,255,255,0.1)'}}>
                        <button onClick={() => setSidebarOpen(true)} className="mb-4 text-xl hover:bg-white hover:bg-opacity-20 p-3 rounded-2xl text-white transition-all">
                            <i className="fas fa-bars"></i>
                        </button>
                    </div>
                );
            }

            return (
                <div className={`${isMobile ? 'w-full h-full' : 'w-64'} flex flex-col sidebar-gentle`} style={{borderRight: '1px solid rgba(255,255,255,0.1)'}}>
                    <div className="p-4 md:p-5 border-b" style={{borderColor: 'rgba(255,255,255,0.1)'}}>
                        <div className="flex items-center justify-between mb-3">
                            <div className="flex items-center">
                                <MangoLogo size={28} className="mr-2" />
                                <div>
                                    <h1 className="text-lg font-bold text-white leading-tight">EveryMango</h1>
                                    <p className="tagline text-white">Ripen at your own pace</p>
                                </div>
                            </div>
                            <button 
                                onClick={isMobile ? onClose : () => setSidebarOpen(false)} 
                                className="hover:bg-white hover:bg-opacity-20 p-2.5 rounded-xl text-white transition-all"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        {user && (
                            <div className="flex items-center justify-between pt-3" style={{borderTop: '1px solid rgba(255,255,255,0.1)'}}>
                                <div className="flex items-center space-x-2">
                                    {user.photoURL ? (
                                        <img src={user.photoURL} alt="" className="w-8 h-8 rounded-full" />
                                    ) : (
                                        <div className="w-8 h-8 rounded-full flex items-center justify-center" style={{background: 'rgba(255,255,255,0.2)'}}>
                                            <i className="fas fa-user text-white text-sm"></i>
                                        </div>
                                    )}
                                    <span className="text-sm text-white truncate max-w-[100px] md:max-w-[120px]" title={user.email}>
                                        {user.displayName || user.email?.split('@')[0]}
                                    </span>
                                </div>
                                <button
                                    onClick={onSignOut}
                                    className="text-xs px-3 py-1.5 rounded-xl transition-all hover:bg-white hover:bg-opacity-20"
                                    style={{color: 'rgba(255,255,255,0.8)'}}
                                    title="Sign out"
                                >
                                    <i className="fas fa-sign-out-alt"></i>
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Pomodoro Timer */}
                    {pomodoroActive && (
                        <PomodoroTimer 
                            pomodoroActive={pomodoroActive}
                            pomodoroTime={pomodoroTime}
                            isBreak={isBreak}
                            stopPomodoro={stopPomodoro}
                        />
                    )}

                    {/* Fresh Start Button */}
                    {overdueTaskCount > 0 && (
                        <div className="p-4 border-b" style={{borderColor: 'rgba(255,255,255,0.1)'}}>
                            <button
                                onClick={rolloverAllOverdue}
                                className="w-full px-4 py-3 rounded-2xl flex items-center justify-between font-semibold transition-all text-white"
                                style={{background: 'rgba(248, 197, 109, 0.25)'}}
                            >
                                <span className="flex items-center">
                                    <i className="fas fa-redo mr-3"></i>
                                    Fresh Start
                                </span>
                                <span className="text-xs font-bold px-2.5 py-1 rounded-xl" style={{background: 'var(--golden-flesh)', color: 'var(--soft-black)'}}>
                                    {overdueTaskCount}
                                </span>
                            </button>
                        </div>
                    )}

                    {/* Navigation */}
                    <nav className="p-4 space-y-2">
                        {[
                            { id: 'dashboard', icon: 'fa-chart-line', label: 'Dashboard' },
                            { id: 'board', icon: 'fa-columns', label: 'Boards' },
                            { id: 'timeblocking', icon: 'fa-clock', label: 'Time Blocking' },
                            { id: 'timeline', icon: 'fa-calendar-alt', label: 'Timeline' },
                            { id: 'team', icon: 'fa-users', label: 'Team' }
                        ].map(item => (
                            <button 
                                key={item.id}
                                onClick={() => setView(item.id)}
                                className={`w-full text-left px-4 py-3 rounded-2xl flex items-center font-semibold transition-all ${view === item.id ? 'text-white shadow-soft' : 'text-white text-opacity-80 hover:bg-white hover:bg-opacity-15'}`}
                                style={{background: view === item.id ? 'rgba(255,255,255,0.25)' : 'transparent'}}
                            >
                                <i className={`fas ${item.icon} mr-3 w-5`}></i>
                                {item.label}
                            </button>
                        ))}
                    </nav>

                    {/* Scrollable section */}
                    <div className="flex-1 overflow-y-auto scrollbar-sage p-4">
                        {/* Recently Viewed */}
                        {recentlyViewed && recentlyViewed.length > 0 && (
                            <div className="mb-4 pb-4" style={{borderBottom: '1px solid rgba(255,255,255,0.1)'}}>
                                <h2 className="text-xs font-bold uppercase tracking-wider mb-3 px-2" style={{color: 'rgba(255,255,255,0.6)'}}>
                                    <i className="fas fa-history mr-2"></i>
                                    Recent
                                </h2>
                                <div className="space-y-1">
                                    {recentlyViewed.slice(0, 3).map(item => (
                                        <div
                                            key={item.taskId}
                                            className="px-3 py-2 rounded-xl transition-all text-sm hover:bg-white hover:bg-opacity-10"
                                            style={{color: 'rgba(255,255,255,0.85)'}}
                                        >
                                            <div className="flex items-center space-x-2">
                                                <span className="w-2 h-2 rounded-full flex-shrink-0" style={{background: 'var(--golden-flesh)'}}></span>
                                                <span className="truncate font-medium">{item.taskName}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Pinned Boards */}
                        <div className="mb-4 pb-4" style={{borderBottom: '1px solid rgba(255,255,255,0.1)'}}>
                            <h2 className="text-xs font-bold uppercase tracking-wider mb-3 px-2" style={{color: 'var(--golden-flesh)'}}>
                                <i className="fas fa-thumbtack mr-2"></i>
                                Pinned
                            </h2>
                            
                            {/* Brain Dump Board */}
                            {boards.filter(b => b.id === 'brain-dump-board').map(board => {
                                const taskCount = board.groups.reduce((sum, g) => sum + g.tasks.length, 0);
                                return (
                                    <button
                                        key={board.id}
                                        onClick={() => { setActiveBoard(board.id); setView('board'); }}
                                        className={`w-full text-left px-4 py-3 rounded-2xl flex items-center justify-between font-semibold transition-all mb-2 ${activeBoard === board.id && view === 'board' ? 'text-white' : 'text-white text-opacity-85 hover:bg-white hover:bg-opacity-15'}`}
                                        style={{background: activeBoard === board.id && view === 'board' ? 'rgba(244, 162, 89, 0.3)' : 'transparent'}}
                                    >
                                        <div className="flex items-center">
                                            <i className="fas fa-brain mr-3" style={{color: 'var(--ripe-mango)'}}></i>
                                            <span className="truncate">{board.name}</span>
                                        </div>
                                        {taskCount > 0 && (
                                            <span className="text-xs font-bold px-2 py-1 rounded-xl flex-shrink-0 ml-2" style={{background: 'var(--ripe-mango)', color: 'var(--soft-black)'}}>
                                                {taskCount}
                                            </span>
                                        )}
                                    </button>
                                );
                            })}
                            
                            {/* Someday/Maybe Board */}
                            {boards.filter(b => b.id === 'someday-maybe-board').map(board => {
                                const taskCount = board.groups.reduce((sum, g) => sum + g.tasks.length, 0);
                                return (
                                    <button
                                        key={board.id}
                                        onClick={() => { setActiveBoard(board.id); setView('board'); }}
                                        className={`w-full text-left px-4 py-3 rounded-2xl flex items-center justify-between font-semibold transition-all ${activeBoard === board.id && view === 'board' ? 'text-white' : 'text-white text-opacity-85 hover:bg-white hover:bg-opacity-15'}`}
                                        style={{background: activeBoard === board.id && view === 'board' ? 'rgba(168, 200, 216, 0.3)' : 'transparent'}}
                                    >
                                        <div className="flex items-center">
                                            <i className="fas fa-cloud mr-3" style={{color: 'var(--sky)'}}></i>
                                            <span className="truncate">{board.name}</span>
                                        </div>
                                        {taskCount > 0 && (
                                            <span className="text-xs font-bold px-2 py-1 rounded-xl flex-shrink-0 ml-2" style={{background: 'var(--sky)', color: 'var(--soft-black)'}}>
                                                {taskCount}
                                            </span>
                                        )}
                                    </button>
                                );
                            })}
                        </div>

                        {/* Other Boards */}
                        <div className="mb-4">
                            <div className="flex items-center justify-between mb-3 px-2">
                                <h2 className="text-xs font-bold uppercase tracking-wider" style={{color: 'rgba(255,255,255,0.6)'}}>Boards</h2>
                                <button 
                                    onClick={addBoard}
                                    className="hover:bg-white hover:bg-opacity-20 p-2 rounded-xl transition-all"
                                    style={{color: 'var(--sage-light)'}}
                                >
                                    <i className="fas fa-plus"></i>
                                </button>
                            </div>
                            <div className="space-y-1">
                                {boards.filter(b => 
                                    b.id !== 'brain-dump-board' && 
                                    b.id !== 'someday-maybe-board' &&
                                    !b.isPinned
                                ).map(board => (
                                    <button
                                        key={board.id}
                                        onClick={() => { setActiveBoard(board.id); setView('board'); }}
                                        className={`w-full text-left px-4 py-3 rounded-2xl flex items-center font-medium transition-all ${activeBoard === board.id && view === 'board' ? 'text-white' : 'text-white text-opacity-80 hover:bg-white hover:bg-opacity-10'}`}
                                        style={{background: activeBoard === board.id && view === 'board' ? 'rgba(255,255,255,0.15)' : 'transparent'}}
                                    >
                                        <span className="w-3 h-3 rounded-full mr-3 flex-shrink-0" style={{ backgroundColor: board.color }}></span>
                                        <span className="truncate">{board.name}</span>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Export Button */}
                        {exportData && (
                            <div className="pt-4 border-t" style={{borderColor: 'rgba(255,255,255,0.1)'}}>
                                <h2 className="text-xs font-bold uppercase tracking-wider mb-3 px-2" style={{color: 'rgba(255,255,255,0.6)'}}>
                                    <i className="fas fa-download mr-2"></i>
                                    Export
                                </h2>
                                <div className="flex gap-2 px-2">
                                    <button
                                        onClick={() => exportData('json')}
                                        className="flex-1 px-3 py-2 rounded-xl text-xs font-semibold transition-all hover:bg-white hover:bg-opacity-20"
                                        style={{background: 'rgba(255,255,255,0.1)', color: 'white'}}
                                    >
                                        <i className="fas fa-file-code mr-1"></i> JSON
                                    </button>
                                    <button
                                        onClick={() => exportData('csv')}
                                        className="flex-1 px-3 py-2 rounded-xl text-xs font-semibold transition-all hover:bg-white hover:bg-opacity-20"
                                        style={{background: 'rgba(255,255,255,0.1)', color: 'white'}}
                                    >
                                        <i className="fas fa-file-csv mr-1"></i> CSV
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Time Budget Component
        function TimeBudget({ boards }) {
            const todaysTasks = useMemo(() => {
                const tasks = [];
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            if (isToday(task.dueDate) && task.status !== 'done') {
                                tasks.push(task);
                            }
                        });
                    });
                });
                return tasks;
            }, [boards]);

            const totalMinutes = useMemo(() => {
                return todaysTasks.reduce((sum, task) => sum + getTimeInMinutes(task.timeEstimate), 0);
            }, [todaysTasks]);

            const availableHours = 8;
            const availableMinutes = availableHours * 60;
            const usagePercentage = Math.min((totalMinutes / availableMinutes) * 100, 100);
            const isOverbudget = totalMinutes > availableMinutes;

            return (
                <div className="card-gentle shadow-soft p-4 md:p-5 time-budget-mobile">
                    <div className="flex items-center justify-between mb-3 md:mb-4">
                        <h3 className="text-xs md:text-sm font-bold" style={{color: 'var(--charcoal)'}}>
                            <i className="fas fa-hourglass-half mr-2" style={{color: 'var(--mango-leaf)'}}></i>
                            <span className="hidden sm:inline">Today's </span>Time Budget
                        </h3>
                        <span className="text-xs md:text-sm font-bold" style={{color: isOverbudget ? 'var(--warm-red)' : 'var(--mango-leaf)'}}>
                            {Math.floor(totalMinutes / 60)}h {totalMinutes % 60}m / {availableHours}h
                        </span>
                    </div>
                    <div className="w-full h-2 md:h-3 rounded-full" style={{background: 'var(--linen)'}}>
                        <div 
                            className="h-full rounded-full transition-all"
                            style={{
                                width: `${usagePercentage}%`,
                                background: isOverbudget 
                                    ? 'var(--warm-red)'
                                    : usagePercentage > 80
                                    ? 'var(--golden-flesh)'
                                    : 'var(--sanctuary-sage)'
                            }}
                        ></div>
                    </div>
                </div>
            );
        }

        // Time Blocking View Component
        function TimeBlockingView({ boards, updateTask, startPomodoro, activeTaskId }) {
            const timeSlots = [
                '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', 
                '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', 
                '18:00', '19:00', '20:00', '21:00', '22:00'
            ];

            const todaysTasks = useMemo(() => {
                const tasks = [];
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            if (isToday(task.dueDate)) {
                                tasks.push({
                                    ...task,
                                    boardId: board.id,
                                    groupId: group.id
                                });
                            }
                        });
                    });
                });
                return tasks;
            }, [boards]);

            const unscheduledTasks = todaysTasks.filter(t => !t.timeBlock);
            const scheduledTasks = todaysTasks.filter(t => t.timeBlock);

            const handleDragStart = (e, task) => {
                e.dataTransfer.setData('task', JSON.stringify(task));
            };

            const handleDrop = (e, timeSlot) => {
                e.preventDefault();
                const task = JSON.parse(e.dataTransfer.getData('task'));
                updateTask(task.boardId, task.groupId, task.id, { timeBlock: timeSlot });
            };

            const handleDragOver = (e) => {
                e.preventDefault();
            };

            const removeFromSlot = (task) => {
                updateTask(task.boardId, task.groupId, task.id, { timeBlock: null });
            };

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-4 md:px-8 py-4 md:py-6" style={{borderColor: 'var(--linen)'}}>
                        <h2 className="text-xl md:text-3xl font-bold mb-1 md:mb-2" style={{color: 'var(--charcoal)'}}>
                            Time Blocking
                        </h2>
                        <p className="text-xs md:text-sm font-medium" style={{color: 'var(--warm-gray)'}}>
                            Drag tasks into time slots ðŸ¥­
                        </p>
                    </div>

                    <div className="flex-1 overflow-hidden flex flex-col md:flex-row time-blocking-layout">
                        {/* Unscheduled Tasks Panel */}
                        <div className="md:w-80 border-b md:border-b-0 md:border-r p-4 md:p-6 overflow-y-auto scrollbar-thin time-blocking-sidebar" style={{borderColor: 'var(--linen)', background: 'var(--cream-dark)'}}>
                            <h3 className="text-base md:text-lg font-bold mb-4 md:mb-5" style={{color: 'var(--charcoal)'}}>
                                <i className="fas fa-inbox mr-2" style={{color: 'var(--mango-leaf)'}}></i>
                                Unscheduled ({unscheduledTasks.length})
                            </h3>
                            <div className="flex md:block overflow-x-auto md:overflow-x-visible space-x-3 md:space-x-0 md:space-y-4 pb-2 md:pb-0">
                                {unscheduledTasks.map(task => (
                                    <div
                                        key={task.id}
                                        draggable
                                        onDragStart={(e) => handleDragStart(e, task)}
                                        className={`card-gentle shadow-soft p-4 md:p-5 draggable-task hover-lift type-${task.taskType} min-w-[200px] md:min-w-0`}
                                    >
                                        <div className="flex items-start justify-between mb-2 md:mb-3">
                                            <h4 className="font-bold text-xs md:text-sm flex-1" style={{color: 'var(--charcoal)'}}>
                                                {task.name}
                                            </h4>
                                            <span className="badge-soft text-xs ml-2" style={{background: 'var(--sky)', color: 'var(--soft-black)'}}>
                                                {task.timeEstimate}
                                            </span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <span className={`status-${task.status} badge-soft text-xs`}>
                                                {task.status}
                                            </span>
                                        </div>
                                    </div>
                                ))}
                                {unscheduledTasks.length === 0 && (
                                    <div className="text-center py-6 md:py-10" style={{color: 'var(--warm-gray)'}}>
                                        <i className="fas fa-check-circle text-3xl md:text-4xl mb-3 opacity-40"></i>
                                        <p className="text-xs md:text-sm font-medium">All scheduled!</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Time Slots Grid */}
                        <div className="flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin">
                            <div className="hidden md:block"><TimeBudget boards={boards} /></div>
                            
                            <div className="mt-4 md:mt-8 space-y-3 md:space-y-4">
                                {timeSlots.map(slot => {
                                    const tasksInSlot = scheduledTasks.filter(t => t.timeBlock === slot);
                                    
                                    return (
                                        <div key={slot}>
                                            <div className="flex items-center mb-2">
                                                <span className="text-xs md:text-sm font-bold w-14 md:w-20" style={{color: 'var(--warm-gray)'}}>
                                                    {slot}
                                                </span>
                                                <div 
                                                    className={`flex-1 time-slot p-3 md:p-5 ${tasksInSlot.length > 0 ? 'occupied' : ''}`}
                                                    onDrop={(e) => handleDrop(e, slot)}
                                                    onDragOver={handleDragOver}
                                                >
                                                    {tasksInSlot.length === 0 ? (
                                                        <div className="text-center text-xs md:text-sm font-medium" style={{color: 'var(--warm-gray)'}}>
                                                            Drop task here
                                                        </div>
                                                    ) : (
                                                        <div className="space-y-2 md:space-y-3">
                                                            {tasksInSlot.map(task => (
                                                                <div 
                                                                    key={task.id}
                                                                    className={`card-gentle shadow-soft p-3 md:p-4 type-${task.taskType}`}
                                                                >
                                                                    <div className="flex items-center justify-between">
                                                                        <div className="flex-1 min-w-0">
                                                                            <h4 className="font-bold text-xs md:text-sm mb-1 md:mb-2 truncate" style={{color: 'var(--charcoal)'}}>
                                                                                {task.name}
                                                                            </h4>
                                                                            <span className="badge-soft text-xs" style={{background: 'var(--sky)', color: 'var(--soft-black)'}}>
                                                                                {task.timeEstimate}
                                                                            </span>
                                                                        </div>
                                                                        <div className="flex items-center space-x-1 md:space-x-2 ml-2">
                                                                            <button
                                                                                onClick={() => startPomodoro(task.id)}
                                                                                className="p-2 md:p-2.5 rounded-xl transition-all"
                                                                                style={{background: activeTaskId === task.id ? 'var(--warm-red)' : 'var(--mango-leaf)', color: 'white'}}
                                                                            >
                                                                                <i className="fas fa-play text-xs"></i>
                                                                            </button>
                                                                            <button
                                                                                onClick={() => removeFromSlot(task)}
                                                                                className="p-2 md:p-2.5 rounded-xl transition-all"
                                                                                style={{background: 'var(--linen)', color: 'var(--warm-gray)'}}
                                                                            >
                                                                                <i className="fas fa-times text-xs"></i>
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Board View Component
        function BoardView({ board, team, updateBoard, deleteBoard, addGroup, updateGroup, deleteGroup, addTask, updateTask, deleteTask, moveTask, allBoards, focusMode, quickWinsOnly, setQuickWinsOnly, energyFilter, setEnergyFilter, startPomodoro, activeTaskId, noJudgmentMode, sendToSomedayMaybe, rolloverTask }) {
            const [editingBoardName, setEditingBoardName] = useState(false);
            const [boardName, setBoardName] = useState(board.name);

            useEffect(() => {
                setBoardName(board.name);
                setEditingBoardName(false);
            }, [board.id]);

            const handleBoardNameSave = () => {
                updateBoard(board.id, { name: boardName });
                setEditingBoardName(false);
            };

            const boardStats = useMemo(() => {
                let total = 0;
                let completed = 0;
                let quickWins = 0;
                
                board.groups.forEach(group => {
                    group.tasks.forEach(task => {
                        total++;
                        if (task.status === 'done') completed++;
                        if (task.timeEstimate === '5min' || task.timeEstimate === '15min') quickWins++;
                    });
                });

                return { 
                    total, 
                    completed, 
                    quickWins,
                    percentage: total > 0 ? Math.round((completed / total) * 100) : 0 
                };
            }, [board]);

            const isSystemBoard = board.id === 'brain-dump-board' || board.id === 'someday-maybe-board';

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-4 md:px-8 py-4 md:py-6" style={{borderColor: 'var(--linen)'}}>
                        <div className="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-5 board-header">
                            <div className="flex items-center space-x-3 md:space-x-5 mb-3 md:mb-0">
                                {editingBoardName && !isSystemBoard ? (
                                    <input
                                        type="text"
                                        value={boardName}
                                        onChange={(e) => setBoardName(e.target.value)}
                                        onBlur={handleBoardNameSave}
                                        onKeyDown={(e) => e.key === 'Enter' && handleBoardNameSave()}
                                        className="text-xl md:text-3xl font-bold border-b-2 focus:outline-none bg-transparent"
                                        style={{borderColor: 'var(--mango-leaf)', color: 'var(--charcoal)'}}
                                        autoFocus
                                    />
                                ) : (
                                    <h2 
                                        className={`text-xl md:text-3xl font-bold transition-colors ${!isSystemBoard ? 'cursor-pointer hover:opacity-70' : ''}`}
                                        style={{color: 'var(--charcoal)'}}
                                        onClick={() => {
                                            if (!isSystemBoard) {
                                                setEditingBoardName(true);
                                            }
                                        }}
                                    >
                                        {board.name}
                                    </h2>
                                )}
                                
                                {/* Progress Ring - Hidden on small mobile */}
                                <div className="relative w-12 h-12 md:w-16 md:h-16 hidden sm:block">
                                    <svg className="transform -rotate-90" width="100%" height="100%" viewBox="0 0 64 64">
                                        <circle cx="32" cy="32" r="28" stroke="var(--linen)" strokeWidth="6" fill="none" />
                                        <circle
                                            cx="32" cy="32" r="28"
                                            stroke="var(--sanctuary-sage)"
                                            strokeWidth="6"
                                            fill="none"
                                            strokeDasharray="175.84"
                                            strokeDashoffset={175.84 - (175.84 * boardStats.percentage / 100)}
                                            strokeLinecap="round"
                                            className="progress-ring"
                                        />
                                    </svg>
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <span className="text-xs md:text-sm font-bold" style={{color: 'var(--charcoal)'}}>{boardStats.percentage}%</span>
                                    </div>
                                </div>
                            </div>
                            <div className="flex items-center space-x-2 md:space-x-3 board-header-actions">
                                <button 
                                    onClick={() => addGroup(board.id)}
                                    className="btn-primary px-3 md:px-5 py-2 md:py-3 text-white rounded-2xl hover-lift flex items-center font-semibold text-sm"
                                >
                                    <i className="fas fa-plus mr-1 md:mr-2"></i>
                                    <span className="hidden sm:inline">Add </span>Group
                                </button>
                                {!isSystemBoard && (
                                    <>
                                        <button 
                                            onClick={() => updateBoard(board.id, { isPinned: !board.isPinned })}
                                            className="px-3 md:px-5 py-2 md:py-3 rounded-2xl hover-lift font-semibold flex items-center"
                                            style={{
                                                background: board.isPinned ? 'var(--golden-flesh)' : 'var(--linen)', 
                                                color: board.isPinned ? 'var(--soft-black)' : 'var(--charcoal)'
                                            }}
                                        >
                                            <i className={`fas fa-thumbtack ${board.isPinned ? '' : 'opacity-50'}`}></i>
                                        </button>
                                        <button 
                                            onClick={() => {
                                                if (confirm('Delete this board?')) {
                                                    deleteBoard(board.id);
                                                }
                                            }}
                                            className="px-3 md:px-5 py-2 md:py-3 text-white rounded-2xl hover-lift font-semibold"
                                            style={{background: 'var(--warm-red)'}}
                                        >
                                            <i className="fas fa-trash"></i>
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>

                        <div className="flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0 sm:space-x-4 board-filters">
                            <button
                                onClick={() => setQuickWinsOnly(!quickWinsOnly)}
                                className="px-4 md:px-5 py-2 md:py-2.5 rounded-2xl font-semibold flex items-center justify-center sm:justify-start transition-all text-sm"
                                style={{
                                    background: quickWinsOnly ? 'var(--sunny-yellow)' : 'var(--linen)',
                                    color: 'var(--soft-black)'
                                }}
                            >
                                <i className="fas fa-bolt mr-2"></i>
                                Quick Wins ({boardStats.quickWins})
                            </button>

                            <div className="flex items-center space-x-2">
                                <span className="text-xs font-bold" style={{color: 'var(--warm-gray)'}}>Energy:</span>
                                {['low', 'medium', 'high'].map(level => (
                                    <button
                                        key={level}
                                        onClick={() => setEnergyFilter(energyFilter === level ? null : level)}
                                        className={`px-3 py-1.5 rounded-xl text-xs font-bold transition-all energy-${level}`}
                                        style={{
                                            opacity: energyFilter && energyFilter !== level ? 0.4 : 1
                                        }}
                                    >
                                        {level.charAt(0).toUpperCase() + level.slice(1)}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin">
                        <div className="space-y-4 md:space-y-6">
                            {board.groups.map(group => (
                                <GroupComponent
                                    key={group.id}
                                    group={group}
                                    boardId={board.id}
                                    team={team}
                                    updateGroup={updateGroup}
                                    deleteGroup={deleteGroup}
                                    addTask={addTask}
                                    updateTask={updateTask}
                                    deleteTask={deleteTask}
                                    moveTask={moveTask}
                                    allBoards={allBoards}
                                    focusMode={focusMode}
                                    quickWinsOnly={quickWinsOnly}
                                    energyFilter={energyFilter}
                                    startPomodoro={startPomodoro}
                                    activeTaskId={activeTaskId}
                                    noJudgmentMode={noJudgmentMode}
                                    sendToSomedayMaybe={sendToSomedayMaybe}
                                    rolloverTask={rolloverTask}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Group Component
        function GroupComponent({ group, boardId, team, updateGroup, deleteGroup, addTask, updateTask, deleteTask, moveTask, allBoards, focusMode, quickWinsOnly, energyFilter, startPomodoro, activeTaskId, noJudgmentMode, sendToSomedayMaybe, rolloverTask }) {
            const [collapsed, setCollapsed] = useState(false);
            const [editingName, setEditingName] = useState(false);
            const [groupName, setGroupName] = useState(group.name);

            const handleNameSave = () => {
                updateGroup(boardId, group.id, { name: groupName });
                setEditingName(false);
            };

            const filteredTasks = useMemo(() => {
                let tasks = [...group.tasks];
                
                if (focusMode) {
                    tasks = tasks.filter(t => t.isFocusTask);
                }
                
                if (quickWinsOnly) {
                    tasks = tasks.filter(t => t.timeEstimate === '5min' || t.timeEstimate === '15min');
                }

                if (energyFilter) {
                    tasks = tasks.filter(t => t.energyLevel === energyFilter);
                }

                return tasks;
            }, [group.tasks, focusMode, quickWinsOnly, energyFilter]);

            const groupStats = useMemo(() => {
                const total = group.tasks.length;
                const completed = group.tasks.filter(t => t.status === 'done').length;
                return { total, completed };
            }, [group.tasks]);

            return (
                <div className="card-gentle shadow-soft overflow-hidden">
                    <div 
                        className="px-4 md:px-6 py-3 md:py-4 flex flex-col sm:flex-row sm:items-center justify-between cursor-pointer group-header"
                        style={{background: 'var(--cream-dark)'}}
                        onClick={() => setCollapsed(!collapsed)}
                    >
                        <div className="flex items-center space-x-3 md:space-x-4 mb-2 sm:mb-0">
                            <button className="transition-transform" style={{color: 'var(--warm-gray)'}}>
                                <i className={`fas fa-chevron-${collapsed ? 'right' : 'down'}`}></i>
                            </button>
                            <span className="w-3 h-3 md:w-4 md:h-4 rounded-full flex-shrink-0" style={{ backgroundColor: group.color }}></span>
                            {editingName ? (
                                <input
                                    type="text"
                                    value={groupName}
                                    onChange={(e) => setGroupName(e.target.value)}
                                    onBlur={handleNameSave}
                                    onKeyDown={(e) => e.key === 'Enter' && handleNameSave()}
                                    onClick={(e) => e.stopPropagation()}
                                    className="text-base md:text-lg font-bold border-b-2 focus:outline-none bg-transparent"
                                    style={{borderColor: 'var(--mango-leaf)', color: 'var(--charcoal)'}}
                                    autoFocus
                                />
                            ) : (
                                <h3 
                                    className="text-base md:text-lg font-bold cursor-pointer hover:opacity-70 transition-colors"
                                    style={{color: 'var(--charcoal)'}}
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        setEditingName(true);
                                    }}
                                >
                                    {group.name}
                                </h3>
                            )}
                            <span className="text-xs md:text-sm font-semibold px-2 md:px-3 py-1 rounded-xl" style={{background: 'var(--linen)', color: 'var(--warm-gray)'}}>
                                {groupStats.completed}/{groupStats.total}
                            </span>
                        </div>
                        <div className="flex items-center space-x-2 md:space-x-3 group-header-right">
                            <button
                                onClick={(e) => {
                                    e.stopPropagation();
                                    addTask(boardId, group.id);
                                }}
                                className="px-3 md:px-4 py-1.5 md:py-2 rounded-xl hover-lift font-semibold text-xs md:text-sm"
                                style={{background: 'var(--mango-leaf)', color: 'white'}}
                            >
                                <i className="fas fa-plus mr-1 md:mr-2"></i>
                                Task
                            </button>
                            <button
                                onClick={(e) => {
                                    e.stopPropagation();
                                    if (confirm('Delete this group?')) {
                                        deleteGroup(boardId, group.id);
                                    }
                                }}
                                className="px-3 py-1.5 md:py-2 rounded-xl font-semibold text-xs md:text-sm"
                                style={{background: 'rgba(232, 93, 74, 0.1)', color: 'var(--warm-red)'}}
                            >
                                <i className="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    {!collapsed && (
                        <div className="p-3 md:p-5">
                            {/* Desktop Column Headers */}
                            <div className="hidden md:grid grid-cols-12 gap-3 px-4 py-2 text-xs font-bold uppercase tracking-wider column-headers" style={{color: 'var(--warm-gray)'}}>
                                <div className="col-span-3">Task</div>
                                <div className="col-span-1">Status</div>
                                <div className="col-span-1">Priority</div>
                                <div className="col-span-1">Time</div>
                                <div className="col-span-1">Energy</div>
                                <div className="col-span-2">Assignee</div>
                                <div className="col-span-1">Due</div>
                                <div className="col-span-2 text-right">Actions</div>
                            </div>

                            <div className="space-y-2 md:space-y-3 mt-2 md:mt-3">
                                {filteredTasks.map(task => (
                                    <React.Fragment key={task.id}>
                                        {/* Desktop Task Row */}
                                        <div className="task-row-desktop">
                                            <TaskRow
                                                task={task}
                                                boardId={boardId}
                                                groupId={group.id}
                                                team={team}
                                                updateTask={updateTask}
                                                deleteTask={deleteTask}
                                                moveTask={moveTask}
                                                allBoards={allBoards}
                                                startPomodoro={startPomodoro}
                                                activeTaskId={activeTaskId}
                                                noJudgmentMode={noJudgmentMode}
                                                sendToSomedayMaybe={sendToSomedayMaybe}
                                                rolloverTask={rolloverTask}
                                            />
                                        </div>
                                        {/* Mobile Task Card */}
                                        <div className="task-card-mobile">
                                            <MobileTaskCard
                                                task={task}
                                                boardId={boardId}
                                                groupId={group.id}
                                                team={team}
                                                updateTask={updateTask}
                                                deleteTask={deleteTask}
                                                startPomodoro={startPomodoro}
                                                activeTaskId={activeTaskId}
                                                noJudgmentMode={noJudgmentMode}
                                                sendToSomedayMaybe={sendToSomedayMaybe}
                                                rolloverTask={rolloverTask}
                                            />
                                        </div>
                                    </React.Fragment>
                                ))}
                                {filteredTasks.length === 0 && (
                                    <div className="text-center py-8 md:py-12" style={{color: 'var(--warm-gray)'}}>
                                        <i className="fas fa-inbox text-3xl md:text-4xl mb-3 opacity-30"></i>
                                        <p className="text-sm font-medium">
                                            {focusMode || quickWinsOnly || energyFilter 
                                                ? 'No tasks match filters' 
                                                : 'No tasks yet'}
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Task Row Component (Desktop)
        function TaskRow({ task, boardId, groupId, team, updateTask, deleteTask, moveTask, allBoards, startPomodoro, activeTaskId, noJudgmentMode, sendToSomedayMaybe, rolloverTask }) {
            const [expanded, setExpanded] = useState(false);

            const statusOptions = [
                { value: 'new', label: 'New' },
                { value: 'working', label: 'Working' },
                { value: 'stuck', label: 'Stuck' },
                { value: 'done', label: 'Done' }
            ];

            const priorityOptions = [
                { value: 'low', label: 'Low' },
                { value: 'medium', label: 'Medium' },
                { value: 'high', label: 'High' },
                { value: 'critical', label: 'Critical' }
            ];

            const timeOptions = [
                { value: '5min', label: '5m' },
                { value: '15min', label: '15m' },
                { value: '30min', label: '30m' },
                { value: '1hr', label: '1h' },
                { value: '2hr', label: '2h' }
            ];

            const energyOptions = [
                { value: 'low', label: 'Low' },
                { value: 'medium', label: 'Med' },
                { value: 'high', label: 'High' }
            ];

            const daysUntil = getDaysUntil(task.dueDate);
            const isQuickWin = task.timeEstimate === '5min' || task.timeEstimate === '15min';
            const isRolledOver = task.rolloverCount > 0 && task.lastRolloverDate && isToday(task.lastRolloverDate);
            const isOverdue = daysUntil !== null && daysUntil < 0 && task.status !== 'done';

            return (
                <div className={`card-gentle shadow-soft hover-lift type-${task.taskType} ${task.status === 'done' ? 'opacity-60' : ''} ${task.isFocusTask ? 'focus-mode-active' : ''}`}>
                    <div className="grid grid-cols-12 gap-3 p-4 items-center">
                        {/* Task Name */}
                        <div className="col-span-3 flex items-center space-x-3">
                            <button
                                onClick={() => updateTask(boardId, groupId, task.id, { isFocusTask: !task.isFocusTask })}
                                className={`text-lg transition-all ${task.isFocusTask ? '' : 'opacity-40 hover:opacity-100'}`}
                                style={{color: task.isFocusTask ? 'var(--ripe-mango)' : 'var(--warm-gray)'}}
                            >
                                <i className="fas fa-star"></i>
                            </button>
                            <div className="flex-1 min-w-0">
                                <input
                                    type="text"
                                    value={task.name}
                                    onChange={(e) => updateTask(boardId, groupId, task.id, { name: e.target.value })}
                                    className={`w-full bg-transparent border-none focus:outline-none font-semibold text-sm ${task.status === 'done' ? 'line-through' : ''}`}
                                    style={{color: 'var(--charcoal)'}}
                                />
                                <div className="flex items-center space-x-2 mt-1">
                                    {isQuickWin && (
                                        <span className="quick-win-badge text-xs font-bold px-2 py-0.5 rounded-lg">
                                            <i className="fas fa-bolt mr-1"></i>Quick Win
                                        </span>
                                    )}
                                    {isRolledOver && (
                                        <span className="rolled-over-badge text-xs font-bold px-2 py-0.5 rounded-lg">
                                            <i className="fas fa-redo mr-1"></i>Ã—{task.rolloverCount}
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Status */}
                        <div className="col-span-1">
                            <select
                                value={task.status}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { status: e.target.value })}
                                className={`status-${task.status} w-full text-xs font-bold px-2 py-1.5 rounded-lg border-none`}
                            >
                                {statusOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Priority */}
                        <div className="col-span-1">
                            <select
                                value={task.priority}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { priority: e.target.value })}
                                className={`priority-${task.priority} w-full text-xs font-bold px-2 py-1.5 rounded-lg border-none`}
                            >
                                {priorityOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Time Estimate */}
                        <div className="col-span-1">
                            <select
                                value={task.timeEstimate}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { timeEstimate: e.target.value })}
                                className={`time-${task.timeEstimate} w-full text-xs font-bold px-2 py-1.5 rounded-lg border-none`}
                            >
                                {timeOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Energy */}
                        <div className="col-span-1">
                            <select
                                value={task.energyLevel}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { energyLevel: e.target.value })}
                                className={`energy-${task.energyLevel} w-full text-xs font-bold px-2 py-1.5 rounded-lg border-none`}
                            >
                                {energyOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Assignee */}
                        <div className="col-span-2">
                            <select
                                value={task.assignee}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { assignee: e.target.value })}
                                className="w-full text-xs px-2 py-1.5 border-2 rounded-lg"
                                style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                            >
                                <option value="">Unassigned</option>
                                {team.map(member => (
                                    <option key={member.id} value={member.name}>
                                        {member.avatar} {member.name}
                                    </option>
                                ))}
                            </select>
                        </div>

                        {/* Due Date */}
                        <div className="col-span-1">
                            <div className="relative">
                                <input
                                    type="date"
                                    value={task.dueDate}
                                    onChange={(e) => updateTask(boardId, groupId, task.id, { dueDate: e.target.value })}
                                    className={`w-full text-xs px-2 py-1.5 border-2 rounded-lg ${isOverdue ? 'due-soon-glow' : ''}`}
                                    style={{
                                        borderColor: isOverdue ? (noJudgmentMode ? 'var(--golden-flesh)' : 'var(--warm-red)') : 'var(--linen)',
                                        color: 'var(--charcoal)'
                                    }}
                                />
                                {daysUntil !== null && (
                                    <span 
                                        className="absolute -bottom-4 left-0 text-xs font-bold"
                                        style={{
                                            color: daysUntil < 0 
                                                ? (noJudgmentMode ? 'var(--golden-flesh)' : 'var(--warm-red)')
                                                : daysUntil === 0 
                                                ? 'var(--ripe-mango)' 
                                                : 'var(--warm-gray)'
                                        }}
                                    >
                                        {daysUntil < 0 
                                            ? (noJudgmentMode ? `${Math.abs(daysUntil)}d ago ðŸ¥­` : `${Math.abs(daysUntil)}d overdue`)
                                            : daysUntil === 0 
                                            ? 'Today' 
                                            : `${daysUntil}d`
                                        }
                                    </span>
                                )}
                            </div>
                        </div>

                        {/* Actions */}
                        <div className="col-span-2 flex items-center justify-end space-x-1">
                            <button
                                onClick={() => startPomodoro(task.id)}
                                className="p-2 rounded-xl transition-all"
                                style={{
                                    background: activeTaskId === task.id ? 'var(--warm-red)' : 'var(--mango-leaf)',
                                    color: 'white'
                                }}
                                title="Start Pomodoro"
                            >
                                <i className={`fas ${activeTaskId === task.id ? 'fa-stop' : 'fa-play'} text-xs`}></i>
                            </button>
                            {isOverdue && (
                                <>
                                    <button
                                        onClick={() => rolloverTask(boardId, groupId, task.id)}
                                        className="p-2 rounded-xl transition-all"
                                        style={{background: 'var(--golden-flesh)', color: 'var(--soft-black)'}}
                                        title="Move to today"
                                    >
                                        <i className="fas fa-arrow-right text-xs"></i>
                                    </button>
                                    <button
                                        onClick={() => sendToSomedayMaybe(boardId, groupId, task.id)}
                                        className="p-2 rounded-xl transition-all"
                                        style={{background: 'var(--sky)', color: 'var(--soft-black)'}}
                                        title="Someday/Maybe"
                                    >
                                        <i className="fas fa-cloud text-xs"></i>
                                    </button>
                                </>
                            )}
                            <button
                                onClick={() => setExpanded(!expanded)}
                                className="p-2 rounded-xl transition-all"
                                style={{background: 'var(--linen)', color: 'var(--charcoal)'}}
                                title="Expand"
                            >
                                <i className={`fas fa-chevron-${expanded ? 'up' : 'down'} text-xs`}></i>
                            </button>
                            <button
                                onClick={() => {
                                    if (confirm('Delete this task?')) {
                                        deleteTask(boardId, groupId, task.id);
                                    }
                                }}
                                className="p-2 rounded-xl transition-all"
                                style={{background: 'rgba(232, 93, 74, 0.1)', color: 'var(--warm-red)'}}
                                title="Delete"
                            >
                                <i className="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>

                    {/* Expanded Details */}
                    {expanded && (
                        <div className="px-6 pb-5 pt-2 border-t" style={{borderColor: 'var(--linen)', background: 'var(--cream-dark)'}}>
                            <div className="grid grid-cols-2 gap-6">
                                <div>
                                    <label className="text-xs font-bold mb-2 block" style={{color: 'var(--warm-gray)'}}>Notes</label>
                                    <textarea
                                        value={task.notes || ''}
                                        onChange={(e) => updateTask(boardId, groupId, task.id, { notes: e.target.value })}
                                        placeholder="Add notes..."
                                        className="w-full px-4 py-3 border-2 rounded-2xl text-sm"
                                        style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                        rows="3"
                                    />
                                </div>
                                <div>
                                    <div className="why-matters-field p-4">
                                        <label className="text-xs font-bold mb-2 flex items-center" style={{color: 'var(--ripe-mango)'}}>
                                            <i className="fas fa-heart mr-2"></i>
                                            Why This Matters
                                        </label>
                                        <textarea
                                            value={task.whyItMatters || ''}
                                            onChange={(e) => updateTask(boardId, groupId, task.id, { whyItMatters: e.target.value })}
                                            placeholder="Connect to your motivation..."
                                            className="w-full px-4 py-3 border-2 rounded-2xl text-sm bg-white"
                                            style={{borderColor: 'var(--ripe-mango)', color: 'var(--charcoal)'}}
                                            rows="2"
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Move Task */}
                            <div className="mt-4 pt-4 border-t" style={{borderColor: 'var(--linen)'}}>
                                <label className="text-xs font-bold mb-2 block" style={{color: 'var(--warm-gray)'}}>Move to</label>
                                <div className="flex flex-wrap gap-2">
                                    {allBoards.map(board => 
                                        board.groups.map(group => {
                                            if (board.id === boardId && group.id === groupId) return null;
                                            return (
                                                <button
                                                    key={`${board.id}-${group.id}`}
                                                    onClick={() => moveTask(boardId, groupId, task.id, board.id, group.id)}
                                                    className="px-3 py-1.5 rounded-xl text-xs font-semibold transition-all hover:opacity-80"
                                                    style={{background: 'var(--linen)', color: 'var(--charcoal)'}}
                                                >
                                                    {board.name} â†’ {group.name}
                                                </button>
                                            );
                                        })
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Timeline View Component
        function TimelineView({ boards }) {
            const [viewMode, setViewMode] = useState('week');

            const allTasks = useMemo(() => {
                const tasks = [];
                boards.forEach(board => {
                    if (board.id === 'brain-dump-board' || board.id === 'someday-maybe-board') return;
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            if (task.dueDate) {
                                tasks.push({
                                    ...task,
                                    boardName: board.name,
                                    boardColor: board.color
                                });
                            }
                        });
                    });
                });
                return tasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            }, [boards]);

            const groupedByDate = useMemo(() => {
                const grouped = {};
                allTasks.forEach(task => {
                    if (!grouped[task.dueDate]) {
                        grouped[task.dueDate] = [];
                    }
                    grouped[task.dueDate].push(task);
                });
                return grouped;
            }, [allTasks]);

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-4 md:px-8 py-4 md:py-6" style={{borderColor: 'var(--linen)'}}>
                        <div className="flex flex-col sm:flex-row sm:items-center justify-between">
                            <div className="mb-3 sm:mb-0">
                                <h2 className="text-xl md:text-3xl font-bold mb-1" style={{color: 'var(--charcoal)'}}>
                                    Timeline
                                </h2>
                                <p className="text-xs md:text-sm font-medium" style={{color: 'var(--warm-gray)'}}>
                                    Your upcoming tasks ðŸ¥­
                                </p>
                            </div>
                            <div className="flex space-x-2">
                                {['week', 'month'].map(mode => (
                                    <button
                                        key={mode}
                                        onClick={() => setViewMode(mode)}
                                        className="px-4 py-2 rounded-xl font-semibold text-sm capitalize transition-all"
                                        style={{
                                            background: viewMode === mode ? 'var(--mango-leaf)' : 'var(--linen)',
                                            color: viewMode === mode ? 'white' : 'var(--charcoal)'
                                        }}
                                    >
                                        {mode}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 overflow-auto p-4 md:p-8 scrollbar-thin">
                        <div className="space-y-4 md:space-y-6">
                            {Object.entries(groupedByDate).map(([date, tasks]) => {
                                const daysUntil = getDaysUntil(date);
                                const isPast = daysUntil !== null && daysUntil < 0;
                                const isCurrentDay = daysUntil === 0;

                                return (
                                    <div key={date} className="card-gentle shadow-soft p-4 md:p-6">
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="flex items-center space-x-3">
                                                <div 
                                                    className="w-10 h-10 md:w-12 md:h-12 rounded-2xl flex items-center justify-center font-bold text-sm md:text-lg"
                                                    style={{
                                                        background: isPast 
                                                            ? 'rgba(232, 93, 74, 0.1)' 
                                                            : isCurrentDay 
                                                            ? 'var(--ripe-mango)' 
                                                            : 'var(--linen)',
                                                        color: isPast 
                                                            ? 'var(--warm-red)' 
                                                            : isCurrentDay 
                                                            ? 'var(--soft-black)' 
                                                            : 'var(--charcoal)'
                                                    }}
                                                >
                                                    {new Date(date + 'T00:00:00').getDate()}
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-sm md:text-base" style={{color: 'var(--charcoal)'}}>
                                                        {formatDate(date)}
                                                    </h3>
                                                    <span className="text-xs font-semibold" style={{
                                                        color: isPast 
                                                            ? 'var(--warm-red)' 
                                                            : isCurrentDay 
                                                            ? 'var(--ripe-mango)' 
                                                            : 'var(--warm-gray)'
                                                    }}>
                                                        {isPast 
                                                            ? `${Math.abs(daysUntil)} days ago` 
                                                            : isCurrentDay 
                                                            ? 'Today' 
                                                            : `In ${daysUntil} days`}
                                                    </span>
                                                </div>
                                            </div>
                                            <span className="text-xs font-bold px-3 py-1.5 rounded-xl" style={{background: 'var(--linen)', color: 'var(--charcoal)'}}>
                                                {tasks.length} task{tasks.length !== 1 ? 's' : ''}
                                            </span>
                                        </div>

                                        <div className="space-y-2">
                                            {tasks.map(task => (
                                                <div 
                                                    key={task.id}
                                                    className={`p-3 md:p-4 rounded-xl flex items-center justify-between type-${task.taskType} ${task.status === 'done' ? 'opacity-60' : ''}`}
                                                    style={{background: 'var(--cream-dark)'}}
                                                >
                                                    <div className="flex items-center space-x-3 flex-1 min-w-0">
                                                        <span className="w-2 h-2 rounded-full flex-shrink-0" style={{background: task.boardColor}}></span>
                                                        <span className={`font-semibold text-sm truncate ${task.status === 'done' ? 'line-through' : ''}`} style={{color: 'var(--charcoal)'}}>
                                                            {task.name}
                                                        </span>
                                                    </div>
                                                    <div className="flex items-center space-x-2 ml-3 flex-shrink-0">
                                                        <span className={`status-${task.status} text-xs font-bold px-2 py-1 rounded-lg`}>
                                                            {task.status}
                                                        </span>
                                                        <span className="text-xs font-semibold hidden sm:inline" style={{color: 'var(--warm-gray)'}}>
                                                            {task.boardName}
                                                        </span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                            {Object.keys(groupedByDate).length === 0 && (
                                <div className="text-center py-16" style={{color: 'var(--warm-gray)'}}>
                                    <i className="fas fa-calendar text-5xl mb-4 opacity-30"></i>
                                    <p className="font-semibold">No scheduled tasks</p>
                                    <p className="text-sm mt-2">Add due dates to see them here</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Team View Component
        function TeamView({ team, addTeamMember, updateTeamMember, deleteTeamMember }) {
            const [showAddForm, setShowAddForm] = useState(false);
            const [newMember, setNewMember] = useState({ name: '', email: '', role: '', avatar: 'ðŸ‘¤' });

            const avatarOptions = ['ðŸ‘¤', 'ðŸ‘©ðŸ½â€ðŸ’¼', 'ðŸ‘¨ðŸ½â€ðŸ’»', 'ðŸ‘©ðŸ½â€ðŸŽ¨', 'ðŸ‘¨ðŸ½â€ðŸ’¼', 'ðŸ‘©ðŸ½â€ðŸ”¬', 'ðŸ‘¨ðŸ½â€ðŸ«', 'ðŸ‘©ðŸ½â€âš•ï¸', 'ðŸ§‘ðŸ½â€ðŸš€', 'ðŸ‘¨ðŸ½â€ðŸ³'];

            const handleAddMember = () => {
                if (newMember.name.trim()) {
                    addTeamMember(newMember);
                    setNewMember({ name: '', email: '', role: '', avatar: 'ðŸ‘¤' });
                    setShowAddForm(false);
                }
            };

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-4 md:px-8 py-4 md:py-6" style={{borderColor: 'var(--linen)'}}>
                        <div className="flex flex-col sm:flex-row sm:items-center justify-between">
                            <div className="mb-3 sm:mb-0">
                                <h2 className="text-xl md:text-3xl font-bold mb-1" style={{color: 'var(--charcoal)'}}>Team</h2>
                                <p className="text-xs md:text-sm font-medium" style={{color: 'var(--warm-gray)'}}>
                                    Your collaborators ðŸ¥­
                                </p>
                            </div>
                            <button
                                onClick={() => setShowAddForm(true)}
                                className="btn-primary px-4 md:px-6 py-2 md:py-3 text-white rounded-2xl hover-lift font-semibold text-sm"
                            >
                                <i className="fas fa-plus mr-2"></i>
                                Add Member
                            </button>
                        </div>
                    </div>

                    <div className="flex-1 overflow-auto p-4 md:p-8 scrollbar-thin">
                        {/* Add Form */}
                        {showAddForm && (
                            <div className="card-gentle shadow-soft p-4 md:p-6 mb-6">
                                <h3 className="font-bold text-lg mb-4" style={{color: 'var(--charcoal)'}}>Add Team Member</h3>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div className="md:col-span-1">
                                        <label className="text-xs font-bold mb-2 block" style={{color: 'var(--warm-gray)'}}>Avatar</label>
                                        <div className="flex flex-wrap gap-2">
                                            {avatarOptions.map(avatar => (
                                                <button
                                                    key={avatar}
                                                    onClick={() => setNewMember({...newMember, avatar})}
                                                    className={`w-10 h-10 rounded-xl text-xl flex items-center justify-center transition-all ${newMember.avatar === avatar ? 'ring-2' : ''}`}
                                                    style={{
                                                        background: newMember.avatar === avatar ? 'var(--ripe-mango)' : 'var(--linen)',
                                                        ringColor: 'var(--mango-leaf)'
                                                    }}
                                                >
                                                    {avatar}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold mb-2 block" style={{color: 'var(--warm-gray)'}}>Name</label>
                                        <input
                                            type="text"
                                            value={newMember.name}
                                            onChange={(e) => setNewMember({...newMember, name: e.target.value})}
                                            placeholder="Full name"
                                            className="w-full px-4 py-3 border-2 rounded-2xl text-sm"
                                            style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold mb-2 block" style={{color: 'var(--warm-gray)'}}>Email</label>
                                        <input
                                            type="email"
                                            value={newMember.email}
                                            onChange={(e) => setNewMember({...newMember, email: e.target.value})}
                                            placeholder="email@example.com"
                                            className="w-full px-4 py-3 border-2 rounded-2xl text-sm"
                                            style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                        />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold mb-2 block" style={{color: 'var(--warm-gray)'}}>Role</label>
                                        <input
                                            type="text"
                                            value={newMember.role}
                                            onChange={(e) => setNewMember({...newMember, role: e.target.value})}
                                            placeholder="Job title"
                                            className="w-full px-4 py-3 border-2 rounded-2xl text-sm"
                                            style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                        />
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-3 mt-5">
                                    <button
                                        onClick={() => setShowAddForm(false)}
                                        className="px-5 py-2.5 rounded-xl font-semibold text-sm"
                                        style={{background: 'var(--linen)', color: 'var(--charcoal)'}}
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={handleAddMember}
                                        className="btn-primary px-5 py-2.5 text-white rounded-xl font-semibold text-sm"
                                    >
                                        Add Member
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Team Grid */}
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 team-grid">
                            {team.map(member => (
                                <div key={member.id} className="card-gentle shadow-soft p-5 md:p-6 hover-lift">
                                    <div className="text-center mb-4">
                                        <span className="text-4xl md:text-5xl">{member.avatar}</span>
                                    </div>
                                    <input
                                        type="text"
                                        value={member.name}
                                        onChange={(e) => updateTeamMember(member.id, { name: e.target.value })}
                                        className="w-full text-center text-base md:text-lg font-bold bg-transparent border-none focus:outline-none mb-1"
                                        style={{color: 'var(--charcoal)'}}
                                    />
                                    <input
                                        type="text"
                                        value={member.role}
                                        onChange={(e) => updateTeamMember(member.id, { role: e.target.value })}
                                        className="w-full text-center text-xs md:text-sm bg-transparent border-none focus:outline-none"
                                        style={{color: 'var(--warm-gray)'}}
                                        placeholder="Role"
                                    />
                                    <input
                                        type="email"
                                        value={member.email}
                                        onChange={(e) => updateTeamMember(member.id, { email: e.target.value })}
                                        className="w-full text-center text-xs bg-transparent border-none focus:outline-none mt-2"
                                        style={{color: 'var(--mango-leaf)'}}
                                        placeholder="email@example.com"
                                    />
                                    <button
                                        onClick={() => {
                                            if (confirm('Remove this team member?')) {
                                                deleteTeamMember(member.id);
                                            }
                                        }}
                                        className="w-full mt-4 py-2 rounded-xl text-xs font-semibold transition-all"
                                        style={{background: 'rgba(232, 93, 74, 0.1)', color: 'var(--warm-red)'}}
                                    >
                                        <i className="fas fa-trash mr-2"></i>
                                        Remove
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Dashboard View Component
        function DashboardView({ boards, team }) {
            const stats = useMemo(() => {
                let total = 0;
                let completed = 0;
                let stuck = 0;
                let overdue = 0;
                let dueToday = 0;
                let quickWins = 0;
                let focusTasks = 0;

                boards.forEach(board => {
                    if (board.id === 'brain-dump-board' || board.id === 'someday-maybe-board') return;
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            total++;
                            if (task.status === 'done') completed++;
                            if (task.status === 'stuck') stuck++;
                            if (task.isFocusTask && task.status !== 'done') focusTasks++;
                            if (task.timeEstimate === '5min' || task.timeEstimate === '15min') {
                                if (task.status !== 'done') quickWins++;
                            }
                            
                            const daysUntil = getDaysUntil(task.dueDate);
                            if (daysUntil !== null && daysUntil < 0 && task.status !== 'done') overdue++;
                            if (isToday(task.dueDate) && task.status !== 'done') dueToday++;
                        });
                    });
                });

                return { total, completed, stuck, overdue, dueToday, quickWins, focusTasks };
            }, [boards]);

            const brainDumpCount = useMemo(() => {
                const brainDump = boards.find(b => b.id === 'brain-dump-board');
                if (!brainDump) return 0;
                return brainDump.groups.reduce((sum, g) => sum + g.tasks.length, 0);
            }, [boards]);

            const somedayCount = useMemo(() => {
                const someday = boards.find(b => b.id === 'someday-maybe-board');
                if (!someday) return 0;
                return someday.groups.reduce((sum, g) => sum + g.tasks.length, 0);
            }, [boards]);

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-4 md:px-8 py-4 md:py-6" style={{borderColor: 'var(--linen)'}}>
                        <h2 className="text-xl md:text-3xl font-bold mb-1" style={{color: 'var(--charcoal)'}}>Dashboard</h2>
                        <p className="text-xs md:text-sm font-medium" style={{color: 'var(--warm-gray)'}}>
                            Your productivity at a glance ðŸ¥­
                        </p>
                    </div>

                    <div className="flex-1 overflow-auto p-4 md:p-8 scrollbar-thin">
                        <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8 dashboard-stats">
                            <StatCard 
                                icon="fa-tasks" 
                                label="Total Tasks" 
                                value={stats.total} 
                                color="var(--mango-leaf)"
                            />
                            <StatCard 
                                icon="fa-check-circle" 
                                label="Completed" 
                                value={stats.completed}
                                subtext={stats.total > 0 ? `${Math.round((stats.completed / stats.total) * 100)}%` : '0%'}
                                color="var(--sanctuary-sage)"
                            />
                            <StatCard 
                                icon="fa-bolt" 
                                label="Quick Wins" 
                                value={stats.quickWins} 
                                color="var(--sunny-yellow)"
                            />
                            <StatCard 
                                icon="fa-star" 
                                label="Focus Tasks" 
                                value={stats.focusTasks} 
                                color="var(--ripe-mango)"
                            />
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8">
                            <div className="card-gentle shadow-soft p-4 md:p-6">
                                <h3 className="text-base md:text-lg font-bold mb-4 md:mb-5" style={{color: 'var(--charcoal)'}}>
                                    <i className="fas fa-calendar-day mr-2" style={{color: 'var(--ripe-mango)'}}></i>
                                    Today's Focus
                                </h3>
                                <div className="space-y-3 md:space-y-4">
                                    <div className="flex items-center justify-between p-3 md:p-4 rounded-2xl" style={{background: 'var(--cream-dark)'}}>
                                        <span className="font-semibold text-sm" style={{color: 'var(--charcoal)'}}>Due Today</span>
                                        <span className="text-lg md:text-xl font-bold" style={{color: 'var(--ripe-mango)'}}>{stats.dueToday}</span>
                                    </div>
                                    <div className="flex items-center justify-between p-3 md:p-4 rounded-2xl" style={{background: 'var(--cream-dark)'}}>
                                        <span className="font-semibold text-sm" style={{color: 'var(--charcoal)'}}>Needs Attention</span>
                                        <span className="text-lg md:text-xl font-bold" style={{color: stats.overdue > 0 ? 'var(--warm-red)' : 'var(--sanctuary-sage)'}}>{stats.overdue}</span>
                                    </div>
                                    <div className="flex items-center justify-between p-3 md:p-4 rounded-2xl" style={{background: 'var(--cream-dark)'}}>
                                        <span className="font-semibold text-sm" style={{color: 'var(--charcoal)'}}>Feeling Stuck</span>
                                        <span className="text-lg md:text-xl font-bold" style={{color: stats.stuck > 0 ? 'var(--ripe-mango)' : 'var(--sanctuary-sage)'}}>{stats.stuck}</span>
                                    </div>
                                </div>
                            </div>

                            <div className="card-gentle shadow-soft p-4 md:p-6">
                                <h3 className="text-base md:text-lg font-bold mb-4 md:mb-5" style={{color: 'var(--charcoal)'}}>
                                    <i className="fas fa-brain mr-2" style={{color: 'var(--ripe-mango)'}}></i>
                                    Capture Zones
                                </h3>
                                <div className="space-y-3 md:space-y-4">
                                    <div className="flex items-center justify-between p-3 md:p-4 rounded-2xl" style={{background: 'rgba(244, 162, 89, 0.15)'}}>
                                        <div className="flex items-center">
                                            <i className="fas fa-brain mr-3" style={{color: 'var(--ripe-mango)'}}></i>
                                            <span className="font-semibold text-sm" style={{color: 'var(--charcoal)'}}>Brain Dump</span>
                                        </div>
                                        <span className="text-lg md:text-xl font-bold" style={{color: 'var(--ripe-mango)'}}>{brainDumpCount}</span>
                                    </div>
                                    <div className="flex items-center justify-between p-3 md:p-4 rounded-2xl" style={{background: 'rgba(168, 200, 216, 0.15)'}}>
                                        <div className="flex items-center">
                                            <i className="fas fa-cloud mr-3" style={{color: 'var(--sky)'}}></i>
                                            <span className="font-semibold text-sm" style={{color: 'var(--charcoal)'}}>Someday / Maybe</span>
                                        </div>
                                        <span className="text-lg md:text-xl font-bold" style={{color: 'var(--sky)'}}>{somedayCount}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Progress Overview */}
                        <div className="card-gentle shadow-soft p-4 md:p-6">
                            <h3 className="text-base md:text-lg font-bold mb-4 md:mb-5" style={{color: 'var(--charcoal)'}}>
                                <i className="fas fa-chart-pie mr-2" style={{color: 'var(--mango-leaf)'}}></i>
                                Board Progress
                            </h3>
                            <div className="space-y-3 md:space-y-4">
                                {boards.filter(b => b.id !== 'brain-dump-board' && b.id !== 'someday-maybe-board').map(board => {
                                    const total = board.groups.reduce((sum, g) => sum + g.tasks.length, 0);
                                    const completed = board.groups.reduce((sum, g) => sum + g.tasks.filter(t => t.status === 'done').length, 0);
                                    const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

                                    return (
                                        <div key={board.id}>
                                            <div className="flex items-center justify-between mb-2">
                                                <div className="flex items-center">
                                                    <span className="w-3 h-3 rounded-full mr-3" style={{background: board.color}}></span>
                                                    <span className="font-semibold text-sm" style={{color: 'var(--charcoal)'}}>{board.name}</span>
                                                </div>
                                                <span className="text-xs font-bold" style={{color: 'var(--warm-gray)'}}>
                                                    {completed}/{total} ({percentage}%)
                                                </span>
                                            </div>
                                            <div className="w-full h-2 md:h-2.5 rounded-full" style={{background: 'var(--linen)'}}>
                                                <div 
                                                    className="h-full rounded-full transition-all"
                                                    style={{width: `${percentage}%`, background: board.color}}
                                                ></div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Stat Card Component
        function StatCard({ icon, label, value, subtext, color }) {
            return (
                <div className="card-gentle shadow-soft p-4 md:p-6 hover-lift">
                    <div className="flex items-center justify-between mb-2 md:mb-3">
                        <div 
                            className="w-10 h-10 md:w-12 md:h-12 rounded-2xl flex items-center justify-center"
                            style={{background: `${color}20`}}
                        >
                            <i className={`fas ${icon} text-base md:text-lg`} style={{color}}></i>
                        </div>
                        {subtext && (
                            <span className="text-xs font-bold px-2 py-1 rounded-lg" style={{background: 'var(--linen)', color: 'var(--warm-gray)'}}>
                                {subtext}
                            </span>
                        )}
                    </div>
                    <div className="text-2xl md:text-3xl font-bold mb-1" style={{color: 'var(--charcoal)'}}>{value}</div>
                    <div className="text-xs font-semibold" style={{color: 'var(--warm-gray)'}}>{label}</div>
                </div>
            );
        }

        // Render
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
