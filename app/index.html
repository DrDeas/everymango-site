<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EveryMango - Gentle Project Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.5/babel.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* EveryMango Brand Colors */
            --mango-blush: #D94E41;
            --warm-red: #E85D4A;
            --ripe-mango: #F4A259;
            --deep-gold: #F9A825;
            --golden-flesh: #F8C56D;
            --sunny-yellow: #F8D54C;
            --mango-leaf: #6B8E6B;
            --sanctuary-sage: #A8B5A0;
            --soft-charcoal: #4A4A4A;
            
            /* Warm, gentle background palette */
            --cream: #FDF6E9;
            --cream-dark: #F5EDD8;
            --linen: #EDE5D4;
            --warm-gray: #9A9590;
            --charcoal: #4A4A4A;
            --soft-black: #2d2a27;
            
            /* Sidebar colors - mango leaf inspired */
            --sage: #6B8E6B;
            --sage-dark: #5A7A5A;
            --sage-light: #A8B5A0;
            --moss: #4A6B4A;
            
            /* Gentle status colors - warm mango tones */
            --status-new: #F5EDD8;
            --status-working: #F8C56D;
            --status-stuck: #F4A259;
            --status-done: #A8B5A0;
            
            /* Soft accent colors */
            --coral: #E85D4A;
            --peach: #F8C56D;
            --lavender: #c4b8d8;
            --sky: #a8c8d8;
            --mint: #A8B5A0;
            --rose: #d8a8b8;
            
            /* Priority colors - warm spectrum */
            --priority-low: #a8c8d8;
            --priority-medium: #F8C56D;
            --priority-high: #F4A259;
            --priority-critical: #D94E41;
            
            /* Energy colors */
            --energy-low: #a8c8d8;
            --energy-medium: #F8C56D;
            --energy-high: #F4A259;
            
            /* Task type colors */
            --type-creative: #c4b8d8;
            --type-admin: #F8C56D;
            --type-meeting: #a8c8d8;
            --type-deep-work: #A8B5A0;
            --type-communication: #F4A259;
            --type-learning: #a8d8d8;
        }
        
        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: var(--cream);
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Quicksand', sans-serif;
        }
        
        /* Gentle status badges */
        .status-new { 
            background-color: var(--status-new); 
            color: var(--charcoal); 
        }
        .status-working { 
            background-color: var(--status-working); 
            color: var(--soft-black); 
        }
        .status-stuck { 
            background-color: var(--status-stuck); 
            color: var(--soft-black); 
        }
        .status-done { 
            background-color: var(--status-done); 
            color: var(--soft-black); 
        }
        
        /* Priority colors - soft */
        .priority-low { background-color: var(--priority-low); color: var(--soft-black); }
        .priority-medium { background-color: var(--priority-medium); color: var(--soft-black); }
        .priority-high { background-color: var(--priority-high); color: var(--soft-black); }
        .priority-critical { background-color: var(--priority-critical); color: white; }

        /* Time estimate badges */
        .time-5min { background-color: var(--mint); color: var(--soft-black); }
        .time-15min { background-color: var(--sky); color: var(--soft-black); }
        .time-30min { background-color: var(--peach); color: var(--soft-black); }
        .time-1hr { background-color: var(--coral); color: white; }
        .time-2hr { background-color: var(--lavender); color: var(--soft-black); }

        /* Energy level badges */
        .energy-high { background-color: var(--energy-high); color: var(--soft-black); }
        .energy-medium { background-color: var(--energy-medium); color: var(--soft-black); }
        .energy-low { background-color: var(--energy-low); color: var(--soft-black); }

        /* Task type borders - softer */
        .type-creative { border-left: 4px solid var(--type-creative); }
        .type-admin { border-left: 4px solid var(--type-admin); }
        .type-meeting { border-left: 4px solid var(--type-meeting); }
        .type-deep-work { border-left: 4px solid var(--type-deep-work); }
        .type-communication { border-left: 4px solid var(--type-communication); }
        .type-learning { border-left: 4px solid var(--type-learning); }
        
        /* Gentle animations */
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.9; }
        }
        .timer-active {
            animation: timerPulse 3s ease-in-out infinite;
        }

        @keyframes brainDumpPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(244, 162, 89, 0.4); }
            50% { box-shadow: 0 0 0 6px rgba(244, 162, 89, 0); }
        }
        .brain-dump-active {
            animation: brainDumpPulse 2.5s ease-in-out infinite;
        }

        .recently-viewed-badge {
            background: var(--golden-flesh);
        }

        /* Time slot styles */
        .time-slot {
            min-height: 80px;
            border: 2px dashed var(--linen);
            transition: all 0.3s ease;
            border-radius: 16px;
        }
        .time-slot:hover {
            border-color: var(--sage);
            background: rgba(107, 142, 107, 0.08);
        }
        .time-slot.occupied {
            border: 2px solid var(--sage-light);
            background: rgba(107, 142, 107, 0.06);
        }
        
        /* Custom scrollbar - warm and gentle */
        .scrollbar-thin::-webkit-scrollbar { 
            width: 10px; 
            height: 10px; 
        }
        .scrollbar-thin::-webkit-scrollbar-track { 
            background: transparent; 
        }
        .scrollbar-thin::-webkit-scrollbar-thumb { 
            background: var(--linen); 
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { 
            background: var(--warm-gray); 
        }

        /* Sidebar scrollbar */
        .scrollbar-sage::-webkit-scrollbar { 
            width: 10px; 
            height: 10px; 
        }
        .scrollbar-sage::-webkit-scrollbar-track { 
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin: 4px 0;
        }
        .scrollbar-sage::-webkit-scrollbar-thumb { 
            background: rgba(255,255,255,0.35); 
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        .scrollbar-sage::-webkit-scrollbar-thumb:hover { 
            background: rgba(255,255,255,0.5); 
        }
        
        /* Smooth transitions */
        * {
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }
        
        /* Frosted glass effect - warm tint */
        .glass-effect {
            background: rgba(253, 246, 233, 0.9);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
        }
        
        /* Soft, pillowy shadows */
        .shadow-soft {
            box-shadow: 0 2px 8px rgba(74, 74, 74, 0.04), 0 8px 24px rgba(74, 74, 74, 0.06);
        }
        .shadow-soft-lg {
            box-shadow: 0 4px 12px rgba(74, 74, 74, 0.05), 0 16px 40px rgba(74, 74, 74, 0.08);
        }
        
        /* Hover effects - gentle lift */
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(74, 74, 74, 0.08), 0 20px 48px rgba(74, 74, 74, 0.1);
        }
        
        /* Button styles - mango-inspired */
        .btn-primary {
            background: var(--mango-leaf);
            border: none;
            box-shadow: 0 2px 8px rgba(107, 142, 107, 0.3);
            font-weight: 600;
            letter-spacing: 0.01em;
        }
        .btn-primary:hover {
            background: var(--sage-dark);
            box-shadow: 0 4px 16px rgba(107, 142, 107, 0.4);
        }

        /* Focus Mode styles */
        .focus-mode-active {
            animation: focusPulse 2.5s ease-in-out infinite;
        }
        @keyframes focusPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(107, 142, 107, 0.3); }
            50% { box-shadow: 0 0 0 8px rgba(107, 142, 107, 0); }
        }

        /* Quick Win badge - sunny yellow */
        .quick-win-badge {
            background: var(--sunny-yellow);
            color: var(--soft-black);
            animation: quickWinGlow 2s ease-in-out infinite;
        }
        @keyframes quickWinGlow {
            0%, 100% { box-shadow: 0 2px 8px rgba(248, 213, 76, 0.4); }
            50% { box-shadow: 0 2px 16px rgba(248, 213, 76, 0.7); }
        }
        
        input, select, textarea {
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--mango-leaf) !important;
            box-shadow: 0 0 0 4px rgba(107, 142, 107, 0.15);
        }
        
        .card-gentle {
            background: white;
            border-radius: 20px;
            border: 1px solid var(--linen);
        }

        /* Progress ring animation */
        @keyframes progressFill {
            from { stroke-dashoffset: 251.2; }
        }
        .progress-ring {
            animation: progressFill 1s ease-out forwards;
        }

        /* Draggable task */
        .draggable-task {
            cursor: move;
            user-select: none;
        }
        .draggable-task:active {
            opacity: 0.8;
            cursor: grabbing;
        }

        /* Someday/Maybe styling */
        .someday-maybe-badge {
            background: var(--sky);
            color: var(--soft-black);
        }

        /* Rolled over task indicator - gentle mango tone */
        .rolled-over-badge {
            background: var(--golden-flesh);
            color: var(--soft-black);
            animation: gentlePulse 3s ease-in-out infinite;
        }
        @keyframes gentlePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* No-judgment mode styles */
        .no-judgment-mode .status-stuck {
            background: var(--golden-flesh) !important;
        }
        .no-judgment-mode .overdue-text {
            color: var(--warm-gray) !important;
        }

        /* Gentle reminder styling */
        .gentle-reminder {
            background: rgba(168, 200, 216, 0.15);
            border-left: 3px solid var(--sky);
        }

        /* Celebration animation - mango ripening! */
        @keyframes celebratePop {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        .celebrate {
            animation: celebratePop 0.4s ease-out;
        }

        /* Notification styles */
        @keyframes bellRing {
            0%, 100% { transform: rotate(0deg); }
            10%, 30%, 50% { transform: rotate(-8deg); }
            20%, 40% { transform: rotate(8deg); }
            60% { transform: rotate(0deg); }
        }
        .bell-ringing {
            animation: bellRing 1s ease-in-out;
        }

        .notification-panel {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
            box-shadow: 0 8px 40px rgba(74, 74, 74, 0.12), 0 2px 12px rgba(74, 74, 74, 0.08);
            border-radius: 20px;
        }

        .notification-item {
            transition: all 0.2s ease;
        }
        .notification-item:hover {
            background: rgba(107, 142, 107, 0.08);
        }
        .notification-item.unread {
            background: rgba(244, 162, 89, 0.1);
            border-left: 3px solid var(--ripe-mango);
        }

        .notification-badge {
            background: var(--warm-red);
            color: white;
            min-width: 20px;
            height: 20px;
            font-size: 11px;
            font-weight: 700;
            animation: badgePulse 2.5s ease-in-out infinite;
        }
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        /* Why it matters field */
        .why-matters-field {
            background: rgba(244, 162, 89, 0.12);
            border-left: 3px solid var(--ripe-mango);
            border-radius: 12px;
        }
        .why-matters-badge {
            background: var(--ripe-mango);
            color: var(--soft-black);
        }

        /* Reminder time picker */
        .reminder-chip {
            background: rgba(107, 142, 107, 0.15);
            border: 1px solid rgba(107, 142, 107, 0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        .reminder-chip:hover {
            background: rgba(107, 142, 107, 0.25);
        }
        .reminder-chip.active {
            background: var(--mango-leaf);
            color: white;
            border-color: transparent;
        }

        /* Toast notification */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        .toast-enter {
            animation: slideInRight 0.4s ease-out forwards;
        }
        .toast-exit {
            animation: slideOutRight 0.3s ease-in forwards;
        }

        /* Due soon indicator */
        .due-soon-glow {
            box-shadow: 0 0 0 2px rgba(248, 197, 109, 0.4);
            animation: dueSoonPulse 2.5s ease-in-out infinite;
        }
        @keyframes dueSoonPulse {
            0%, 100% { box-shadow: 0 0 0 2px rgba(248, 197, 109, 0.4); }
            50% { box-shadow: 0 0 0 4px rgba(248, 197, 109, 0.2); }
        }

        /* Toggle switch styling */
        .toggle-track {
            transition: background-color 0.3s ease;
        }
        .toggle-thumb {
            transition: left 0.3s ease, background-color 0.3s ease;
        }

        /* Sidebar styling - mango leaf gradient */
        .sidebar-gentle {
            background: linear-gradient(180deg, var(--mango-leaf) 0%, var(--sage-dark) 100%);
        }

        /* Select dropdown styling */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%234A4A4A' d='M0 0l5 6 5-6z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 28px;
            cursor: pointer;
        }
        select:hover {
            opacity: 0.9;
        }

        /* Badge styling override for consistency */
        .badge-soft {
            font-weight: 600;
            border-radius: 10px;
            padding: 4px 10px;
        }

        /* Mango logo animation */
        .mango-logo {
            transition: transform 0.3s ease;
        }
        .mango-logo:hover {
            transform: rotate(-5deg) scale(1.05);
        }

        /* Brand tagline styling */
        .tagline {
            font-size: 10px;
            letter-spacing: 0.05em;
            opacity: 0.8;
        }

        /* Embedded browser warning styling */
        .browser-warning {
            animation: gentleSlideIn 0.5s ease-out;
        }
        @keyframes gentleSlideIn {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBFP8FTm4VVZYmkI21zS-q1dH-RRCZnEZY",
            authDomain: "everymango-a3a10.firebaseapp.com",
            projectId: "everymango-a3a10",
            storageBucket: "everymango-a3a10.firebasestorage.app",
            messagingSenderId: "646235082520",
            appId: "1:646235082520:web:9ac40262c5b188d265d86d"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const { useState, useEffect, useMemo, useRef } = React;

        // EveryMango Logo Component
        function MangoLogo({ size = 32, className = "" }) {
            return (
                <svg 
                    width={size} 
                    height={size} 
                    viewBox="0 0 64 88" 
                    className={`mango-logo ${className}`}
                    style={{ transform: 'rotate(15deg)' }}
                >
                    <defs>
                        <linearGradient id="mangoGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stopColor="#E85D4A" />
                            <stop offset="35%" stopColor="#F4A259" />
                            <stop offset="65%" stopColor="#F8C56D" />
                            <stop offset="100%" stopColor="#F8D54C" />
                        </linearGradient>
                        <linearGradient id="leafGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stopColor="#6B8E6B" />
                            <stop offset="100%" stopColor="#5A7A5A" />
                        </linearGradient>
                    </defs>
                    
                    {/* Leaf */}
                    <ellipse 
                        cx="38" 
                        cy="8" 
                        rx="12" 
                        ry="5" 
                        fill="url(#leafGradient)"
                        transform="rotate(35, 38, 8)"
                    />
                    <path 
                        d="M32 10 Q38 8 44 10" 
                        stroke="#5A7A5A" 
                        strokeWidth="1.5" 
                        fill="none"
                        transform="rotate(35, 38, 8)"
                    />
                    
                    {/* Mango body */}
                    <path 
                        d="M32 12 
                           C14 12 6 32 6 48 
                           C6 66 18 82 32 84 
                           L38 84
                           L32 78
                           C46 82 58 66 58 48 
                           C58 32 50 12 32 12 Z"
                        fill="url(#mangoGradient)"
                        stroke="#4A4A4A"
                        strokeWidth="2.5"
                    />
                    
                    {/* Highlight */}
                    <ellipse 
                        cx="22" 
                        cy="32" 
                        rx="8" 
                        ry="12" 
                        fill="white" 
                        opacity="0.4"
                        transform="rotate(-15, 22, 32)"
                    />
                </svg>
            );
        }

        // Login Screen Component
        function LoginScreen() {
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [isEmbeddedBrowser, setIsEmbeddedBrowser] = useState(false);
            const [browserName, setBrowserName] = useState('');
        
            useEffect(() => {
                // Detect if running in embedded/in-app browser
                const ua = navigator.userAgent || navigator.vendor || window.opera;
                let detected = false;
                let name = '';
        
                if (ua.includes('Instagram')) {
                    detected = true;
                    name = 'Instagram';
                } else if (ua.includes('FBAN') || ua.includes('FBAV')) {
                    detected = true;
                    name = 'Facebook';
                } else if (ua.includes('TikTok')) {
                    detected = true;
                    name = 'TikTok';
                } else if (ua.includes('LinkedInApp')) {
                    detected = true;
                    name = 'LinkedIn';
                } else if (ua.includes('Twitter')) {
                    detected = true;
                    name = 'Twitter';
                } else if (ua.includes('Snapchat')) {
                    detected = true;
                    name = 'Snapchat';
                } else if (ua.includes('MicroMessenger')) {
                    detected = true;
                    name = 'WeChat';
                } else if (ua.includes('wv') || ua.includes('WebView')) {
                    detected = true;
                    name = 'this app';
                }
                
                setIsEmbeddedBrowser(detected);
                setBrowserName(name);
            }, []);
        
            const handleGoogleSignIn = async () => {
                setIsLoading(true);
                setError('');
                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    await auth.signInWithPopup(provider);
                } catch (err) {
                    console.error('Sign in error:', err);
                    setError(err.message || 'Failed to sign in. Please try again.');
                    setIsLoading(false);
                }
            };
        
            const openInBrowser = () => {
                const currentUrl = window.location.href;
                window.open(currentUrl, '_system') || window.open(currentUrl, '_blank');
            };
        
            return (
                <div className="min-h-screen flex items-center justify-center p-8" style={{background: 'linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%)'}}>
                    <div className="card-gentle shadow-soft-lg p-12 max-w-md w-full text-center">
                        <div className="flex justify-center mb-6">
                            <MangoLogo size={80} />
                        </div>
                        <h1 className="text-3xl font-bold mb-2" style={{color: 'var(--charcoal)', fontFamily: 'Quicksand, sans-serif'}}>
                            EveryMango
                        </h1>
                        <p className="text-sm mb-8" style={{color: 'var(--warm-gray)'}}>
                            Ripen at your own pace ðŸ¥­
                        </p>
                        
                        <p className="mb-6" style={{color: 'var(--charcoal)'}}>
                            Gentle project management for ADHD minds
                        </p>
        
                        {/* Embedded Browser Warning */}
                        {isEmbeddedBrowser && (
                            <div className="browser-warning mb-6 p-5 rounded-2xl text-left" style={{background: 'rgba(244, 162, 89, 0.15)', border: '2px solid var(--ripe-mango)'}}>
                                <div className="flex items-start space-x-3">
                                    <i className="fas fa-info-circle text-xl mt-1" style={{color: 'var(--ripe-mango)'}}></i>
                                    <div className="flex-1">
                                        <p className="font-bold text-sm mb-2" style={{color: 'var(--charcoal)'}}>
                                            Hey there! ðŸ¥­ Quick heads-up
                                        </p>
                                        <p className="text-sm mb-3" style={{color: 'var(--charcoal)'}}>
                                            For security, Google doesn't allow sign-in from {browserName || 'in-app browsers'}. No worries - just open EveryMango in your main browser!
                                        </p>
                                        <button
                                            onClick={openInBrowser}
                                            className="w-full px-5 py-3 rounded-2xl font-semibold flex items-center justify-center space-x-2 transition-all hover-lift"
                                            style={{background: 'var(--mango-leaf)', color: 'white'}}
                                        >
                                            <i className="fas fa-external-link-alt"></i>
                                            <span>Open in Safari/Chrome</span>
                                        </button>
                                        <p className="text-xs mt-3 font-medium" style={{color: 'var(--warm-gray)'}}>
                                            Or tap the menu button (â€¢â€¢â€¢) and select "Open in Browser"
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}
        
                        {error && (
                            <div className="mb-4 p-4 rounded-2xl text-sm" style={{background: 'rgba(232, 93, 74, 0.1)', color: 'var(--warm-red)'}}>
                                {error}
                            </div>
                        )}
        
                        {!isEmbeddedBrowser && (
                            <button
                                onClick={handleGoogleSignIn}
                                disabled={isLoading}
                                className="w-full px-6 py-4 rounded-2xl font-semibold flex items-center justify-center space-x-3 transition-all hover-lift disabled:opacity-50"
                                style={{background: 'white', border: '2px solid var(--linen)', color: 'var(--charcoal)'}}
                            >
                                {isLoading ? (
                                    <i className="fas fa-spinner fa-spin"></i>
                                ) : (
                                    <>
                                        <svg width="20" height="20" viewBox="0 0 24 24">
                                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                        </svg>
                                        <span>Continue with Google</span>
                                    </>
                                )}
                            </button>
                        )}
        
                        <p className="mt-8 text-xs" style={{color: 'var(--warm-gray)'}}>
                            Your data is stored securely and syncs across all your devices
                        </p>
                    </div>
                </div>
            );
        }

        // Loading Screen Component
        function LoadingScreen() {
            return (
                <div className="min-h-screen flex items-center justify-center" style={{background: 'var(--cream)'}}>
                    <div className="text-center">
                        <MangoLogo size={64} className="mx-auto mb-4" />
                        <div className="flex items-center justify-center space-x-2">
                            <i className="fas fa-spinner fa-spin text-2xl" style={{color: 'var(--mango-leaf)'}}></i>
                            <span className="font-semibold" style={{color: 'var(--charcoal)'}}>Loading your mangoes...</span>
                        </div>
                    </div>
                </div>
            );
        }

        // Utility functions
        const generateId = () => Math.random().toString(36).substr(2, 9);
        
        const formatDate = (date) => {
            if (!date) return '';
            return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        };

        const getDaysUntil = (date) => {
            if (!date) return null;
            const [year, month, day] = date.split('-').map(Number);
            const target = new Date(year, month - 1, day);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const diffTime = target - today;
            const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        };

        const isToday = (dateString) => {
            if (!dateString) return false;
            const [year, month, day] = dateString.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return date.getTime() === today.getTime();
        };

        const getTimeInMinutes = (timeEstimate) => {
            const map = { '5min': 5, '15min': 15, '30min': 30, '1hr': 60, '2hr': 120 };
            return map[timeEstimate] || 30;
        };

        const isYesterday = (dateString) => {
            if (!dateString) return false;
            const [year, month, day] = dateString.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            yesterday.setHours(0, 0, 0, 0);
            return date.getTime() === yesterday.getTime();
        };

        const isPastDate = (dateString) => {
            if (!dateString) return false;
            const [year, month, day] = dateString.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return date < today;
        };

        // Initial demo data
        const BRAIN_DUMP_BOARD_ID = 'brain-dump-board';
        const BRAIN_DUMP_GROUP_ID = 'brain-dump-group';
        const SOMEDAY_MAYBE_BOARD_ID = 'someday-maybe-board';
        const SOMEDAY_MAYBE_GROUP_ID = 'someday-maybe-group';
        
        const initialBoards = [
            {
                id: BRAIN_DUMP_BOARD_ID,
                name: 'Brain Dump',
                color: '#F4A259',
                isPinned: true,
                groups: [
                    {
                        id: BRAIN_DUMP_GROUP_ID,
                        name: 'Captured Thoughts',
                        color: '#F4A259',
                        tasks: []
                    }
                ]
            },
            {
                id: SOMEDAY_MAYBE_BOARD_ID,
                name: 'Someday / Maybe',
                color: '#a8c8d8',
                isPinned: true,
                groups: [
                    {
                        id: SOMEDAY_MAYBE_GROUP_ID,
                        name: 'Ideas & Possibilities',
                        color: '#a8c8d8',
                        tasks: []
                    }
                ]
            },
            {
                id: 'board1',
                name: 'Marketing Campaign',
                color: '#6B8E6B',
                groups: [
                    {
                        id: 'group1',
                        name: 'Planning',
                        color: '#A8B5A0',
                        tasks: [
                            {
                                id: 'task1',
                                name: 'Define campaign objectives',
                                status: 'done',
                                priority: 'high',
                                assignee: 'Sarah Johnson',
                                dueDate: new Date().toISOString().split('T')[0],
                                notes: 'Target Q1 2025 launch',
                                timeEstimate: '1hr',
                                energyLevel: 'high',
                                taskType: 'deep-work',
                                isFocusTask: false,
                                timeBlock: null
                            },
                            {
                                id: 'task2',
                                name: 'Market research',
                                status: 'working',
                                priority: 'medium',
                                assignee: 'Mike Chen',
                                dueDate: new Date().toISOString().split('T')[0],
                                notes: '',
                                timeEstimate: '2hr',
                                energyLevel: 'medium',
                                taskType: 'learning',
                                isFocusTask: true,
                                timeBlock: null
                            }
                        ]
                    },
                    {
                        id: 'group2',
                        name: 'Execution',
                        color: '#A8B5A0',
                        tasks: [
                            {
                                id: 'task3',
                                name: 'Design creative assets',
                                status: 'new',
                                priority: 'high',
                                assignee: 'Emily Davis',
                                dueDate: new Date().toISOString().split('T')[0],
                                notes: '',
                                timeEstimate: '15min',
                                energyLevel: 'high',
                                taskType: 'creative',
                                isFocusTask: true,
                                timeBlock: '09:00'
                            }
                        ]
                    }
                ]
            }
        ];

        const initialTeam = [
            { id: 'member1', name: 'Sarah Johnson', email: 'sarah@company.com', role: 'Project Manager', avatar: 'ðŸ‘©ðŸ½â€ðŸ’¼' },
            { id: 'member2', name: 'Mike Chen', email: 'mike@company.com', role: 'Developer', avatar: 'ðŸ‘¨ðŸ½â€ðŸ’»' },
            { id: 'member3', name: 'Emily Davis', email: 'emily@company.com', role: 'Designer', avatar: 'ðŸ‘©ðŸ½â€ðŸŽ¨' },
            { id: 'member4', name: 'John Smith', email: 'john@company.com', role: 'Marketing', avatar: 'ðŸ‘¨ðŸ½â€ðŸ’¼' }
        ];

        // Main App Component
        function App() {
            // Authentication state
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);

            // Listen for auth state changes
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((firebaseUser) => {
                    setUser(firebaseUser);
                    setAuthLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const [boards, setBoards] = useState(initialBoards);
            const [dataLoaded, setDataLoaded] = useState(false);
            
            const [team, setTeam] = useState(initialTeam);
            
            const [activeBoard, setActiveBoard] = useState(boards[0]?.id);
            const [view, setView] = useState('board');
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [focusMode, setFocusMode] = useState(false);
            const [quickWinsOnly, setQuickWinsOnly] = useState(false);
            const [energyFilter, setEnergyFilter] = useState(null);
            const [brainDumpText, setBrainDumpText] = useState('');
            const [recentlyViewed, setRecentlyViewed] = useState(() => {
                const saved = localStorage.getItem('everyMangoRecentlyViewed');
                return saved ? JSON.parse(saved) : [];
            });
            const [showContextModal, setShowContextModal] = useState(false);
            const [contextTask, setContextTask] = useState(null);
            const [noJudgmentMode, setNoJudgmentMode] = useState(() => {
                const saved = localStorage.getItem('everyMangoNoJudgmentMode');
                return saved ? JSON.parse(saved) : false;
            });
            const [notifications, setNotifications] = useState(() => {
                const saved = localStorage.getItem('everyMangoNotifications');
                return saved ? JSON.parse(saved) : [];
            });
            const [showNotificationPanel, setShowNotificationPanel] = useState(false);
            const [toasts, setToasts] = useState([]);
            const [notificationsEnabled, setNotificationsEnabled] = useState(() => {
                const saved = localStorage.getItem('everyMangoNotificationsEnabled');
                return saved ? JSON.parse(saved) : true;
            });
            const [pomodoroActive, setPomodoroActive] = useState(false);
            const [pomodoroTime, setPomodoroTime] = useState(25 * 60);
            const [isBreak, setIsBreak] = useState(false);
            const [activeTaskId, setActiveTaskId] = useState(null);

            // Load data from Firestore when user logs in
            useEffect(() => {
                if (!user) {
                    setDataLoaded(false);
                    return;
                }

                const loadUserData = async () => {
                    try {
                        // Load boards
                        const boardsDoc = await db.collection('users').doc(user.uid).collection('data').doc('boards').get();
                        if (boardsDoc.exists) {
                            const loadedBoards = boardsDoc.data().boards;
                            let processedBoards = loadedBoards.map(board => ({
                                ...board,
                                groups: board.groups.map(group => ({
                                    ...group,
                                    tasks: group.tasks.map(task => ({
                                        timeEstimate: '30min',
                                        energyLevel: 'medium',
                                        taskType: 'admin',
                                        isFocusTask: false,
                                        timeBlock: null,
                                        contextNotes: '',
                                        rolloverCount: 0,
                                        whyItMatters: '',
                                        reminderTime: null,
                                        ...task
                                    }))
                                }))
                            }));
                            
                            if (!processedBoards.some(b => b.id === 'brain-dump-board')) {
                                processedBoards = [initialBoards[0], ...processedBoards];
                            }
                            if (!processedBoards.some(b => b.id === 'someday-maybe-board')) {
                                const brainDumpIndex = processedBoards.findIndex(b => b.id === 'brain-dump-board');
                                processedBoards.splice(brainDumpIndex + 1, 0, initialBoards[1]);
                            }
                            
                            setBoards(processedBoards);
                        }

                        const teamDoc = await db.collection('users').doc(user.uid).collection('data').doc('team').get();
                        if (teamDoc.exists) {
                            setTeam(teamDoc.data().team);
                        }

                        setDataLoaded(true);
                    } catch (error) {
                        console.error('Error loading data from Firestore:', error);
                        setDataLoaded(true);
                    }
                };

                loadUserData();
            }, [user]);

            // Save boards to Firestore when they change
            useEffect(() => {
                if (!user || !dataLoaded) return;
                
                const saveBoards = async () => {
                    try {
                        await db.collection('users').doc(user.uid).collection('data').doc('boards').set({
                            boards: boards,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } catch (error) {
                        console.error('Error saving boards:', error);
                    }
                };

                const timeoutId = setTimeout(saveBoards, 1000);
                return () => clearTimeout(timeoutId);
            }, [boards, user, dataLoaded]);

            // Save team to Firestore when it changes
            useEffect(() => {
                if (!user || !dataLoaded) return;
                
                const saveTeam = async () => {
                    try {
                        await db.collection('users').doc(user.uid).collection('data').doc('team').set({
                            team: team,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } catch (error) {
                        console.error('Error saving team:', error);
                    }
                };

                const timeoutId = setTimeout(saveTeam, 1000);
                return () => clearTimeout(timeoutId);
            }, [team, user, dataLoaded]);

            useEffect(() => {
                localStorage.setItem('everyMangoNoJudgmentMode', JSON.stringify(noJudgmentMode));
            }, [noJudgmentMode]);

            useEffect(() => {
                localStorage.setItem('everyMangoNotifications', JSON.stringify(notifications));
            }, [notifications]);

            useEffect(() => {
                localStorage.setItem('everyMangoNotificationsEnabled', JSON.stringify(notificationsEnabled));
            }, [notificationsEnabled]);

            // Now using Firestore instead of localStorage for boards and team
            // useEffect(() => {
            //     localStorage.setItem('everyMangoBoards', JSON.stringify(boards));
            // }, [boards]);

            // useEffect(() => {
            //     localStorage.setItem('everyMangoTeam', JSON.stringify(team));
            // }, [team]);

            useEffect(() => {
                localStorage.setItem('everyMangoRecentlyViewed', JSON.stringify(recentlyViewed));
            }, [recentlyViewed]);

            useEffect(() => {
                let interval;
                if (pomodoroActive && pomodoroTime > 0) {
                    interval = setInterval(() => {
                        setPomodoroTime(time => time - 1);
                    }, 1000);
                } else if (pomodoroTime === 0) {
                    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZSA0PVqzn7a1aFgpBm+H0wXEkBS+E0PLaizsIGGS57eicTgwMUrDk7bBdGApDneH0xHEmBSyB0PLdizgIG2i98Oah');
                    audio.play().catch(() => {});
                    
                    if (isBreak) {
                        setPomodoroTime(25 * 60);
                        setIsBreak(false);
                        setPomodoroActive(false);
                    } else {
                        setPomodoroTime(5 * 60);
                        setIsBreak(true);
                    }
                }
                return () => clearInterval(interval);
            }, [pomodoroActive, pomodoroTime, isBreak]);

            const currentBoard = boards.find(b => b.id === activeBoard);

            const addBoard = () => {
                const newGroupId = generateId();
                const newTaskId = generateId();
                const newBoard = {
                    id: generateId(),
                    name: 'New Board',
                    color: '#6B8E6B',
                    groups: [{
                        id: newGroupId,
                        name: 'New Group',
                        color: '#A8B5A0',
                        tasks: [{
                            id: newTaskId,
                            name: 'New Task',
                            status: 'new',
                            priority: 'medium',
                            assignee: '',
                            dueDate: '',
                            notes: '',
                            timeEstimate: '30min',
                            energyLevel: 'medium',
                            taskType: 'admin',
                            isFocusTask: false,
                            timeBlock: null,
                            contextNotes: '',
                            rolloverCount: 0,
                            whyItMatters: '',
                            reminderTime: null
                        }]
                    }]
                };
                setBoards([...boards, newBoard]);
                setActiveBoard(newBoard.id);
            };

            const updateBoard = (boardId, updates) => {
                setBoards(boards.map(b => b.id === boardId ? { ...b, ...updates } : b));
            };

            const deleteBoard = (boardId) => {
                if (boardId === BRAIN_DUMP_BOARD_ID || boardId === SOMEDAY_MAYBE_BOARD_ID) {
                    alert('System boards cannot be deleted');
                    return;
                }
                if (boards.filter(b => b.id !== BRAIN_DUMP_BOARD_ID && b.id !== SOMEDAY_MAYBE_BOARD_ID).length === 1) {
                    alert('You must have at least one board');
                    return;
                }
                setBoards(boards.filter(b => b.id !== boardId));
                if (activeBoard === boardId) {
                    setActiveBoard(boards.find(b => b.id !== boardId)?.id);
                }
            };

            const addGroup = (boardId) => {
                const newTaskId = generateId();
                const newGroup = {
                    id: generateId(),
                    name: 'New Group',
                    color: '#A8B5A0',
                    tasks: [{
                        id: newTaskId,
                        name: 'New Task',
                        status: 'new',
                        priority: 'medium',
                        assignee: '',
                        dueDate: '',
                        notes: '',
                        timeEstimate: '30min',
                        energyLevel: 'medium',
                        taskType: 'admin',
                        isFocusTask: false,
                        timeBlock: null,
                        contextNotes: '',
                        rolloverCount: 0,
                        whyItMatters: '',
                        reminderTime: null
                    }]
                };
                setBoards(boards.map(b => 
                    b.id === boardId ? { ...b, groups: [...b.groups, newGroup] } : b
                ));
            };

            const updateGroup = (boardId, groupId, updates) => {
                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.map(g => g.id === groupId ? { ...g, ...updates } : g)
                    } : b
                ));
            };

            const deleteGroup = (boardId, groupId) => {
                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.filter(g => g.id !== groupId)
                    } : b
                ));
            };

            const addTask = (boardId, groupId, taskData = {}) => {
                const newTask = {
                    id: generateId(),
                    name: taskData.name || 'New Task',
                    status: 'new',
                    priority: 'medium',
                    assignee: '',
                    dueDate: '',
                    notes: '',
                    timeEstimate: '30min',
                    energyLevel: 'medium',
                    taskType: 'admin',
                    isFocusTask: false,
                    timeBlock: null,
                    contextNotes: '',
                    rolloverCount: 0,
                    whyItMatters: '',
                    reminderTime: null,
                    ...taskData
                };
                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.map(g => 
                            g.id === groupId ? { ...g, tasks: [...g.tasks, newTask] } : g
                        )
                    } : b
                ));
            };

            const updateTask = (boardId, groupId, taskId, updates) => {
                if (updates.status === 'stuck') {
                    setContextTask({ boardId, groupId, taskId });
                    setShowContextModal(true);
                }

                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.map(g => 
                            g.id === groupId ? {
                                ...g,
                                tasks: g.tasks.map(t => t.id === taskId ? { ...t, ...updates } : t)
                            } : g
                        )
                    } : b
                ));

                if (updates.status || updates.notes || updates.contextNotes) {
                    trackRecentlyViewed(boardId, groupId, taskId);
                }
            };

            const deleteTask = (boardId, groupId, taskId) => {
                setBoards(boards.map(b => 
                    b.id === boardId ? {
                        ...b,
                        groups: b.groups.map(g => 
                            g.id === groupId ? {
                                ...g,
                                tasks: g.tasks.filter(t => t.id !== taskId)
                            } : g
                        )
                    } : b
                ));
                setRecentlyViewed(recentlyViewed.filter(rv => rv.taskId !== taskId));
            };

            const moveTask = (fromBoardId, fromGroupId, taskId, toBoardId, toGroupId) => {
                let taskToMove = null;
                boards.forEach(board => {
                    if (board.id === fromBoardId) {
                        board.groups.forEach(group => {
                            if (group.id === fromGroupId) {
                                taskToMove = group.tasks.find(t => t.id === taskId);
                            }
                        });
                    }
                });

                if (!taskToMove) return;

                setBoards(boards.map(board => {
                    if (board.id === fromBoardId) {
                        return {
                            ...board,
                            groups: board.groups.map(group => 
                                group.id === fromGroupId 
                                    ? { ...group, tasks: group.tasks.filter(t => t.id !== taskId) }
                                    : group
                            )
                        };
                    } else if (board.id === toBoardId) {
                        return {
                            ...board,
                            groups: board.groups.map(group => 
                                group.id === toGroupId 
                                    ? { ...group, tasks: [...group.tasks, taskToMove] }
                                    : group
                            )
                        };
                    }
                    return board;
                }));
            };

            const sendToSomedayMaybe = (fromBoardId, fromGroupId, taskId) => {
                const somedayBoard = boards.find(b => b.id === SOMEDAY_MAYBE_BOARD_ID);
                if (somedayBoard && somedayBoard.groups[0]) {
                    moveTask(fromBoardId, fromGroupId, taskId, somedayBoard.id, somedayBoard.groups[0].id);
                }
            };

            const rolloverTask = (boardId, groupId, taskId) => {
                const today = new Date().toISOString().split('T')[0];
                setBoards(boards.map(board => 
                    board.id === boardId ? {
                        ...board,
                        groups: board.groups.map(group => 
                            group.id === groupId ? {
                                ...group,
                                tasks: group.tasks.map(task => 
                                    task.id === taskId ? {
                                        ...task,
                                        dueDate: today,
                                        rolloverCount: (task.rolloverCount || 0) + 1,
                                        lastRolloverDate: today
                                    } : task
                                )
                            } : group
                        )
                    } : board
                ));
            };

            const rolloverAllOverdue = () => {
                const today = new Date().toISOString().split('T')[0];
                setBoards(boards.map(board => ({
                    ...board,
                    groups: board.groups.map(group => ({
                        ...group,
                        tasks: group.tasks.map(task => {
                            if (task.dueDate && isPastDate(task.dueDate) && task.status !== 'done') {
                                return {
                                    ...task,
                                    dueDate: today,
                                    rolloverCount: (task.rolloverCount || 0) + 1,
                                    lastRolloverDate: today
                                };
                            }
                            return task;
                        })
                    }))
                })));
            };

            const overdueTaskCount = useMemo(() => {
                let count = 0;
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            if (task.dueDate && isPastDate(task.dueDate) && task.status !== 'done') {
                                count++;
                            }
                        });
                    });
                });
                return count;
            }, [boards]);

            const addNotification = (notification) => {
                const newNotification = {
                    id: generateId(),
                    timestamp: Date.now(),
                    read: false,
                    ...notification
                };
                setNotifications(prev => [newNotification, ...prev].slice(0, 50));
                
                if (notificationsEnabled) {
                    showToast(notification);
                }
            };

            const showToast = (notification) => {
                const toastId = generateId();
                const toast = { id: toastId, ...notification };
                setToasts(prev => [...prev, toast]);
                
                setTimeout(() => {
                    setToasts(prev => prev.filter(t => t.id !== toastId));
                }, 5000);
            };

            const dismissToast = (toastId) => {
                setToasts(prev => prev.filter(t => t.id !== toastId));
            };

            const markNotificationRead = (notificationId) => {
                setNotifications(prev => 
                    prev.map(n => n.id === notificationId ? { ...n, read: true } : n)
                );
            };

            const markAllNotificationsRead = () => {
                setNotifications(prev => prev.map(n => ({ ...n, read: true })));
            };

            const clearAllNotifications = () => {
                setNotifications([]);
            };

            const unreadNotificationCount = useMemo(() => {
                return notifications.filter(n => !n.read).length;
            }, [notifications]);

            useEffect(() => {
                if (!notificationsEnabled) return;

                const checkReminders = () => {
                    const now = new Date();
                    const today = now.toISOString().split('T')[0];
                    const currentHour = now.getHours();

                    boards.forEach(board => {
                        if (board.id === 'brain-dump-board' || board.id === 'someday-maybe-board') return;

                        board.groups.forEach(group => {
                            group.tasks.forEach(task => {
                                if (task.status === 'done') return;

                                const daysUntil = getDaysUntil(task.dueDate);
                                
                                if (task.dueDate && !task.lastRemindedDate?.startsWith(today)) {
                                    let shouldRemind = false;
                                    let reminderType = '';
                                    let reminderMessage = '';

                                    if (daysUntil === 0 && currentHour >= 8 && currentHour <= 10) {
                                        shouldRemind = true;
                                        reminderType = 'due-today';
                                        reminderMessage = `"${task.name}" is due today!`;
                                    }
                                    else if (daysUntil === 1 && currentHour >= 14 && currentHour <= 16) {
                                        shouldRemind = true;
                                        reminderType = 'due-tomorrow';
                                        reminderMessage = `"${task.name}" is due tomorrow`;
                                    }
                                    else if (task.reminderTime) {
                                        const [reminderHour] = task.reminderTime.split(':').map(Number);
                                        if (daysUntil === 0 && currentHour === reminderHour) {
                                            shouldRemind = true;
                                            reminderType = 'custom-reminder';
                                            reminderMessage = `Reminder: "${task.name}"`;
                                        }
                                    }

                                    if (shouldRemind) {
                                        const existingToday = notifications.find(n => 
                                            n.taskId === task.id && 
                                            n.type === reminderType &&
                                            new Date(n.timestamp).toDateString() === now.toDateString()
                                        );

                                        if (!existingToday) {
                                            addNotification({
                                                type: reminderType,
                                                taskId: task.id,
                                                taskName: task.name,
                                                boardName: board.name,
                                                message: reminderMessage,
                                                whyItMatters: task.whyItMatters,
                                                icon: daysUntil === 0 ? 'fa-exclamation-circle' : 'fa-clock',
                                                color: daysUntil === 0 ? '#F8C56D' : '#a8c8d8'
                                            });
                                        }
                                    }
                                }
                            });
                        });
                    });
                };

                checkReminders();
                const interval = setInterval(checkReminders, 60000);
                return () => clearInterval(interval);
            }, [boards, notificationsEnabled]);

            const addTeamMember = (member) => {
                setTeam([...team, { ...member, id: generateId() }]);
            };

            const updateTeamMember = (memberId, updates) => {
                setTeam(team.map(m => m.id === memberId ? { ...m, ...updates } : m));
            };

            const deleteTeamMember = (memberId) => {
                setTeam(team.filter(m => m.id !== memberId));
            };

            const startPomodoro = (taskId) => {
                setActiveTaskId(taskId);
                setPomodoroActive(true);
                setIsBreak(false);
                setPomodoroTime(25 * 60);
                
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        const task = group.tasks.find(t => t.id === taskId);
                        if (task) {
                            updateTask(board.id, group.id, taskId, { status: 'working' });
                        }
                    });
                });
            };

            const stopPomodoro = () => {
                setPomodoroActive(false);
                setActiveTaskId(null);
            };

            const handleSignOut = async () => {
                try {
                    await auth.signOut();
                    setBoards(initialBoards);
                    setTeam(initialTeam);
                    setDataLoaded(false);
                } catch (error) {
                    console.error('Sign out error:', error);
                }
            };

            const handleBrainDump = () => {
                if (!brainDumpText.trim()) return;

                let brainDumpBoard = boards.find(b => b.id === 'brain-dump-board');
                
                if (brainDumpBoard) {
                    let targetGroup = brainDumpBoard.groups[0];
                    
                    if (targetGroup) {
                        addTask(brainDumpBoard.id, targetGroup.id, {
                            name: brainDumpText,
                            priority: 'medium',
                            status: 'new',
                            dueDate: new Date().toISOString().split('T')[0]
                        });
                    }
                    
                    setActiveBoard(brainDumpBoard.id);
                    setView('board');
                }

                setBrainDumpText('');
            };

            const trackRecentlyViewed = (boardId, groupId, taskId) => {
                const task = boards.find(b => b.id === boardId)
                    ?.groups.find(g => g.id === groupId)
                    ?.tasks.find(t => t.id === taskId);
                
                if (!task) return;

                const viewedItem = {
                    taskId,
                    boardId,
                    groupId,
                    taskName: task.name,
                    timestamp: Date.now()
                };

                setRecentlyViewed(prev => {
                    const filtered = prev.filter(item => item.taskId !== taskId);
                    return [viewedItem, ...filtered].slice(0, 5);
                });
            };

            if (authLoading) {
                return <LoadingScreen />;
            }

            // Check for demo mode in URL
            const isDemoMode = new URLSearchParams(window.location.search).get('demo') === 'true';
            
            if (!user && !isDemoMode) {
                return <LoginScreen />;
            }

            return (
                <div className={`flex h-screen overflow-hidden ${noJudgmentMode ? 'no-judgment-mode' : ''}`} style={{background: 'var(--cream)'}}>
                    <Sidebar 
                        boards={boards}
                        activeBoard={activeBoard}
                        setActiveBoard={setActiveBoard}
                        addBoard={addBoard}
                        view={view}
                        setView={setView}
                        sidebarOpen={sidebarOpen}
                        setSidebarOpen={setSidebarOpen}
                        pomodoroActive={pomodoroActive}
                        pomodoroTime={pomodoroTime}
                        isBreak={isBreak}
                        stopPomodoro={stopPomodoro}
                        recentlyViewed={recentlyViewed}
                        overdueTaskCount={overdueTaskCount}
                        rolloverAllOverdue={rolloverAllOverdue}
                        user={user}
                        onSignOut={handleSignOut}
                    />

                    <main className="flex-1 overflow-hidden flex flex-col">
                        {/* Brain Dump Bar */}
                        <div className="glass-effect border-b px-8 py-4" style={{borderColor: 'var(--linen)'}}>
                            <div className="flex items-center space-x-4">
                                <div className="flex items-center space-x-2" style={{color: 'var(--ripe-mango)'}}>
                                    <i className="fas fa-brain text-lg"></i>
                                    <span className="text-sm font-bold" style={{color: 'var(--charcoal)'}}>Brain Dump</span>
                                </div>
                                <input
                                    type="text"
                                    value={brainDumpText}
                                    onChange={(e) => setBrainDumpText(e.target.value)}
                                    onKeyDown={(e) => {
                                        if (e.key === 'Enter') handleBrainDump();
                                    }}
                                    placeholder="Quickly capture any thought, task, or idea... (Press Enter)"
                                    className="flex-1 px-5 py-3 border-2 rounded-2xl text-sm brain-dump-active"
                                    style={{borderColor: 'var(--ripe-mango)', background: 'white', color: 'var(--charcoal)'}}
                                />
                                <button
                                    onClick={handleBrainDump}
                                    disabled={!brainDumpText.trim()}
                                    className="px-5 py-3 rounded-2xl text-white font-semibold transition-all disabled:opacity-50"
                                    style={{background: 'var(--ripe-mango)', color: 'var(--soft-black)'}}
                                >
                                    <i className="fas fa-plus mr-2"></i>
                                    Capture
                                </button>

                                {/* Toggle Controls */}
                                <div className="flex items-center space-x-6 ml-4 pl-4" style={{borderLeft: '2px solid var(--linen)'}}>
                                    {/* Gentle Mode Toggle */}
                                    <div className="flex items-center space-x-3">
                                        <span className="text-sm font-semibold" style={{color: noJudgmentMode ? 'var(--mango-leaf)' : 'var(--warm-gray)'}}>
                                            <i className="fas fa-heart mr-1.5"></i>
                                            Gentle
                                        </span>
                                        <button
                                            onClick={() => setNoJudgmentMode(!noJudgmentMode)}
                                            className="toggle-track relative w-12 h-7 rounded-full transition-all"
                                            style={{background: noJudgmentMode ? 'var(--mango-leaf)' : 'var(--linen)'}}
                                            title={noJudgmentMode ? 'Gentle Mode On - No judgment here!' : 'Gentle Mode Off'}
                                        >
                                            <span 
                                                className="toggle-thumb absolute top-1 w-5 h-5 bg-white rounded-full shadow-soft"
                                                style={{left: noJudgmentMode ? '24px' : '4px'}}
                                            ></span>
                                        </button>
                                    </div>

                                    {/* Focus Mode Toggle */}
                                    <div className="flex items-center space-x-3">
                                        <span className="text-sm font-semibold" style={{color: focusMode ? 'var(--mango-leaf)' : 'var(--warm-gray)'}}>
                                            <i className={`fas fa-eye${focusMode ? '' : '-slash'} mr-1.5`}></i>
                                            Focus
                                        </span>
                                        <button
                                            onClick={() => setFocusMode(!focusMode)}
                                            className="toggle-track relative w-12 h-7 rounded-full transition-all"
                                            style={{background: focusMode ? 'var(--mango-leaf)' : 'var(--linen)'}}
                                            title={focusMode ? 'Focus Mode On' : 'Focus Mode Off'}
                                        >
                                            <span 
                                                className="toggle-thumb absolute top-1 w-5 h-5 bg-white rounded-full shadow-soft"
                                                style={{left: focusMode ? '24px' : '4px'}}
                                            ></span>
                                        </button>
                                    </div>
                                </div>

                                {/* Notification Bell */}
                                <div className="relative ml-4">
                                    <button
                                        onClick={() => setShowNotificationPanel(!showNotificationPanel)}
                                        className={`p-3 rounded-2xl transition-all ${showNotificationPanel ? '' : 'hover:bg-white hover:bg-opacity-50'} ${unreadNotificationCount > 0 ? 'bell-ringing' : ''}`}
                                        style={{background: showNotificationPanel ? 'var(--sage-light)' : 'transparent'}}
                                        title="Notifications"
                                    >
                                        <i className={`fas fa-bell text-lg`} style={{color: unreadNotificationCount > 0 ? 'var(--ripe-mango)' : 'var(--warm-gray)'}}></i>
                                        {unreadNotificationCount > 0 && (
                                            <span className="notification-badge absolute -top-1 -right-1 flex items-center justify-center rounded-full">
                                                {unreadNotificationCount > 9 ? '9+' : unreadNotificationCount}
                                            </span>
                                        )}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {view === 'board' && currentBoard && (
                            <BoardView 
                                board={currentBoard}
                                team={team}
                                updateBoard={updateBoard}
                                deleteBoard={deleteBoard}
                                addGroup={addGroup}
                                updateGroup={updateGroup}
                                deleteGroup={deleteGroup}
                                addTask={addTask}
                                updateTask={updateTask}
                                deleteTask={deleteTask}
                                moveTask={moveTask}
                                allBoards={boards}
                                focusMode={focusMode}
                                quickWinsOnly={quickWinsOnly}
                                setQuickWinsOnly={setQuickWinsOnly}
                                energyFilter={energyFilter}
                                setEnergyFilter={setEnergyFilter}
                                startPomodoro={startPomodoro}
                                activeTaskId={activeTaskId}
                                noJudgmentMode={noJudgmentMode}
                                sendToSomedayMaybe={sendToSomedayMaybe}
                                rolloverTask={rolloverTask}
                            />
                        )}
                        {view === 'timeblocking' && (
                            <TimeBlockingView 
                                boards={boards}
                                updateTask={updateTask}
                                startPomodoro={startPomodoro}
                                activeTaskId={activeTaskId}
                            />
                        )}
                        {view === 'timeline' && (
                            <TimelineView boards={boards} />
                        )}
                        {view === 'team' && (
                            <TeamView 
                                team={team}
                                addTeamMember={addTeamMember}
                                updateTeamMember={updateTeamMember}
                                deleteTeamMember={deleteTeamMember}
                            />
                        )}
                        {view === 'dashboard' && (
                            <DashboardView boards={boards} team={team} />
                        )}
                    </main>

                    {/* Notification Panel */}
                    <NotificationPanel
                        notifications={notifications}
                        showPanel={showNotificationPanel}
                        setShowPanel={setShowNotificationPanel}
                        markNotificationRead={markNotificationRead}
                        markAllNotificationsRead={markAllNotificationsRead}
                        clearAllNotifications={clearAllNotifications}
                        notificationsEnabled={notificationsEnabled}
                        setNotificationsEnabled={setNotificationsEnabled}
                    />

                    {/* Toast Container */}
                    <div className="fixed bottom-6 right-6 z-50 space-y-3">
                        {toasts.map(toast => (
                            <Toast key={toast.id} toast={toast} onDismiss={() => dismissToast(toast.id)} />
                        ))}
                    </div>
                </div>
            );
        }

        // Notification Panel Component
        function NotificationPanel({ notifications, showPanel, setShowPanel, markNotificationRead, markAllNotificationsRead, clearAllNotifications, notificationsEnabled, setNotificationsEnabled }) {
            if (!showPanel) return null;

            const formatTimeAgo = (timestamp) => {
                const seconds = Math.floor((Date.now() - timestamp) / 1000);
                if (seconds < 60) return 'Just now';
                const minutes = Math.floor(seconds / 60);
                if (minutes < 60) return `${minutes}m ago`;
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `${hours}h ago`;
                const days = Math.floor(hours / 24);
                return `${days}d ago`;
            };

            const getNotificationIcon = (notification) => {
                switch (notification.type) {
                    case 'due-today': return { icon: 'fa-exclamation-circle', color: 'var(--golden-flesh)' };
                    case 'due-tomorrow': return { icon: 'fa-clock', color: 'var(--sky)' };
                    case 'custom-reminder': return { icon: 'fa-bell', color: 'var(--ripe-mango)' };
                    case 'overdue': return { icon: 'fa-exclamation-triangle', color: 'var(--warm-red)' };
                    default: return { icon: 'fa-info-circle', color: 'var(--warm-gray)' };
                }
            };

            return (
                <div 
                    className="fixed inset-0 z-40"
                    onClick={() => setShowPanel(false)}
                >
                    <div 
                        className="notification-panel absolute right-6 top-24 w-96 max-h-[70vh] overflow-hidden"
                        onClick={(e) => e.stopPropagation()}
                    >
                        {/* Header */}
                        <div className="p-5 border-b flex items-center justify-between" style={{borderColor: 'var(--linen)', background: 'var(--cream-dark)'}}>
                            <h3 className="font-bold text-lg" style={{color: 'var(--charcoal)'}}>
                                <i className="fas fa-bell mr-2" style={{color: 'var(--ripe-mango)'}}></i>
                                Notifications
                            </h3>
                            <div className="flex items-center space-x-2">
                                <button
                                    onClick={() => setNotificationsEnabled(!notificationsEnabled)}
                                    className="p-2 rounded-xl transition-all"
                                    style={{color: notificationsEnabled ? 'var(--mango-leaf)' : 'var(--warm-gray)', background: notificationsEnabled ? 'var(--sage-light)' : 'transparent'}}
                                    title={notificationsEnabled ? 'Notifications on' : 'Notifications off'}
                                >
                                    <i className={`fas ${notificationsEnabled ? 'fa-volume-up' : 'fa-volume-mute'}`}></i>
                                </button>
                                <button
                                    onClick={() => setShowPanel(false)}
                                    className="p-2 rounded-xl transition-all hover:bg-white"
                                    style={{color: 'var(--warm-gray)'}}
                                >
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>
                        </div>

                        {/* Actions */}
                        {notifications.length > 0 && (
                            <div className="px-5 py-3 border-b flex items-center justify-between" style={{borderColor: 'var(--linen)'}}>
                                <button
                                    onClick={markAllNotificationsRead}
                                    className="text-sm font-semibold transition-all hover:opacity-70"
                                    style={{color: 'var(--mango-leaf)'}}
                                >
                                    Mark all as read
                                </button>
                                <button
                                    onClick={clearAllNotifications}
                                    className="text-sm font-semibold transition-all hover:opacity-70"
                                    style={{color: 'var(--warm-gray)'}}
                                >
                                    Clear all
                                </button>
                            </div>
                        )}

                        {/* Notification List */}
                        <div className="overflow-y-auto max-h-[50vh] scrollbar-thin">
                            {notifications.length === 0 ? (
                                <div className="p-10 text-center">
                                    <i className="fas fa-bell-slash text-5xl mb-4 opacity-20" style={{color: 'var(--warm-gray)'}}></i>
                                    <p className="font-semibold" style={{color: 'var(--warm-gray)'}}>No notifications yet</p>
                                    <p className="text-sm mt-2" style={{color: 'var(--warm-gray)', opacity: 0.7}}>
                                        You'll receive gentle reminders for upcoming tasks
                                    </p>
                                </div>
                            ) : (
                                notifications.map(notification => {
                                    const iconInfo = getNotificationIcon(notification);
                                    return (
                                        <div
                                            key={notification.id}
                                            className={`notification-item p-5 border-b cursor-pointer ${!notification.read ? 'unread' : ''}`}
                                            style={{borderColor: 'var(--linen)'}}
                                            onClick={() => markNotificationRead(notification.id)}
                                        >
                                            <div className="flex items-start space-x-4">
                                                <div 
                                                    className="w-11 h-11 rounded-2xl flex items-center justify-center flex-shrink-0"
                                                    style={{background: iconInfo.color}}
                                                >
                                                    <i className={`fas ${iconInfo.icon}`} style={{color: 'var(--soft-black)'}}></i>
                                                </div>
                                                <div className="flex-1 min-w-0">
                                                    <p className="font-semibold text-sm" style={{color: 'var(--charcoal)'}}>
                                                        {notification.message}
                                                    </p>
                                                    {notification.whyItMatters && (
                                                        <p className="text-sm mt-2 italic" style={{color: 'var(--ripe-mango)'}}>
                                                            <i className="fas fa-heart mr-1"></i>
                                                            {notification.whyItMatters}
                                                        </p>
                                                    )}
                                                    <div className="flex items-center space-x-2 mt-2">
                                                        <span className="text-xs font-medium" style={{color: 'var(--warm-gray)'}}>
                                                            {notification.boardName}
                                                        </span>
                                                        <span style={{color: 'var(--linen)'}}>â€¢</span>
                                                        <span className="text-xs" style={{color: 'var(--warm-gray)'}}>
                                                            {formatTimeAgo(notification.timestamp)}
                                                        </span>
                                                    </div>
                                                </div>
                                                {!notification.read && (
                                                    <div className="w-2.5 h-2.5 rounded-full flex-shrink-0 mt-2" style={{background: 'var(--ripe-mango)'}}></div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Toast Component
        function Toast({ toast, onDismiss }) {
            const getToastStyles = () => {
                switch (toast.type) {
                    case 'due-today':
                        return { bg: 'var(--golden-flesh)', icon: 'fa-exclamation-circle' };
                    case 'due-tomorrow':
                        return { bg: 'var(--sky)', icon: 'fa-clock' };
                    case 'custom-reminder':
                        return { bg: 'var(--ripe-mango)', icon: 'fa-bell' };
                    default:
                        return { bg: 'var(--linen)', icon: 'fa-info-circle' };
                }
            };

            const styles = getToastStyles();

            return (
                <div className="toast-enter rounded-2xl shadow-soft-lg p-5 max-w-sm" style={{background: styles.bg}}>
                    <div className="flex items-start space-x-4">
                        <div className="flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center" style={{background: 'rgba(255,255,255,0.5)'}}>
                            <i className={`fas ${styles.icon}`} style={{color: 'var(--soft-black)'}}></i>
                        </div>
                        <div className="flex-1 min-w-0">
                            <p className="font-bold text-sm" style={{color: 'var(--soft-black)'}}>{toast.message}</p>
                            {toast.whyItMatters && (
                                <p className="text-sm mt-1" style={{color: 'var(--charcoal)', opacity: 0.8}}>
                                    <i className="fas fa-heart mr-1"></i>
                                    {toast.whyItMatters}
                                </p>
                            )}
                        </div>
                        <button
                            onClick={onDismiss}
                            className="flex-shrink-0 opacity-60 hover:opacity-100 transition-opacity"
                            style={{color: 'var(--soft-black)'}}
                        >
                            <i className="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            );
        }

        // Pomodoro Timer Component
        function PomodoroTimer({ pomodoroActive, pomodoroTime, isBreak, stopPomodoro }) {
            const minutes = Math.floor(pomodoroTime / 60);
            const seconds = pomodoroTime % 60;
            const progress = isBreak 
                ? ((5 * 60 - pomodoroTime) / (5 * 60)) * 100
                : ((25 * 60 - pomodoroTime) / (25 * 60)) * 100;

            return (
                <div className={`p-5 border-t ${pomodoroActive ? 'timer-active' : ''}`} style={{borderColor: 'rgba(255,255,255,0.15)'}}>
                    <div className="text-center">
                        <div className="text-xs font-bold uppercase mb-3 tracking-wider" style={{color: 'rgba(255,255,255,0.7)'}}>
                            {isBreak ? 'â˜• Break Time' : 'ðŸ¥­ Focus Time'}
                        </div>
                        <div className="text-4xl font-bold text-white mb-4" style={{letterSpacing: '-0.02em'}}>
                            {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
                        </div>
                        <div className="w-full h-2.5 rounded-full mb-4" style={{background: 'rgba(255,255,255,0.2)'}}>
                            <div 
                                className="h-2.5 rounded-full transition-all"
                                style={{
                                    width: `${progress}%`,
                                    background: isBreak ? 'var(--sanctuary-sage)' : 'var(--ripe-mango)'
                                }}
                            ></div>
                        </div>
                        {pomodoroActive && (
                            <button
                                onClick={stopPomodoro}
                                className="text-xs font-semibold transition-all hover:opacity-100"
                                style={{color: 'rgba(255,255,255,0.7)'}}
                            >
                                <i className="fas fa-stop mr-1.5"></i>
                                Stop Timer
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        // Sidebar Component
        function Sidebar({ boards, activeBoard, setActiveBoard, addBoard, view, setView, sidebarOpen, setSidebarOpen, pomodoroActive, pomodoroTime, isBreak, stopPomodoro, recentlyViewed, overdueTaskCount, rolloverAllOverdue, user, onSignOut }) {
            if (!sidebarOpen) {
                return (
                    <div className="w-16 flex flex-col items-center py-5 sidebar-gentle" style={{borderRight: '1px solid rgba(255,255,255,0.1)'}}>
                        <button onClick={() => setSidebarOpen(true)} className="mb-4 text-xl hover:bg-white hover:bg-opacity-20 p-3 rounded-2xl text-white transition-all">
                            <i className="fas fa-bars"></i>
                        </button>
                    </div>
                );
            }

            return (
                <aside className="w-64 flex flex-col sidebar-gentle" style={{borderRight: '1px solid rgba(255,255,255,0.1)'}}>
                    <div className="p-5 border-b" style={{borderColor: 'rgba(255,255,255,0.1)'}}>
                        <div className="flex items-center justify-between mb-3">
                            <div className="flex items-center">
                                <MangoLogo size={28} className="mr-2" />
                                <div>
                                    <h1 className="text-lg font-bold text-white leading-tight">EveryMango</h1>
                                    <p className="tagline text-white">Ripen at your own pace</p>
                                </div>
                            </div>
                            <button onClick={() => setSidebarOpen(false)} className="hover:bg-white hover:bg-opacity-20 p-2.5 rounded-xl text-white transition-all">
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        {user && (
                            <div className="flex items-center justify-between pt-3" style={{borderTop: '1px solid rgba(255,255,255,0.1)'}}>
                                <div className="flex items-center space-x-2">
                                    {user.photoURL ? (
                                        <img src={user.photoURL} alt="" className="w-8 h-8 rounded-full" />
                                    ) : (
                                        <div className="w-8 h-8 rounded-full flex items-center justify-center" style={{background: 'rgba(255,255,255,0.2)'}}>
                                            <i className="fas fa-user text-white text-sm"></i>
                                        </div>
                                    )}
                                    <span className="text-sm text-white truncate max-w-[120px]" title={user.email}>
                                        {user.displayName || user.email?.split('@')[0]}
                                    </span>
                                </div>
                                <button
                                    onClick={onSignOut}
                                    className="text-xs px-3 py-1.5 rounded-xl transition-all hover:bg-white hover:bg-opacity-20"
                                    style={{color: 'rgba(255,255,255,0.8)'}}
                                    title="Sign out"
                                >
                                    <i className="fas fa-sign-out-alt"></i>
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Pomodoro Timer */}
                    {pomodoroActive && (
                        <PomodoroTimer 
                            pomodoroActive={pomodoroActive}
                            pomodoroTime={pomodoroTime}
                            isBreak={isBreak}
                            stopPomodoro={stopPomodoro}
                        />
                    )}

                    {/* Fresh Start Button */}
                    {overdueTaskCount > 0 && (
                        <div className="p-4 border-b" style={{borderColor: 'rgba(255,255,255,0.1)'}}>
                            <button
                                onClick={rolloverAllOverdue}
                                className="w-full px-4 py-3.5 rounded-2xl flex items-center justify-between font-semibold transition-all text-white"
                                style={{background: 'rgba(248, 197, 109, 0.25)'}}
                                title="Move all overdue tasks to today - a fresh start!"
                            >
                                <span className="flex items-center">
                                    <i className="fas fa-redo mr-3"></i>
                                    Fresh Start
                                </span>
                                <span className="text-xs font-bold px-2.5 py-1 rounded-xl" style={{background: 'var(--golden-flesh)', color: 'var(--soft-black)'}}>
                                    {overdueTaskCount}
                                </span>
                            </button>
                        </div>
                    )}

                    {/* Navigation */}
                    <nav className="p-4 space-y-2">
                        {[
                            { id: 'dashboard', icon: 'fa-chart-line', label: 'Dashboard' },
                            { id: 'board', icon: 'fa-columns', label: 'Boards' },
                            { id: 'timeblocking', icon: 'fa-clock', label: 'Time Blocking' },
                            { id: 'timeline', icon: 'fa-calendar-alt', label: 'Timeline' },
                            { id: 'team', icon: 'fa-users', label: 'Team' }
                        ].map(item => (
                            <button 
                                key={item.id}
                                onClick={() => setView(item.id)}
                                className={`w-full text-left px-4 py-3 rounded-2xl flex items-center font-semibold transition-all ${view === item.id ? 'text-white shadow-soft' : 'text-white text-opacity-80 hover:bg-white hover:bg-opacity-15'}`}
                                style={{background: view === item.id ? 'rgba(255,255,255,0.25)' : 'transparent'}}
                            >
                                <i className={`fas ${item.icon} mr-3 w-5`}></i>
                                {item.label}
                            </button>
                        ))}
                    </nav>

                    {/* Scrollable section */}
                    <div className="flex-1 overflow-y-auto scrollbar-sage p-4">
                        {/* Recently Viewed */}
                        {recentlyViewed && recentlyViewed.length > 0 && (
                            <div className="mb-4 pb-4" style={{borderBottom: '1px solid rgba(255,255,255,0.1)'}}>
                                <h2 className="text-xs font-bold uppercase tracking-wider mb-3 px-2" style={{color: 'rgba(255,255,255,0.6)'}}>
                                    <i className="fas fa-history mr-2"></i>
                                    Recently Viewed
                                </h2>
                                <div className="space-y-1">
                                    {recentlyViewed.map(item => (
                                        <div
                                            key={item.taskId}
                                            className="px-3 py-2.5 rounded-xl transition-all text-sm hover:bg-white hover:bg-opacity-10"
                                            style={{color: 'rgba(255,255,255,0.85)'}}
                                        >
                                            <div className="flex items-center space-x-2">
                                                <span className="w-2 h-2 rounded-full flex-shrink-0" style={{background: 'var(--golden-flesh)'}}></span>
                                                <span className="truncate font-medium">{item.taskName}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Pinned Boards */}
                        <div className="mb-4 pb-4" style={{borderBottom: '1px solid rgba(255,255,255,0.1)'}}>
                            <div className="flex items-center justify-between mb-3 px-2">
                                <h2 className="text-xs font-bold uppercase tracking-wider" style={{color: 'var(--golden-flesh)'}}>
                                    <i className="fas fa-thumbtack mr-2"></i>
                                    Pinned
                                </h2>
                            </div>
                            
                            {/* Brain Dump Board */}
                            {boards.filter(b => b.id === 'brain-dump-board').map(board => {
                                const taskCount = board.groups.reduce((sum, g) => sum + g.tasks.length, 0);
                                return (
                                    <button
                                        key={board.id}
                                        onClick={() => { setActiveBoard(board.id); setView('board'); }}
                                        className={`w-full text-left px-4 py-3 rounded-2xl flex items-center justify-between font-semibold transition-all mb-2 ${activeBoard === board.id && view === 'board' ? 'text-white' : 'text-white text-opacity-85 hover:bg-white hover:bg-opacity-15'}`}
                                        style={{background: activeBoard === board.id && view === 'board' ? 'rgba(244, 162, 89, 0.3)' : 'transparent'}}
                                    >
                                        <div className="flex items-center">
                                            <i className="fas fa-brain mr-3" style={{color: 'var(--ripe-mango)'}}></i>
                                            <span>{board.name}</span>
                                        </div>
                                        {taskCount > 0 && (
                                            <span className="text-xs font-bold px-2.5 py-1 rounded-xl" style={{background: 'var(--ripe-mango)', color: 'var(--soft-black)'}}>
                                                {taskCount}
                                            </span>
                                        )}
                                    </button>
                                );
                            })}
                            
                            {/* Someday/Maybe Board */}
                            {boards.filter(b => b.id === 'someday-maybe-board').map(board => {
                                const taskCount = board.groups.reduce((sum, g) => sum + g.tasks.length, 0);
                                return (
                                    <button
                                        key={board.id}
                                        onClick={() => { setActiveBoard(board.id); setView('board'); }}
                                        className={`w-full text-left px-4 py-3 rounded-2xl flex items-center justify-between font-semibold transition-all ${activeBoard === board.id && view === 'board' ? 'text-white' : 'text-white text-opacity-85 hover:bg-white hover:bg-opacity-15'}`}
                                        style={{background: activeBoard === board.id && view === 'board' ? 'rgba(168, 200, 216, 0.3)' : 'transparent'}}
                                    >
                                        <div className="flex items-center">
                                            <i className="fas fa-cloud mr-3" style={{color: 'var(--sky)'}}></i>
                                            <span>{board.name}</span>
                                        </div>
                                        {taskCount > 0 && (
                                            <span className="text-xs font-bold px-2.5 py-1 rounded-xl" style={{background: 'var(--sky)', color: 'var(--soft-black)'}}>
                                                {taskCount}
                                            </span>
                                        )}
                                    </button>
                                );
                            })}

                            {/* User Pinned Boards */}
                            {boards.filter(b => 
                                b.isPinned && 
                                b.id !== 'brain-dump-board' && 
                                b.id !== 'someday-maybe-board'
                            ).map(board => {
                                const taskCount = board.groups.reduce((sum, g) => sum + g.tasks.length, 0);
                                return (
                                    <button
                                        key={board.id}
                                        onClick={() => { setActiveBoard(board.id); setView('board'); }}
                                        className={`w-full text-left px-4 py-3 rounded-2xl flex items-center justify-between font-semibold transition-all mb-2 ${activeBoard === board.id && view === 'board' ? 'text-white' : 'text-white text-opacity-85 hover:bg-white hover:bg-opacity-15'}`}
                                        style={{background: activeBoard === board.id && view === 'board' ? 'rgba(255,255,255,0.2)' : 'transparent'}}
                                    >
                                        <div className="flex items-center">
                                            <span className="w-3 h-3 rounded-full mr-3" style={{backgroundColor: board.color}}></span>
                                            <span>{board.name}</span>
                                        </div>
                                        {taskCount > 0 && (
                                            <span className="text-xs font-bold px-2.5 py-1 rounded-xl" style={{background: board.color, color: 'var(--soft-black)'}}>
                                                {taskCount}
                                            </span>
                                        )}
                                    </button>
                                );
                            })}
                        </div>

                        {/* Other Boards */}
                        <div>
                            <div className="flex items-center justify-between mb-3 px-2">
                                <h2 className="text-xs font-bold uppercase tracking-wider" style={{color: 'rgba(255,255,255,0.6)'}}>Boards</h2>
                                <button 
                                    onClick={addBoard}
                                    className="hover:bg-white hover:bg-opacity-20 p-2 rounded-xl transition-all"
                                    style={{color: 'var(--sage-light)'}}
                                    title="Add board"
                                >
                                    <i className="fas fa-plus"></i>
                                </button>
                            </div>
                            <div className="space-y-1">
                                {boards.filter(b => 
                                    b.id !== 'brain-dump-board' && 
                                    b.id !== 'someday-maybe-board' &&
                                    !b.isPinned
                                ).map(board => (
                                    <button
                                        key={board.id}
                                        onClick={() => { setActiveBoard(board.id); setView('board'); }}
                                        className={`w-full text-left px-4 py-3 rounded-2xl flex items-center font-medium transition-all ${activeBoard === board.id && view === 'board' ? 'text-white' : 'text-white text-opacity-80 hover:bg-white hover:bg-opacity-10'}`}
                                        style={{background: activeBoard === board.id && view === 'board' ? 'rgba(255,255,255,0.15)' : 'transparent'}}
                                    >
                                        <span className="w-3 h-3 rounded-full mr-3 flex-shrink-0" style={{ backgroundColor: board.color }}></span>
                                        <span className="truncate">{board.name}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </aside>
            );
        }

        // Time Budget Component
        function TimeBudget({ boards }) {
            const todaysTasks = useMemo(() => {
                const tasks = [];
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            if (isToday(task.dueDate) && task.status !== 'done') {
                                tasks.push(task);
                            }
                        });
                    });
                });
                return tasks;
            }, [boards]);

            const totalMinutes = useMemo(() => {
                return todaysTasks.reduce((sum, task) => sum + getTimeInMinutes(task.timeEstimate), 0);
            }, [todaysTasks]);

            const availableHours = 8;
            const availableMinutes = availableHours * 60;
            const usagePercentage = Math.min((totalMinutes / availableMinutes) * 100, 100);
            const isOverbudget = totalMinutes > availableMinutes;

            return (
                <div className="card-gentle shadow-soft p-5">
                    <div className="flex items-center justify-between mb-4">
                        <h3 className="text-sm font-bold" style={{color: 'var(--charcoal)'}}>
                            <i className="fas fa-hourglass-half mr-2" style={{color: 'var(--mango-leaf)'}}></i>
                            Today's Time Budget
                        </h3>
                        <span className={`text-sm font-bold`} style={{color: isOverbudget ? 'var(--warm-red)' : 'var(--mango-leaf)'}}>
                            {Math.floor(totalMinutes / 60)}h {totalMinutes % 60}m / {availableHours}h
                        </span>
                    </div>
                    <div className="w-full h-3 rounded-full" style={{background: 'var(--linen)'}}>
                        <div 
                            className="h-3 rounded-full transition-all"
                            style={{
                                width: `${usagePercentage}%`,
                                background: isOverbudget 
                                    ? 'var(--warm-red)'
                                    : usagePercentage > 80
                                    ? 'var(--golden-flesh)'
                                    : 'var(--sanctuary-sage)'
                            }}
                        ></div>
                    </div>
                    {isOverbudget && (
                        <p className="text-xs mt-3 font-semibold" style={{color: 'var(--warm-red)'}}>
                            <i className="fas fa-info-circle mr-1"></i>
                            You're {Math.floor((totalMinutes - availableMinutes) / 60)}h {(totalMinutes - availableMinutes) % 60}m over budget - that's okay, mangoes take their time ðŸ¥­
                        </p>
                    )}
                </div>
            );
        }

        // Time Blocking View Component
        function TimeBlockingView({ boards, updateTask, startPomodoro, activeTaskId }) {
            const timeSlots = [
                '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', 
                '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', 
                '18:00', '19:00', '20:00', '21:00', '22:00'
            ];

            const todaysTasks = useMemo(() => {
                const tasks = [];
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            if (isToday(task.dueDate)) {
                                tasks.push({
                                    ...task,
                                    boardId: board.id,
                                    groupId: group.id
                                });
                            }
                        });
                    });
                });
                return tasks;
            }, [boards]);

            const unscheduledTasks = todaysTasks.filter(t => !t.timeBlock);
            const scheduledTasks = todaysTasks.filter(t => t.timeBlock);

            const handleDragStart = (e, task) => {
                e.dataTransfer.setData('task', JSON.stringify(task));
            };

            const handleDrop = (e, timeSlot) => {
                e.preventDefault();
                const task = JSON.parse(e.dataTransfer.getData('task'));
                updateTask(task.boardId, task.groupId, task.id, { timeBlock: timeSlot });
            };

            const handleDragOver = (e) => {
                e.preventDefault();
            };

            const removeFromSlot = (task) => {
                updateTask(task.boardId, task.groupId, task.id, { timeBlock: null });
            };

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-8 py-6" style={{borderColor: 'var(--linen)'}}>
                        <h2 className="text-3xl font-bold mb-2" style={{color: 'var(--charcoal)'}}>
                            Time Blocking - Today
                        </h2>
                        <p className="text-sm font-medium" style={{color: 'var(--warm-gray)'}}>
                            Drag tasks into time slots to plan your day - be gentle with yourself ðŸ¥­
                        </p>
                    </div>

                    <div className="flex-1 overflow-hidden flex">
                        {/* Unscheduled Tasks Panel */}
                        <div className="w-80 border-r p-6 overflow-y-auto scrollbar-thin" style={{borderColor: 'var(--linen)', background: 'var(--cream-dark)'}}>
                            <h3 className="text-lg font-bold mb-5" style={{color: 'var(--charcoal)'}}>
                                <i className="fas fa-inbox mr-2" style={{color: 'var(--mango-leaf)'}}></i>
                                Unscheduled ({unscheduledTasks.length})
                            </h3>
                            <div className="space-y-4">
                                {unscheduledTasks.map(task => (
                                    <div
                                        key={task.id}
                                        draggable
                                        onDragStart={(e) => handleDragStart(e, task)}
                                        className={`card-gentle shadow-soft p-5 draggable-task hover-lift type-${task.taskType}`}
                                    >
                                        <div className="flex items-start justify-between mb-3">
                                            <h4 className="font-bold text-sm flex-1" style={{color: 'var(--charcoal)'}}>
                                                {task.name}
                                            </h4>
                                            <span className="badge-soft text-xs ml-2" style={{background: 'var(--sky)', color: 'var(--soft-black)'}}>
                                                {task.timeEstimate}
                                            </span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <span className={`status-${task.status} badge-soft text-xs`}>
                                                {task.status}
                                            </span>
                                            <span className={`energy-${task.energyLevel} badge-soft text-xs`}>
                                                {task.energyLevel}
                                            </span>
                                        </div>
                                    </div>
                                ))}
                                {unscheduledTasks.length === 0 && (
                                    <div className="text-center py-10" style={{color: 'var(--warm-gray)'}}>
                                        <i className="fas fa-check-circle text-4xl mb-3 opacity-40"></i>
                                        <p className="text-sm font-medium">All tasks scheduled!</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Time Slots Grid */}
                        <div className="flex-1 overflow-y-auto p-8 scrollbar-thin">
                            <TimeBudget boards={boards} />
                            
                            <div className="mt-8 space-y-4">
                                {timeSlots.map(slot => {
                                    const tasksInSlot = scheduledTasks.filter(t => t.timeBlock === slot);
                                    
                                    return (
                                        <div key={slot}>
                                            <div className="flex items-center mb-2">
                                                <span className="text-sm font-bold w-20" style={{color: 'var(--warm-gray)'}}>
                                                    {slot}
                                                </span>
                                                <div 
                                                    className={`flex-1 time-slot p-5 ${tasksInSlot.length > 0 ? 'occupied' : ''}`}
                                                    onDrop={(e) => handleDrop(e, slot)}
                                                    onDragOver={handleDragOver}
                                                >
                                                    {tasksInSlot.length === 0 ? (
                                                        <div className="text-center text-sm font-medium" style={{color: 'var(--warm-gray)'}}>
                                                            Drop task here
                                                        </div>
                                                    ) : (
                                                        <div className="space-y-3">
                                                            {tasksInSlot.map(task => (
                                                                <div 
                                                                    key={task.id}
                                                                    className={`card-gentle shadow-soft p-4 type-${task.taskType}`}
                                                                >
                                                                    <div className="flex items-center justify-between">
                                                                        <div className="flex-1">
                                                                            <h4 className="font-bold text-sm mb-2" style={{color: 'var(--charcoal)'}}>
                                                                                {task.name}
                                                                            </h4>
                                                                            <div className="flex items-center space-x-2">
                                                                                <span className="badge-soft text-xs" style={{background: 'var(--sky)', color: 'var(--soft-black)'}}>
                                                                                    {task.timeEstimate}
                                                                                </span>
                                                                                <span className={`status-${task.status} badge-soft text-xs`}>
                                                                                    {task.status}
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div className="flex items-center space-x-2 ml-4">
                                                                            <button
                                                                                onClick={() => startPomodoro(task.id)}
                                                                                className={`p-2.5 rounded-xl transition-all ${
                                                                                    activeTaskId === task.id 
                                                                                        ? '' 
                                                                                        : 'hover:opacity-80'
                                                                                }`}
                                                                                style={{background: activeTaskId === task.id ? 'var(--warm-red)' : 'var(--mango-leaf)', color: 'white'}}
                                                                                title="Start Pomodoro"
                                                                            >
                                                                                <i className="fas fa-play"></i>
                                                                            </button>
                                                                            <button
                                                                                onClick={() => removeFromSlot(task)}
                                                                                className="p-2.5 rounded-xl transition-all"
                                                                                style={{background: 'var(--linen)', color: 'var(--warm-gray)'}}
                                                                                title="Remove from slot"
                                                                            >
                                                                                <i className="fas fa-times"></i>
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Board View Component
        function BoardView({ board, team, updateBoard, deleteBoard, addGroup, updateGroup, deleteGroup, addTask, updateTask, deleteTask, moveTask, allBoards, focusMode, quickWinsOnly, setQuickWinsOnly, energyFilter, setEnergyFilter, startPomodoro, activeTaskId, noJudgmentMode, sendToSomedayMaybe, rolloverTask }) {
            const [editingBoardName, setEditingBoardName] = useState(false);
            const [boardName, setBoardName] = useState(board.name);

            useEffect(() => {
                setBoardName(board.name);
                setEditingBoardName(false);
            }, [board.id]);

            const handleBoardNameSave = () => {
                updateBoard(board.id, { name: boardName });
                setEditingBoardName(false);
            };

            const boardStats = useMemo(() => {
                let total = 0;
                let completed = 0;
                let quickWins = 0;
                
                board.groups.forEach(group => {
                    group.tasks.forEach(task => {
                        total++;
                        if (task.status === 'done') completed++;
                        if (task.timeEstimate === '5min' || task.timeEstimate === '15min') quickWins++;
                    });
                });

                return { 
                    total, 
                    completed, 
                    quickWins,
                    percentage: total > 0 ? Math.round((completed / total) * 100) : 0 
                };
            }, [board]);

            const isSystemBoard = board.id === 'brain-dump-board' || board.id === 'someday-maybe-board';

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-8 py-6" style={{borderColor: 'var(--linen)'}}>
                        <div className="flex items-center justify-between mb-5">
                            <div className="flex items-center space-x-5">
                                {editingBoardName && !isSystemBoard ? (
                                    <input
                                        type="text"
                                        value={boardName}
                                        onChange={(e) => setBoardName(e.target.value)}
                                        onBlur={handleBoardNameSave}
                                        onKeyDown={(e) => e.key === 'Enter' && handleBoardNameSave()}
                                        className="text-3xl font-bold border-b-2 focus:outline-none bg-transparent"
                                        style={{borderColor: 'var(--mango-leaf)', color: 'var(--charcoal)'}}
                                        autoFocus
                                    />
                                ) : (
                                    <h2 
                                        className={`text-3xl font-bold transition-colors ${!isSystemBoard ? 'cursor-pointer hover:opacity-70' : ''}`}
                                        style={{color: 'var(--charcoal)'}}
                                        onClick={() => {
                                            if (!isSystemBoard) {
                                                setEditingBoardName(true);
                                            }
                                        }}
                                    >
                                        {board.name}
                                    </h2>
                                )}
                                
                                <div className="relative w-16 h-16">
                                    <svg className="transform -rotate-90" width="64" height="64">
                                        <circle cx="32" cy="32" r="28" stroke="var(--linen)" strokeWidth="6" fill="none" />
                                        <circle
                                            cx="32" cy="32" r="28"
                                            stroke="var(--sanctuary-sage)"
                                            strokeWidth="6"
                                            fill="none"
                                            strokeDasharray="175.84"
                                            strokeDashoffset={175.84 - (175.84 * boardStats.percentage / 100)}
                                            strokeLinecap="round"
                                            className="progress-ring"
                                        />
                                    </svg>
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <span className="text-sm font-bold" style={{color: 'var(--charcoal)'}}>{boardStats.percentage}%</span>
                                    </div>
                                </div>
                            </div>
                            <div className="flex items-center space-x-3">
                                <button 
                                    onClick={() => addGroup(board.id)}
                                    className="btn-primary px-5 py-3 text-white rounded-2xl hover-lift flex items-center font-semibold"
                                >
                                    <i className="fas fa-plus mr-2"></i>
                                    Add Group
                                </button>
                                {!isSystemBoard && (
                                    <>
                                        <button 
                                            onClick={() => updateBoard(board.id, { isPinned: !board.isPinned })}
                                            className="px-5 py-3 rounded-2xl hover-lift font-semibold flex items-center"
                                            style={{
                                                background: board.isPinned ? 'var(--golden-flesh)' : 'var(--linen)', 
                                                color: board.isPinned ? 'var(--soft-black)' : 'var(--charcoal)'
                                            }}
                                            title={board.isPinned ? 'Unpin board' : 'Pin board'}
                                        >
                                            <i className={`fas fa-thumbtack ${board.isPinned ? '' : 'opacity-50'}`}></i>
                                        </button>
                                        <button 
                                            onClick={() => {
                                                if (confirm('Delete this board?')) {
                                                    deleteBoard(board.id);
                                                }
                                            }}
                                            className="px-5 py-3 text-white rounded-2xl hover-lift font-semibold"
                                            style={{background: 'var(--warm-red)'}}
                                        >
                                            <i className="fas fa-trash"></i>
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>

                        <div className="flex items-center space-x-4">
                            <button
                                onClick={() => setQuickWinsOnly(!quickWinsOnly)}
                                className="px-5 py-2.5 rounded-2xl font-semibold flex items-center transition-all"
                                style={{
                                    background: quickWinsOnly ? 'var(--sunny-yellow)' : 'white',
                                    color: 'var(--soft-black)',
                                    border: quickWinsOnly ? 'none' : '2px solid var(--linen)'
                                }}
                            >
                                <i className="fas fa-bolt mr-2"></i>
                                Quick Wins ({boardStats.quickWins})
                            </button>

                            <select
                                value={energyFilter || ''}
                                onChange={(e) => setEnergyFilter(e.target.value || null)}
                                className="px-5 py-2.5 border-2 rounded-2xl font-semibold"
                                style={{borderColor: 'var(--linen)', color: 'var(--charcoal)', background: 'white'}}
                            >
                                <option value="">All Energy Levels</option>
                                <option value="low">Low Energy</option>
                                <option value="medium">Medium Energy</option>
                                <option value="high">High Energy</option>
                            </select>

                            {(quickWinsOnly || energyFilter) && (
                                <button
                                    onClick={() => {
                                        setQuickWinsOnly(false);
                                        setEnergyFilter(null);
                                    }}
                                    className="px-4 py-2.5 rounded-2xl font-semibold transition-all"
                                    style={{color: 'var(--warm-gray)'}}
                                >
                                    <i className="fas fa-times mr-2"></i>
                                    Clear
                                </button>
                            )}

                            <div className="flex-1"></div>

                            <TimeBudget boards={[board]} />
                        </div>
                    </div>

                    <div className="flex-1 overflow-auto p-8 scrollbar-thin">
                        <div className="space-y-6">
                            {board.groups.map(group => (
                                <GroupComponent
                                    key={group.id}
                                    group={group}
                                    boardId={board.id}
                                    team={team}
                                    updateGroup={updateGroup}
                                    deleteGroup={deleteGroup}
                                    addTask={addTask}
                                    updateTask={updateTask}
                                    deleteTask={deleteTask}
                                    moveTask={moveTask}
                                    allBoards={allBoards}
                                    focusMode={focusMode}
                                    quickWinsOnly={quickWinsOnly}
                                    energyFilter={energyFilter}
                                    startPomodoro={startPomodoro}
                                    activeTaskId={activeTaskId}
                                    noJudgmentMode={noJudgmentMode}
                                    sendToSomedayMaybe={sendToSomedayMaybe}
                                    rolloverTask={rolloverTask}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Group Component
        function GroupComponent({ group, boardId, team, updateGroup, deleteGroup, addTask, updateTask, deleteTask, moveTask, allBoards, focusMode, quickWinsOnly, energyFilter, startPomodoro, activeTaskId, noJudgmentMode, sendToSomedayMaybe, rolloverTask }) {
            const [editingName, setEditingName] = useState(false);
            const [groupName, setGroupName] = useState(group.name);
            const [collapsed, setCollapsed] = useState(false);

            const handleNameSave = () => {
                updateGroup(boardId, group.id, { name: groupName });
                setEditingName(false);
            };

            const filteredTasks = useMemo(() => {
                let tasks = [...group.tasks];

                if (focusMode) {
                    tasks = tasks.filter(t => t.isFocusTask);
                }

                if (quickWinsOnly) {
                    tasks = tasks.filter(t => t.timeEstimate === '5min' || t.timeEstimate === '15min');
                }

                if (energyFilter) {
                    tasks = tasks.filter(t => t.energyLevel === energyFilter);
                }

                return tasks;
            }, [group.tasks, focusMode, quickWinsOnly, energyFilter]);

            const groupStats = useMemo(() => {
                const total = filteredTasks.length;
                const completed = filteredTasks.filter(t => t.status === 'done').length;
                return { total, completed, percentage: total > 0 ? Math.round((completed / total) * 100) : 0 };
            }, [filteredTasks]);

            return (
                <div className="card-gentle shadow-soft-lg overflow-hidden hover-lift">
                    <div className="px-6 py-5 flex items-center justify-between" style={{ 
                        borderLeft: `5px solid ${group.color}`,
                        background: 'linear-gradient(90deg, var(--cream-dark) 0%, transparent 100%)'
                    }}>
                        <div className="flex items-center space-x-4">
                            <button onClick={() => setCollapsed(!collapsed)} className="p-2 rounded-xl transition-all" style={{color: 'var(--warm-gray)'}}>
                                <i className={`fas fa-chevron-${collapsed ? 'right' : 'down'}`}></i>
                            </button>
                            {editingName ? (
                                <input
                                    type="text"
                                    value={groupName}
                                    onChange={(e) => setGroupName(e.target.value)}
                                    onBlur={handleNameSave}
                                    onKeyDown={(e) => e.key === 'Enter' && handleNameSave()}
                                    className="font-bold text-lg border-b-2 focus:outline-none bg-transparent"
                                    style={{borderColor: 'var(--mango-leaf)', color: 'var(--charcoal)'}}
                                    autoFocus
                                />
                            ) : (
                                <h3 
                                    className="font-bold text-lg cursor-pointer hover:opacity-70 transition-all"
                                    onClick={() => setEditingName(true)}
                                    style={{color: 'var(--charcoal)'}}
                                >
                                    {group.name}
                                </h3>
                            )}
                            <span className="text-sm font-bold px-3 py-1 rounded-xl" style={{background: 'var(--linen)', color: 'var(--warm-gray)'}}>
                                {filteredTasks.length}
                            </span>

                            <div className="w-24 h-2 rounded-full" style={{background: 'var(--linen)'}}>
                                <div 
                                    className="h-2 rounded-full"
                                    style={{width: `${groupStats.percentage}%`, background: 'var(--sanctuary-sage)'}}
                                ></div>
                            </div>
                            <span className="text-xs font-bold" style={{color: 'var(--warm-gray)'}}>
                                {groupStats.percentage}%
                            </span>
                        </div>
                        <div className="flex items-center space-x-2">
                            <button 
                                onClick={() => addTask(boardId, group.id)}
                                className="p-2.5 rounded-xl transition-all"
                                style={{color: 'var(--mango-leaf)', background: 'transparent'}}
                            >
                                <i className="fas fa-plus"></i>
                            </button>
                            <button 
                                onClick={() => {
                                    if (confirm('Delete this group?')) {
                                        deleteGroup(boardId, group.id);
                                    }
                                }}
                                className="p-2.5 rounded-xl transition-all"
                                style={{color: 'var(--warm-red)', background: 'transparent'}}
                            >
                                <i className="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    {!collapsed && (
                        <div>
                            {/* Column Headers */}
                            {filteredTasks.length > 0 && (
                                <div className="px-6 py-4 border-b" style={{borderColor: 'var(--linen)', background: 'var(--cream-dark)'}}>
                                    <div className="grid grid-cols-12 gap-2 items-center">
                                        <div className="col-span-3 text-xs font-bold uppercase tracking-wider" style={{color: 'var(--warm-gray)'}}>
                                            Task Name
                                        </div>
                                        <div className="col-span-1 text-xs font-bold uppercase tracking-wider text-center" style={{color: 'var(--warm-gray)'}}>
                                            Status
                                        </div>
                                        <div className="col-span-2 text-xs font-bold uppercase tracking-wider text-center" style={{color: 'var(--warm-gray)'}}>
                                            Assignee
                                        </div>
                                        <div className="col-span-1 text-xs font-bold uppercase tracking-wider text-center" style={{color: 'var(--warm-gray)'}}>
                                            Time
                                        </div>
                                        <div className="col-span-1 text-xs font-bold uppercase tracking-wider text-center" style={{color: 'var(--warm-gray)'}}>
                                            Energy
                                        </div>
                                        <div className="col-span-1 text-xs font-bold uppercase tracking-wider text-center" style={{color: 'var(--warm-gray)'}}>
                                            Type
                                        </div>
                                        <div className="col-span-1 text-xs font-bold uppercase tracking-wider text-center" style={{color: 'var(--warm-gray)'}}>
                                            Priority
                                        </div>
                                        <div className="col-span-2 text-xs font-bold uppercase tracking-wider text-center" style={{color: 'var(--warm-gray)'}}>
                                            Actions
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* Tasks */}
                            <div className="divide-y" style={{borderColor: 'var(--linen)'}}>
                            {filteredTasks.length === 0 ? (
                                <div className="p-14 text-center" style={{color: 'var(--warm-gray)'}}>
                                    <i className="fas fa-inbox text-5xl mb-4 opacity-30"></i>
                                    <p className="font-semibold">No tasks match the current filters</p>
                                    <p className="text-sm mt-2">Try adjusting your filters or add new tasks</p>
                                </div>
                            ) : (
                                filteredTasks.map(task => (
                                    <TaskRow
                                        key={task.id}
                                        task={task}
                                        boardId={boardId}
                                        groupId={group.id}
                                        team={team}
                                        updateTask={updateTask}
                                        deleteTask={deleteTask}
                                        moveTask={moveTask}
                                        allBoards={allBoards}
                                        focusMode={focusMode}
                                        startPomodoro={startPomodoro}
                                        activeTaskId={activeTaskId}
                                        noJudgmentMode={noJudgmentMode}
                                        sendToSomedayMaybe={sendToSomedayMaybe}
                                        rolloverTask={rolloverTask}
                                    />
                                ))
                            )}
                        </div>
                        </div>
                    )}
                </div>
            );
        }

        // TaskRow Component
        function TaskRow({ task, boardId, groupId, team, updateTask, deleteTask, moveTask, allBoards, focusMode, startPomodoro, activeTaskId, noJudgmentMode, sendToSomedayMaybe, rolloverTask }) {
            const [editingName, setEditingName] = useState(false);
            const [taskName, setTaskName] = useState(task.name);
            const [showNotes, setShowNotes] = useState(false);
            const [showMoveMenu, setShowMoveMenu] = useState(false);
            const [showWhyMatters, setShowWhyMatters] = useState(false);
            const [showReminderPicker, setShowReminderPicker] = useState(false);

            const handleNameSave = () => {
                updateTask(boardId, groupId, task.id, { name: taskName });
                setEditingName(false);
            };

            const reminderTimeOptions = [
                { value: '08:00', label: '8 AM' },
                { value: '09:00', label: '9 AM' },
                { value: '10:00', label: '10 AM' },
                { value: '12:00', label: '12 PM' },
                { value: '14:00', label: '2 PM' },
                { value: '16:00', label: '4 PM' },
                { value: '18:00', label: '6 PM' },
                { value: '20:00', label: '8 PM' }
            ];

            const statusOptions = [
                { value: 'new', label: 'New', class: 'status-new' },
                { value: 'working', label: 'Working', class: 'status-working' },
                { value: 'stuck', label: 'Stuck', class: 'status-stuck' },
                { value: 'done', label: 'Done', class: 'status-done' }
            ];

            const priorityOptions = [
                { value: 'low', label: 'Low', class: 'priority-low' },
                { value: 'medium', label: 'Med', class: 'priority-medium' },
                { value: 'high', label: 'High', class: 'priority-high' },
                { value: 'critical', label: 'Crit', class: 'priority-critical' }
            ];

            const timeEstimateOptions = [
                { value: '5min', label: '5m' },
                { value: '15min', label: '15m' },
                { value: '30min', label: '30m' },
                { value: '1hr', label: '1h' },
                { value: '2hr', label: '2h+' }
            ];

            const energyLevelOptions = [
                { value: 'low', label: 'Low', class: 'energy-low' },
                { value: 'medium', label: 'Med', class: 'energy-medium' },
                { value: 'high', label: 'High', class: 'energy-high' }
            ];

            const taskTypeOptions = [
                { value: 'creative', label: 'Creative', color: 'var(--type-creative)' },
                { value: 'admin', label: 'Admin', color: 'var(--type-admin)' },
                { value: 'meeting', label: 'Meeting', color: 'var(--type-meeting)' },
                { value: 'deep-work', label: 'Deep', color: 'var(--type-deep-work)' },
                { value: 'communication', label: 'Comm', color: 'var(--type-communication)' },
                { value: 'learning', label: 'Learn', color: 'var(--type-learning)' }
            ];

            const currentStatus = statusOptions.find(s => s.value === task.status);
            const currentPriority = priorityOptions.find(p => p.value === task.priority);
            const currentTimeEstimate = timeEstimateOptions.find(t => t.value === task.timeEstimate);
            const currentEnergyLevel = energyLevelOptions.find(e => e.value === task.energyLevel);
            const currentTaskType = taskTypeOptions.find(t => t.value === task.taskType);
            const daysUntil = getDaysUntil(task.dueDate);
            const isQuickWin = task.timeEstimate === '5min' || task.timeEstimate === '15min';

            return (
                <div className={`p-6 type-${task.taskType} ${focusMode && task.isFocusTask ? 'focus-mode-active' : ''} ${task.status === 'done' ? 'celebrate' : ''}`} style={{background: 'white', borderColor: 'var(--linen)'}}>
                    <div className="grid grid-cols-12 gap-2 items-center">
                        {/* Task Name Column */}
                        <div className="col-span-3 flex items-center space-x-3">
                            <button
                                onClick={() => updateTask(boardId, groupId, task.id, { isFocusTask: !task.isFocusTask })}
                                className={`text-lg transition-all ${task.isFocusTask ? '' : 'opacity-40 hover:opacity-70'}`}
                                style={{color: task.isFocusTask ? 'var(--ripe-mango)' : 'var(--warm-gray)'}}
                            >
                                <i className={`fas fa-star`}></i>
                            </button>
                            {editingName ? (
                                <input
                                    type="text"
                                    value={taskName}
                                    onChange={(e) => setTaskName(e.target.value)}
                                    onBlur={handleNameSave}
                                    onKeyDown={(e) => e.key === 'Enter' && handleNameSave()}
                                    className="w-full border-b-2 focus:outline-none bg-transparent font-semibold"
                                    style={{borderColor: 'var(--mango-leaf)', color: 'var(--charcoal)'}}
                                    autoFocus
                                />
                            ) : (
                                <div className="flex-1">
                                    <div 
                                        className={`cursor-pointer hover:opacity-70 font-semibold ${task.status === 'done' ? 'line-through opacity-50' : ''}`}
                                        style={{color: 'var(--charcoal)'}}
                                        onClick={() => setEditingName(true)}
                                    >
                                        {task.name}
                                    </div>
                                    <div className="flex flex-wrap items-center gap-2 mt-2">
                                        {isQuickWin && (
                                            <span className="quick-win-badge inline-flex items-center text-xs font-bold px-2.5 py-1 rounded-xl">
                                                <i className="fas fa-bolt mr-1"></i>
                                                Quick!
                                            </span>
                                        )}
                                        {task.whyItMatters && (
                                            <span 
                                                className="inline-flex items-center text-xs font-semibold px-2.5 py-1 rounded-xl cursor-pointer transition-all"
                                                style={{background: 'rgba(244, 162, 89, 0.3)', color: 'var(--charcoal)'}}
                                                onClick={(e) => { e.stopPropagation(); setShowWhyMatters(!showWhyMatters); }}
                                                title={task.whyItMatters}
                                            >
                                                <i className="fas fa-heart mr-1"></i>
                                                Motivated
                                            </span>
                                        )}
                                        {task.reminderTime && (
                                            <span 
                                                className="inline-flex items-center text-xs font-semibold px-2.5 py-1 rounded-xl"
                                                style={{background: 'rgba(107, 142, 107, 0.2)', color: 'var(--charcoal)'}}
                                                title={`Reminder at ${reminderTimeOptions.find(o => o.value === task.reminderTime)?.label}`}
                                            >
                                                <i className="fas fa-bell mr-1"></i>
                                                {reminderTimeOptions.find(o => o.value === task.reminderTime)?.label}
                                            </span>
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Status Column - Compact */}
                        <div className="col-span-1">
                            <select
                                value={task.status}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { status: e.target.value })}
                                className={`w-full px-2 py-2 rounded-lg text-sm font-bold ${currentStatus.class} border-none`}
                            >
                                {statusOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Assignee Column */}
                        <div className="col-span-2">
                            <select
                                value={task.assignee}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { assignee: e.target.value })}
                                className="w-full px-2 py-2 border-2 rounded-lg text-sm font-medium"
                                style={{borderColor: 'var(--linen)', color: 'var(--charcoal)', background: 'white'}}
                            >
                                <option value="">Unassigned</option>
                                {team.map(member => (
                                    <option key={member.id} value={member.name}>
                                        {member.avatar} {member.name}
                                    </option>
                                ))}
                            </select>
                        </div>

                        {/* Time Column - Compact */}
                        <div className="col-span-1">
                            <select
                                value={task.timeEstimate}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { timeEstimate: e.target.value })}
                                className="w-full px-2 py-2 rounded-lg text-sm font-bold border-none"
                                style={{backgroundColor: 'var(--sky)', color: 'var(--soft-black)'}}
                            >
                                {timeEstimateOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Energy Column - Compact */}
                        <div className="col-span-1">
                            <select
                                value={task.energyLevel}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { energyLevel: e.target.value })}
                                className={`w-full px-2 py-2 rounded-lg text-sm font-bold ${currentEnergyLevel.class} border-none`}
                            >
                                {energyLevelOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Type Column */}
                        <div className="col-span-1">
                            <select
                                value={task.taskType}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { taskType: e.target.value })}
                                className="w-full px-2 py-2 rounded-lg text-sm font-bold border-none"
                                style={{backgroundColor: currentTaskType.color, color: 'var(--soft-black)'}}
                            >
                                {taskTypeOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Priority Column - Compact */}
                        <div className="col-span-1">
                            <select
                                value={task.priority}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { priority: e.target.value })}
                                className={`w-full px-2 py-2 rounded-lg text-sm font-bold ${currentPriority.class} border-none`}
                            >
                                {priorityOptions.map(opt => (
                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Actions Column */}
                        <div className="col-span-2 flex items-center justify-end space-x-1">
                            <button
                                onClick={() => startPomodoro(task.id)}
                                className="p-2 rounded-lg transition-all"
                                style={{background: activeTaskId === task.id ? 'var(--warm-red)' : 'var(--mango-leaf)', color: 'white'}}
                                title="Start Pomodoro"
                            >
                                <i className="fas fa-play text-xs"></i>
                            </button>
                            <button
                                onClick={() => setShowNotes(!showNotes)}
                                className="p-2 rounded-lg transition-all"
                                style={{background: task.notes ? 'var(--sky)' : 'var(--linen)', color: task.notes ? 'var(--soft-black)' : 'var(--warm-gray)'}}
                                title="Notes"
                            >
                                <i className="fas fa-sticky-note text-xs"></i>
                            </button>
                            
                            <button
                                onClick={() => setShowWhyMatters(!showWhyMatters)}
                                className="p-2 rounded-lg transition-all"
                                style={{background: task.whyItMatters ? 'var(--ripe-mango)' : 'var(--linen)', color: task.whyItMatters ? 'var(--soft-black)' : 'var(--warm-gray)'}}
                                title="Why does this matter?"
                            >
                                <i className="fas fa-heart text-xs"></i>
                            </button>

                            <button
                                onClick={() => setShowReminderPicker(!showReminderPicker)}
                                className="p-2 rounded-lg transition-all"
                                style={{background: task.reminderTime ? 'var(--sanctuary-sage)' : 'var(--linen)', color: task.reminderTime ? 'var(--soft-black)' : 'var(--warm-gray)'}}
                                title="Set reminder"
                            >
                                <i className="fas fa-bell text-xs"></i>
                            </button>
                            
                            <div className="relative">
                                <button
                                    onClick={() => setShowMoveMenu(!showMoveMenu)}
                                    className="p-2 rounded-lg transition-all"
                                    style={{background: 'var(--linen)', color: 'var(--ripe-mango)'}}
                                    title="Move to another board"
                                >
                                    <i className="fas fa-share text-xs"></i>
                                </button>
                                
                                {showMoveMenu && (
                                    <div 
                                        className="absolute right-0 top-full mt-2 w-64 bg-white rounded-2xl shadow-soft-lg border-2 z-50 max-h-80 overflow-y-auto"
                                        style={{borderColor: 'var(--linen)'}}
                                    >
                                        <div className="p-3 border-b" style={{borderColor: 'var(--linen)'}}>
                                            <p className="text-xs font-bold uppercase tracking-wider" style={{color: 'var(--warm-gray)'}}>Move to Board</p>
                                            </div>
                                        {allBoards && allBoards.filter(b => b.id !== boardId).map(targetBoard => (
                                            <div key={targetBoard.id} className="border-b last:border-b-0" style={{borderColor: 'var(--linen)'}}>
                                                <div className="px-4 py-2 flex items-center space-x-2" style={{background: 'var(--cream-dark)'}}>
                                                    <span className="w-2.5 h-2.5 rounded-full" style={{backgroundColor: targetBoard.color}}></span>
                                                    <span className="text-xs font-bold" style={{color: 'var(--charcoal)'}}>{targetBoard.name}</span>
                                                </div>
                                                {targetBoard.groups.map(targetGroup => (
                                                    <button
                                                        key={targetGroup.id}
                                                        onClick={() => {
                                                            moveTask(boardId, groupId, task.id, targetBoard.id, targetGroup.id);
                                                            setShowMoveMenu(false);
                                                        }}
                                                        className="w-full text-left px-5 py-3 text-sm font-medium transition-all flex items-center space-x-2 hover:bg-opacity-50"
                                                        style={{color: 'var(--charcoal)'}}
                                                    >
                                                        <i className="fas fa-folder text-xs" style={{color: 'var(--warm-gray)'}}></i>
                                                        <span>{targetGroup.name}</span>
                                                    </button>
                                                ))}
                                            </div>
                                        ))}
                                        {allBoards && allBoards.filter(b => b.id !== boardId).length === 0 && (
                                            <div className="p-4 text-sm text-center" style={{color: 'var(--warm-gray)'}}>
                                                No other boards available
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                            
                            <button
                                onClick={() => {
                                    if (confirm('Delete this task?')) {
                                        deleteTask(boardId, groupId, task.id);
                                    }
                                }}
                                className="p-2 rounded-lg transition-all"
                                style={{background: 'var(--linen)', color: 'var(--warm-red)'}}
                            >
                                <i className="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>

                    {/* Due Date Row */}
                    <div className="mt-4 flex items-center space-x-4 flex-wrap gap-3">
                        <input
                            type="date"
                            value={task.dueDate}
                            onChange={(e) => updateTask(boardId, groupId, task.id, { dueDate: e.target.value })}
                            className={`px-4 py-2.5 border-2 rounded-xl text-sm font-medium`}
                            style={{
                                borderColor: daysUntil !== null && daysUntil < 0 
                                    ? (noJudgmentMode ? 'var(--golden-flesh)' : 'var(--warm-red)')
                                    : daysUntil !== null && daysUntil <= 3 
                                    ? 'var(--golden-flesh)' 
                                    : 'var(--linen)',
                                color: 'var(--charcoal)',
                                background: 'white'
                            }}
                        />
                        {daysUntil !== null && (
                            <div className="text-sm font-semibold" style={{
                                color: daysUntil < 0 
                                    ? (noJudgmentMode ? 'var(--golden-flesh)' : 'var(--warm-red)')
                                    : daysUntil <= 3 
                                    ? 'var(--golden-flesh)' 
                                    : 'var(--warm-gray)'
                            }}>
                                {daysUntil < 0 
                                    ? (noJudgmentMode ? `${Math.abs(daysUntil)}d ago - no judgment! ðŸ¥­` : `${Math.abs(daysUntil)}d overdue`)
                                    : daysUntil === 0 
                                    ? 'Due today' 
                                    : `${daysUntil}d left`}
                            </div>
                        )}
                        
                        {task.rolloverCount > 0 && (
                            <span 
                                className="rolled-over-badge text-xs font-bold px-3 py-1 rounded-xl flex items-center"
                                title={`Rolled over ${task.rolloverCount} time${task.rolloverCount > 1 ? 's' : ''} - that's okay, mangoes ripen at their own pace!`}
                            >
                                <i className="fas fa-redo mr-1.5 text-xs"></i>
                                {task.rolloverCount}
                            </span>
                        )}
                        
                        {daysUntil !== null && daysUntil < 0 && task.status !== 'done' && (
                            <div className="flex items-center space-x-2">
                                <button
                                    onClick={() => rolloverTask(boardId, groupId, task.id)}
                                    className="text-xs font-semibold px-3 py-1.5 rounded-xl transition-all flex items-center"
                                    style={{background: 'var(--golden-flesh)', color: 'var(--soft-black)'}}
                                    title="Move to today - fresh start!"
                                >
                                    <i className="fas fa-arrow-right mr-1.5"></i>
                                    Today
                                </button>
                                <button
                                    onClick={() => sendToSomedayMaybe(boardId, groupId, task.id)}
                                    className="text-xs font-semibold px-3 py-1.5 rounded-xl transition-all flex items-center"
                                    style={{background: 'var(--sky)', color: 'var(--soft-black)'}}
                                    title="Send to Someday/Maybe - no pressure!"
                                >
                                    <i className="fas fa-cloud mr-1.5"></i>
                                    Someday
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Notes Section */}
                    {showNotes && (
                        <div className="mt-5 pt-5" style={{borderTop: '2px solid var(--linen)'}}>
                            <textarea
                                value={task.notes}
                                onChange={(e) => updateTask(boardId, groupId, task.id, { notes: e.target.value })}
                                placeholder="Add notes... jot down anything that helps! ðŸ¥­"
                                className="w-full px-5 py-4 border-2 rounded-2xl text-sm"
                                style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                rows="3"
                            />
                        </div>
                    )}

                    {/* Why It Matters Section */}
                    {showWhyMatters && (
                        <div className="mt-5 pt-5" style={{borderTop: '2px solid var(--linen)'}}>
                            <div className="why-matters-field p-5">
                                <div className="flex items-center space-x-3 mb-4">
                                    <span className="why-matters-badge text-xs font-bold px-3 py-1.5 rounded-xl">
                                        <i className="fas fa-heart mr-1.5"></i>
                                        Why This Matters
                                    </span>
                                    <span className="text-xs font-medium" style={{color: 'var(--warm-gray)'}}>
                                        Connect to your motivation ðŸ¥­
                                    </span>
                                </div>
                                <textarea
                                    value={task.whyItMatters || ''}
                                    onChange={(e) => updateTask(boardId, groupId, task.id, { whyItMatters: e.target.value })}
                                    placeholder="Why is this task important to you? What will completing it help you achieve? How does it connect to your goals?"
                                    className="w-full px-5 py-4 border-2 rounded-2xl text-sm bg-white"
                                    style={{borderColor: 'var(--ripe-mango)', color: 'var(--charcoal)'}}
                                    rows="2"
                                />
                            </div>
                        </div>
                    )}

                    {/* Reminder Picker Section */}
                    {showReminderPicker && (
                        <div className="mt-5 pt-5" style={{borderTop: '2px solid var(--linen)'}}>
                            <div className="flex items-center space-x-3 mb-4">
                                <i className="fas fa-bell" style={{color: 'var(--mango-leaf)'}}></i>
                                <span className="font-bold text-sm" style={{color: 'var(--charcoal)'}}>Remind me at:</span>
                                {task.reminderTime && (
                                    <button
                                        onClick={() => updateTask(boardId, groupId, task.id, { reminderTime: null })}
                                        className="text-xs font-semibold ml-2"
                                        style={{color: 'var(--warm-red)'}}
                                    >
                                        <i className="fas fa-times mr-1"></i>
                                        Clear
                                    </button>
                                )}
                            </div>
                            <div className="flex flex-wrap gap-2">
                                {reminderTimeOptions.map(option => (
                                    <button
                                        key={option.value}
                                        onClick={() => updateTask(boardId, groupId, task.id, { reminderTime: option.value })}
                                        className={`reminder-chip px-4 py-2 text-sm font-semibold ${task.reminderTime === option.value ? 'active' : ''}`}
                                    >
                                        {option.label}
                                    </button>
                                ))}
                            </div>
                            {task.reminderTime && (
                                <p className="text-xs mt-3 font-semibold" style={{color: 'var(--mango-leaf)'}}>
                                    <i className="fas fa-check mr-1.5"></i>
                                    Reminder set for {reminderTimeOptions.find(o => o.value === task.reminderTime)?.label} on the due date
                                </p>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        // Timeline View Component
        function TimelineView({ boards }) {
            const allTasks = useMemo(() => {
                const tasks = [];
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            if (task.dueDate) {
                                tasks.push({
                                    ...task,
                                    boardName: board.name,
                                    groupName: group.name
                                });
                            }
                        });
                    });
                });
                return tasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            }, [boards]);

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-8 py-6" style={{borderColor: 'var(--linen)'}}>
                        <h2 className="text-3xl font-bold" style={{color: 'var(--charcoal)'}}>Timeline</h2>
                        <p className="text-sm font-medium mt-2" style={{color: 'var(--warm-gray)'}}>Watch your mangoes ripen! ðŸ¥­ All tasks with due dates, sorted chronologically</p>
                    </div>
                    <div className="flex-1 overflow-auto p-8 scrollbar-thin">
                        {allTasks.length === 0 ? (
                            <div className="text-center mt-24" style={{color: 'var(--warm-gray)'}}>
                                <i className="fas fa-calendar-alt text-7xl mb-5 opacity-30"></i>
                                <p className="text-xl font-bold">No tasks with due dates yet</p>
                                <p className="text-sm mt-2">Add due dates to your tasks to see them here - ripen at your own pace! ðŸ¥­</p>
                            </div>
                        ) : (
                            <div className="max-w-4xl mx-auto space-y-5">
                                {allTasks.map(task => {
                                    const daysUntil = getDaysUntil(task.dueDate);
                                    const isPast = daysUntil < 0;
                                    const isTodayTask = daysUntil === 0;
                                    const isSoon = daysUntil > 0 && daysUntil <= 3;
                                    const isQuickWin = task.timeEstimate === '5min' || task.timeEstimate === '15min';

                                    return (
                                        <div 
                                            key={task.id} 
                                            className="card-gentle shadow-soft p-6 hover-lift"
                                            style={{ 
                                                borderLeft: `5px solid ${
                                                    isPast ? 'var(--warm-red)' :
                                                    isTodayTask ? 'var(--ripe-mango)' :
                                                    isSoon ? 'var(--golden-flesh)' :
                                                    'var(--mango-leaf)'
                                                }`
                                            }}
                                        >
                                            <div className="flex items-start justify-between">
                                                <div className="flex-1">
                                                    <div className="flex items-center space-x-3">
                                                        <h3 className="font-bold text-lg" style={{color: 'var(--charcoal)'}}>
                                                            {task.name}
                                                        </h3>
                                                        {isQuickWin && (
                                                            <span className="quick-win-badge inline-flex items-center text-xs font-bold px-3 py-1 rounded-xl">
                                                                <i className="fas fa-bolt mr-1"></i>
                                                                Quick Win
                                                            </span>
                                                        )}
                                                    </div>
                                                    <p className="text-sm font-medium mt-2" style={{color: 'var(--warm-gray)'}}>
                                                        {task.boardName} â€¢ {task.groupName}
                                                    </p>
                                                    <div className="flex items-center space-x-3 mt-4">
                                                        <span className={`status-${task.status} badge-soft text-xs`}>
                                                            {task.status}
                                                        </span>
                                                        <span className="badge-soft text-xs" style={{background: 'var(--sky)', color: 'var(--soft-black)'}}>
                                                            {task.timeEstimate}
                                                        </span>
                                                        {task.assignee && (
                                                            <span className="text-sm font-medium" style={{color: 'var(--warm-gray)'}}>
                                                                <i className="fas fa-user mr-1.5"></i>
                                                                {task.assignee}
                                                            </span>
                                                        )}
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="font-bold text-base" style={{
                                                        color: isPast ? 'var(--warm-red)' :
                                                               isTodayTask ? 'var(--ripe-mango)' :
                                                               isSoon ? 'var(--golden-flesh)' :
                                                               'var(--charcoal)'
                                                    }}>
                                                        {formatDate(task.dueDate)}
                                                    </div>
                                                    <div className="text-sm font-semibold mt-2" style={{
                                                        color: isPast ? 'var(--warm-red)' :
                                                               isTodayTask ? 'var(--ripe-mango)' :
                                                               isSoon ? 'var(--golden-flesh)' :
                                                               'var(--warm-gray)'
                                                    }}>
                                                        {isPast ? `${Math.abs(daysUntil)} days ago` :
                                                         isTodayTask ? 'Due today' :
                                                         `${daysUntil} days left`}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Team View Component
        function TeamView({ team, addTeamMember, updateTeamMember, deleteTeamMember }) {
            const [showAddForm, setShowAddForm] = useState(false);
            const [newMember, setNewMember] = useState({ name: '', email: '', role: '', avatar: 'ðŸ‘¤ðŸ½' });
            const [editingMember, setEditingMember] = useState(null);
            const [uploadError, setUploadError] = useState('');
            const [searchQuery, setSearchQuery] = useState('');

            const filteredTeam = useMemo(() => {
                if (!searchQuery.trim()) return team;
                const query = searchQuery.toLowerCase();
                return team.filter(member => 
                    member.name.toLowerCase().includes(query) ||
                    member.email.toLowerCase().includes(query) ||
                    member.role.toLowerCase().includes(query)
                );
            }, [team, searchQuery]);

            const handleAddMember = () => {
                if (newMember.name && newMember.email) {
                    addTeamMember(newMember);
                    setNewMember({ name: '', email: '', role: '', avatar: 'ðŸ‘¤ðŸ½' });
                    setShowAddForm(false);
                }
            };

            const handleEditMember = (member) => {
                setEditingMember({ ...member });
                setUploadError('');
            };

            const handleSaveEdit = () => {
                if (editingMember.name && editingMember.email) {
                    updateTeamMember(editingMember.id, {
                        name: editingMember.name,
                        email: editingMember.email,
                        role: editingMember.role,
                        avatar: editingMember.avatar
                    });
                    setEditingMember(null);
                    setUploadError('');
                }
            };

            const handleCancelEdit = () => {
                setEditingMember(null);
                setUploadError('');
            };

            const handleImageUpload = (e, isEditing = false) => {
                const file = e.target.files[0];
                if (!file) return;

                const maxSize = 10 * 1024 * 1024;
                if (file.size > maxSize) {
                    setUploadError('Image must be less than 10MB');
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    setUploadError('Please upload an image file');
                    return;
                }

                setUploadError('');

                const reader = new FileReader();
                reader.onload = (event) => {
                    const base64Image = event.target.result;
                    if (isEditing) {
                        setEditingMember({ ...editingMember, avatar: base64Image });
                    } else {
                        setNewMember({ ...newMember, avatar: base64Image });
                    }
                };
                reader.readAsDataURL(file);
            };

            const avatarOptions = ['ðŸ‘¤ðŸ½', 'ðŸ‘¨ðŸ½â€ðŸ’¼', 'ðŸ‘©ðŸ½â€ðŸ’¼', 'ðŸ‘¨ðŸ½â€ðŸ’»', 'ðŸ‘©ðŸ½â€ðŸ’»', 'ðŸ‘¨ðŸ½â€ðŸŽ¨', 'ðŸ‘©ðŸ½â€ðŸŽ¨', 'ðŸ‘¨ðŸ½â€ðŸ”§', 'ðŸ‘©ðŸ½â€ðŸ”§', 'ðŸ‘¨ðŸ½â€ðŸ«', 'ðŸ‘©ðŸ½â€ðŸ«'];

            const renderAvatar = (avatar, size = 'text-5xl') => {
                if (avatar.startsWith('data:image')) {
                    const imgSize = size === 'text-5xl' ? 'w-20 h-20' : size === 'text-3xl' ? 'w-12 h-12' : 'w-16 h-16';
                    return (
                        <img 
                            src={avatar} 
                            alt="Avatar" 
                            className={`${imgSize} rounded-full object-cover`}
                            style={{boxShadow: '0 2px 12px rgba(74, 74, 74, 0.1)'}}
                        />
                    );
                }
                return <div className={size}>{avatar}</div>;
            };

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-8 py-6 flex items-center justify-between" style={{borderColor: 'var(--linen)'}}>
                        <div>
                            <h2 className="text-3xl font-bold" style={{color: 'var(--charcoal)'}}>Team Members</h2>
                            <p className="text-sm font-medium mt-2" style={{color: 'var(--warm-gray)'}}>Your mango grove team ðŸ¥­</p>
                        </div>
                        <div className="flex items-center space-x-4">
                            <div className="relative">
                                <i className="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2" style={{color: 'var(--warm-gray)'}}></i>
                                <input
                                    type="text"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    placeholder="Search by name, email, or role..."
                                    className="pl-11 pr-5 py-3 border-2 rounded-2xl w-72 font-medium"
                                    style={{borderColor: 'var(--linen)', color: 'var(--charcoal)', background: 'white'}}
                                />
                                {searchQuery && (
                                    <button
                                        onClick={() => setSearchQuery('')}
                                        className="absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full transition-all"
                                        style={{color: 'var(--warm-gray)'}}
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                )}
                            </div>
                            <button
                                onClick={() => setShowAddForm(true)}
                                className="btn-primary px-6 py-3 text-white rounded-2xl hover-lift flex items-center font-semibold"
                            >
                                <i className="fas fa-user-plus mr-2"></i>
                                Add Member
                            </button>
                        </div>
                    </div>

                    <div className="flex-1 overflow-auto p-8 scrollbar-thin">
                        {showAddForm && (
                            <div className="card-gentle shadow-soft-lg p-8 mb-8 max-w-2xl">
                                <h3 className="text-xl font-bold mb-6" style={{color: 'var(--charcoal)'}}>
                                    Add New Team Member ðŸ¥­
                                </h3>
                                <div className="space-y-5">
                                    <div>
                                        <label className="block text-sm font-bold mb-2" style={{color: 'var(--charcoal)'}}>Name</label>
                                        <input
                                            type="text"
                                            value={newMember.name}
                                            onChange={(e) => setNewMember({ ...newMember, name: e.target.value })}
                                            className="w-full px-5 py-4 border-2 rounded-2xl"
                                            style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                            placeholder="John Doe"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2" style={{color: 'var(--charcoal)'}}>Email</label>
                                        <input
                                            type="email"
                                            value={newMember.email}
                                            onChange={(e) => setNewMember({ ...newMember, email: e.target.value })}
                                            className="w-full px-5 py-4 border-2 rounded-2xl"
                                            style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                            placeholder="john@company.com"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2" style={{color: 'var(--charcoal)'}}>Role</label>
                                        <input
                                            type="text"
                                            value={newMember.role}
                                            onChange={(e) => setNewMember({ ...newMember, role: e.target.value })}
                                            className="w-full px-5 py-4 border-2 rounded-2xl"
                                            style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                            placeholder="Developer"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2" style={{color: 'var(--charcoal)'}}>Profile Photo</label>
                                        
                                        <div className="mb-4 flex items-center space-x-5">
                                            <div className="flex items-center justify-center">
                                                {renderAvatar(newMember.avatar, 'text-4xl')}
                                            </div>
                                            <div className="flex-1">
                                                <label className="btn-primary px-5 py-3 text-white rounded-2xl hover-lift font-semibold cursor-pointer inline-flex items-center">
                                                    <i className="fas fa-upload mr-2"></i>
                                                    Upload Photo
                                                    <input
                                                        type="file"
                                                        accept="image/*"
                                                        onChange={(e) => handleImageUpload(e, false)}
                                                        className="hidden"
                                                    />
                                                </label>
                                                <p className="text-xs mt-2 font-medium" style={{color: 'var(--warm-gray)'}}>Max 10MB â€¢ JPG, PNG, GIF</p>
                                                {uploadError && (
                                                    <p className="text-xs mt-2 font-semibold" style={{color: 'var(--warm-red)'}}>{uploadError}</p>
                                                )}
                                            </div>
                                        </div>

                                        <div className="pt-4" style={{borderTop: '2px solid var(--linen)'}}>
                                            <p className="text-sm font-semibold mb-3" style={{color: 'var(--warm-gray)'}}>Or choose an emoji:</p>
                                            <div className="flex flex-wrap gap-3">
                                                {avatarOptions.map(avatar => (
                                                    <button
                                                        key={avatar}
                                                        onClick={() => setNewMember({ ...newMember, avatar })}
                                                        className={`text-3xl p-3 rounded-2xl border-2 transition-all hover-lift ${newMember.avatar === avatar ? 'shadow-soft' : ''}`}
                                                        style={{borderColor: newMember.avatar === avatar ? 'var(--mango-leaf)' : 'var(--linen)'}}
                                                    >
                                                        {avatar}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex space-x-4 pt-3">
                                        <button onClick={handleAddMember} className="btn-primary px-6 py-3 text-white rounded-2xl font-semibold">
                                            Add Member
                                        </button>
                                        <button onClick={() => setShowAddForm(false)} className="px-6 py-3 rounded-2xl font-semibold" style={{background: 'var(--linen)', color: 'var(--charcoal)'}}>
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filteredTeam.length === 0 ? (
                                <div className="col-span-full text-center py-16" style={{color: 'var(--warm-gray)'}}>
                                    <i className="fas fa-search text-5xl mb-4 opacity-30"></i>
                                    <p className="text-lg font-semibold">No team members found</p>
                                    <p className="text-sm mt-2">Try adjusting your search query</p>
                                </div>
                            ) : (
                                filteredTeam.map(member => (
                                <div key={member.id} className="card-gentle shadow-soft p-7 hover-lift">
                                    <div className="flex items-start justify-between mb-5">
                                        <div className="flex items-center justify-center">
                                            {renderAvatar(member.avatar)}
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <button
                                                onClick={() => handleEditMember(member)}
                                                className="p-2.5 rounded-xl transition-all"
                                                style={{color: 'var(--mango-leaf)', background: 'transparent'}}
                                                title="Edit member"
                                            >
                                                <i className="fas fa-edit"></i>
                                            </button>
                                            <button
                                                onClick={() => {
                                                    if (confirm(`Remove ${member.name}?`)) {
                                                        deleteTeamMember(member.id);
                                                    }
                                                }}
                                                className="p-2.5 rounded-xl transition-all"
                                                style={{color: 'var(--warm-red)', background: 'transparent'}}
                                                title="Delete member"
                                            >
                                                <i className="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <h3 className="font-bold text-lg" style={{color: 'var(--charcoal)'}}>{member.name}</h3>
                                    <p className="text-sm font-medium mt-1" style={{color: 'var(--mango-leaf)'}}>{member.role}</p>
                                    <p className="text-sm mt-3" style={{color: 'var(--warm-gray)'}}>{member.email}</p>
                                </div>
                            ))
                        )}
                        </div>

                        {/* Edit Member Modal */}
                        {editingMember && (
                            <div className="fixed inset-0 flex items-center justify-center z-50 p-4" style={{background: 'rgba(74, 74, 74, 0.4)', backdropFilter: 'blur(8px)'}}>
                                <div className="card-gentle shadow-soft-lg p-8 max-w-lg w-full" onClick={(e) => e.stopPropagation()}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h3 className="text-2xl font-bold" style={{color: 'var(--charcoal)'}}>
                                            Edit Team Member ðŸ¥­
                                        </h3>
                                        <button
                                            onClick={handleCancelEdit}
                                            className="p-2.5 rounded-xl transition-all"
                                            style={{color: 'var(--warm-gray)', background: 'var(--linen)'}}
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <div className="space-y-5">
                                        <div>
                                            <label className="block text-sm font-bold mb-2" style={{color: 'var(--charcoal)'}}>Name</label>
                                            <input
                                                type="text"
                                                value={editingMember.name}
                                                onChange={(e) => setEditingMember({ ...editingMember, name: e.target.value })}
                                                className="w-full px-5 py-4 border-2 rounded-2xl transition-all font-medium"
                                                style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                                placeholder="John Doe"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-bold mb-2" style={{color: 'var(--charcoal)'}}>Email</label>
                                            <input
                                                type="email"
                                                value={editingMember.email}
                                                onChange={(e) => setEditingMember({ ...editingMember, email: e.target.value })}
                                                className="w-full px-5 py-4 border-2 rounded-2xl transition-all font-medium"
                                                style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                                placeholder="john@company.com"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-bold mb-2" style={{color: 'var(--charcoal)'}}>Role</label>
                                            <input
                                                type="text"
                                                value={editingMember.role}
                                                onChange={(e) => setEditingMember({ ...editingMember, role: e.target.value })}
                                                className="w-full px-5 py-4 border-2 rounded-2xl transition-all font-medium"
                                                style={{borderColor: 'var(--linen)', color: 'var(--charcoal)'}}
                                                placeholder="Developer"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-bold mb-2" style={{color: 'var(--charcoal)'}}>Profile Photo</label>
                                            
                                            <div className="mb-4 flex items-center space-x-5">
                                                <div className="flex items-center justify-center">
                                                    {renderAvatar(editingMember.avatar, 'text-4xl')}
                                                </div>
                                                <div className="flex-1">
                                                    <label className="btn-primary px-5 py-3 text-white rounded-2xl hover-lift font-semibold cursor-pointer inline-flex items-center">
                                                        <i className="fas fa-upload mr-2"></i>
                                                        Upload Photo
                                                        <input
                                                            type="file"
                                                            accept="image/*"
                                                            onChange={(e) => handleImageUpload(e, true)}
                                                            className="hidden"
                                                        />
                                                    </label>
                                                    <p className="text-xs mt-2 font-medium" style={{color: 'var(--warm-gray)'}}>Max 10MB â€¢ JPG, PNG, GIF</p>
                                                    {uploadError && (
                                                        <p className="text-xs mt-2 font-semibold" style={{color: 'var(--warm-red)'}}>{uploadError}</p>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="pt-4" style={{borderTop: '2px solid var(--linen)'}}>
                                                <p className="text-sm font-semibold mb-3" style={{color: 'var(--warm-gray)'}}>Or choose an emoji:</p>
                                                <div className="flex flex-wrap gap-3">
                                                    {avatarOptions.map(avatar => (
                                                        <button
                                                            key={avatar}
                                                            onClick={() => setEditingMember({ ...editingMember, avatar })}
                                                            className={`text-3xl p-3 rounded-2xl border-2 transition-all hover-lift ${editingMember.avatar === avatar ? 'shadow-soft' : ''}`}
                                                            style={{borderColor: editingMember.avatar === avatar ? 'var(--mango-leaf)' : 'var(--linen)'}}
                                                        >
                                                            {avatar}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex space-x-4 pt-3">
                                            <button
                                                onClick={handleSaveEdit}
                                                className="btn-primary px-6 py-3 text-white rounded-2xl hover-lift font-semibold"
                                            >
                                                Save Changes
                                            </button>
                                            <button
                                                onClick={handleCancelEdit}
                                                className="px-6 py-3 rounded-2xl hover-lift font-semibold transition-all"
                                                style={{background: 'var(--linen)', color: 'var(--charcoal)'}}
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Dashboard View Component
        function DashboardView({ boards, team }) {
            const stats = useMemo(() => {
                let totalTasks = 0;
                let completedTasks = 0;
                let overdueTasks = 0;
                let upcomingTasks = 0;
                let quickWins = 0;
                let focusTasks = 0;

                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            totalTasks++;
                            if (task.status === 'done') completedTasks++;
                            if (task.isFocusTask) focusTasks++;
                            if (task.timeEstimate === '5min' || task.timeEstimate === '15min') quickWins++;
                            
                            const daysUntil = getDaysUntil(task.dueDate);
                            if (daysUntil !== null) {
                                if (daysUntil < 0) overdueTasks++;
                                if (daysUntil >= 0 && daysUntil <= 7) upcomingTasks++;
                            }
                        });
                    });
                });

                return { totalTasks, completedTasks, overdueTasks, upcomingTasks, quickWins, focusTasks };
            }, [boards]);

            const statusBreakdown = useMemo(() => {
                const breakdown = { new: 0, working: 0, stuck: 0, done: 0 };
                boards.forEach(board => {
                    board.groups.forEach(group => {
                        group.tasks.forEach(task => {
                            breakdown[task.status]++;
                        });
                    });
                });
                return breakdown;
            }, [boards]);

            return (
                <div className="flex-1 flex flex-col overflow-hidden">
                    <div className="glass-effect border-b px-8 py-6" style={{borderColor: 'var(--linen)'}}>
                        <h2 className="text-3xl font-bold" style={{color: 'var(--charcoal)'}}>Dashboard</h2>
                        <p className="text-sm font-medium mt-2" style={{color: 'var(--warm-gray)'}}>See how your mangoes are ripening! ðŸ¥­</p>
                    </div>

                    <div className="flex-1 overflow-auto p-8 scrollbar-thin">
                        {/* Stats Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div className="card-gentle shadow-soft p-7 hover-lift">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-semibold mb-2" style={{color: 'var(--warm-gray)'}}>Total Tasks</p>
                                        <p className="text-4xl font-bold" style={{color: 'var(--charcoal)'}}>{stats.totalTasks}</p>
                                    </div>
                                    <i className="fas fa-tasks text-5xl opacity-20" style={{color: 'var(--mango-leaf)'}}></i>
                                </div>
                            </div>

                            <div className="card-gentle shadow-soft p-7 hover-lift">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-semibold mb-2" style={{color: 'var(--warm-gray)'}}>Focus Tasks</p>
                                        <p className="text-4xl font-bold" style={{color: 'var(--ripe-mango)'}}>{stats.focusTasks}</p>
                                    </div>
                                    <i className="fas fa-star text-5xl opacity-20" style={{color: 'var(--ripe-mango)'}}></i>
                                </div>
                            </div>

                            <div className="card-gentle shadow-soft p-7 hover-lift">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-semibold mb-2" style={{color: 'var(--warm-gray)'}}>Quick Wins</p>
                                        <p className="text-4xl font-bold" style={{color: 'var(--sunny-yellow)'}}>{stats.quickWins}</p>
                                    </div>
                                    <i className="fas fa-bolt text-5xl opacity-20" style={{color: 'var(--sunny-yellow)'}}></i>
                                </div>
                            </div>

                            <div className="card-gentle shadow-soft p-7 hover-lift">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-semibold mb-2" style={{color: 'var(--warm-gray)'}}>Completed</p>
                                        <p className="text-4xl font-bold" style={{color: 'var(--sanctuary-sage)'}}>{stats.completedTasks}</p>
                                    </div>
                                    <i className="fas fa-check-circle text-5xl opacity-20" style={{color: 'var(--sanctuary-sage)'}}></i>
                                </div>
                            </div>
                        </div>

                        {/* Charts Section */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            {/* Status Breakdown */}
                            <div className="card-gentle shadow-soft p-7 hover-lift">
                                <h3 className="text-xl font-bold mb-6" style={{color: 'var(--charcoal)'}}>Task Status Breakdown</h3>
                                <div className="space-y-5">
                                    <div>
                                        <div className="flex justify-between mb-2">
                                            <span className="capitalize font-semibold" style={{color: 'var(--charcoal)'}}>New</span>
                                            <span className="font-bold" style={{color: 'var(--charcoal)'}}>{statusBreakdown.new}</span>
                                        </div>
                                        <div className="w-full h-3 rounded-full" style={{background: 'var(--linen)'}}>
                                            <div 
                                                className="h-3 rounded-full"
                                                style={{ 
                                                    width: `${(statusBreakdown.new / stats.totalTasks * 100) || 0}%`,
                                                    background: 'var(--status-new)'
                                                }}
                                            ></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div className="flex justify-between mb-2">
                                            <span className="capitalize font-semibold" style={{color: 'var(--charcoal)'}}>Working</span>
                                            <span className="font-bold" style={{color: 'var(--charcoal)'}}>{statusBreakdown.working}</span>
                                        </div>
                                        <div className="w-full h-3 rounded-full" style={{background: 'var(--linen)'}}>
                                            <div 
                                                className="h-3 rounded-full"
                                                style={{ 
                                                    width: `${(statusBreakdown.working / stats.totalTasks * 100) || 0}%`,
                                                    background: 'var(--status-working)'
                                                }}
                                            ></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div className="flex justify-between mb-2">
                                            <span className="capitalize font-semibold" style={{color: 'var(--charcoal)'}}>Stuck</span>
                                            <span className="font-bold" style={{color: 'var(--charcoal)'}}>{statusBreakdown.stuck}</span>
                                        </div>
                                        <div className="w-full h-3 rounded-full" style={{background: 'var(--linen)'}}>
                                            <div 
                                                className="h-3 rounded-full"
                                                style={{ 
                                                    width: `${(statusBreakdown.stuck / stats.totalTasks * 100) || 0}%`,
                                                    background: 'var(--status-stuck)'
                                                }}
                                            ></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div className="flex justify-between mb-2">
                                            <span className="capitalize font-semibold" style={{color: 'var(--charcoal)'}}>Done</span>
                                            <span className="font-bold" style={{color: 'var(--charcoal)'}}>{statusBreakdown.done}</span>
                                        </div>
                                        <div className="w-full h-3 rounded-full" style={{background: 'var(--linen)'}}>
                                            <div 
                                                className="h-3 rounded-full"
                                                style={{ 
                                                    width: `${(statusBreakdown.done / stats.totalTasks * 100) || 0}%`,
                                                    background: 'var(--status-done)'
                                                }}
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Team Overview */}
                            <div className="card-gentle shadow-soft p-7 hover-lift">
                                <h3 className="text-xl font-bold mb-6" style={{color: 'var(--charcoal)'}}>Team Overview</h3>
                                <div className="space-y-4">
                                    <div className="flex items-center justify-between p-5 rounded-2xl" style={{background: 'rgba(107, 142, 107, 0.12)'}}>
                                        <span className="text-sm font-semibold" style={{color: 'var(--charcoal)'}}>Total Members</span>
                                        <span className="text-3xl font-bold" style={{color: 'var(--mango-leaf)'}}>{team.length}</span>
                                    </div>
                                    <div className="flex items-center justify-between p-5 rounded-2xl" style={{background: 'rgba(168, 200, 216, 0.15)'}}>
                                        <span className="text-sm font-semibold" style={{color: 'var(--charcoal)'}}>Active Boards</span>
                                        <span className="text-3xl font-bold" style={{color: 'var(--sky)'}}>{boards.length}</span>
                                    </div>
                                    <div className="flex items-center justify-between p-5 rounded-2xl" style={{background: 'rgba(168, 181, 160, 0.15)'}}>
                                        <span className="text-sm font-semibold" style={{color: 'var(--charcoal)'}}>Completion Rate</span>
                                        <span className="text-3xl font-bold" style={{color: 'var(--sanctuary-sage)'}}>
                                            {stats.totalTasks > 0 ? Math.round((stats.completedTasks / stats.totalTasks) * 100) : 0}%
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Boards Overview */}
                        <div className="card-gentle shadow-soft p-7 hover-lift">
                            <h3 className="text-xl font-bold mb-6" style={{color: 'var(--charcoal)'}}>Boards Overview</h3>
                            <div className="space-y-4">
                                {boards.map(board => {
                                    const boardTasks = board.groups.reduce((acc, g) => acc + g.tasks.length, 0);
                                    const boardCompleted = board.groups.reduce((acc, g) => 
                                        acc + g.tasks.filter(t => t.status === 'done').length, 0
                                    );
                                    
                                    return (
                                        <div key={board.id} className="flex items-center justify-between p-5 border-2 rounded-2xl transition-all" style={{borderColor: 'var(--linen)', background: 'white'}}>
                                            <div className="flex items-center space-x-4">
                                                <div className="w-4 h-4 rounded-full" style={{ backgroundColor: board.color }}></div>
                                                <div>
                                                    <h4 className="font-bold" style={{color: 'var(--charcoal)'}}>{board.name}</h4>
                                                    <p className="text-sm font-medium" style={{color: 'var(--warm-gray)'}}>{board.groups.length} groups</p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-bold" style={{color: 'var(--charcoal)'}}>{boardTasks} tasks</p>
                                                <p className="text-sm font-semibold" style={{color: 'var(--mango-leaf)'}}>{boardCompleted} done</p>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        try {
            ReactDOM.render(<App />, document.getElementById('root'));
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 40px; text-align: center; font-family: 'Nunito', sans-serif;">
                    <h1 style="color: var(--warm-red);">Something went wrong</h1>
                    <p style="color: var(--warm-gray); margin: 20px 0;">${error.message}</p>
                    <button onclick="localStorage.clear(); location.reload();" 
                            style="background: var(--mango-leaf); color: white; padding: 14px 28px; border: none; border-radius: 16px; cursor: pointer; font-weight: 600; font-family: 'Nunito', sans-serif;">
                        Clear Data & Reload
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
